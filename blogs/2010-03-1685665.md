# 修改应用程序搜索程序集的私有路径 
> 原文发表于 2010-03-14, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/03/14/1685665.html 


<p>这是今天讲课中的一个小例子, 演示了如何添加搜索路径,以便让.NET的应用程序可以搜索到有关的程序集. 因为.NET程序默认只是在自己的根目录和GAC中搜索, 所以添加下面的配置后,就可以实现在plugins目录下面搜索的目的了</p><pre class="csharpcode">&lt;?xml version=<span class="str">"1.0"</span> encoding=<span class="str">"utf-8"</span> ?&gt;
&lt;configuration&gt;
  &lt;runtime&gt;
    &lt;assemblyBinding xmlns=<span class="str">"urn:schemas-microsoft-com:asm.v1"</span>&gt;
      &lt;probing privatePath=<span class="str">"plugins"</span>/&gt;
    &lt;/assemblyBinding&gt;
  &lt;/runtime&gt;
&lt;/configuration&gt;</pre><pre class="csharpcode">&nbsp;</pre><pre class="csharpcode">&nbsp;</pre><pre class="csharpcode">大家一定也想知道如何在代码中实现这样的功能，这看起来并不难，对吧？</pre><pre class="csharpcode">我们发现有一个类叫AppDomainSetup类，然后它有一个属性叫PrivateBinPath，难道不就是这个吗？</pre><pre class="csharpcode">但请你耐心地看一下下面这个博客文章吧，呵呵</pre><pre class="csharpcode"><a title="http://www.cnblogs.com/nullreference/archive/2010/02/09/set_appdomain_privatebinpath_and_configurationfile_location.html" href="http://www.cnblogs.com/nullreference/archive/2010/02/09/set_appdomain_privatebinpath_and_configurationfile_location.html">http://www.cnblogs.com/nullreference/archive/2010/02/09/set_appdomain_privatebinpath_and_configurationfile_location.html</a></pre><pre class="csharpcode">&nbsp;</pre><pre class="csharpcode">这个设计实在是有些诡异。。但是，不服不行</pre><pre class="csharpcode">&nbsp;</pre>
<blockquote>
<p>在调试过程中，我们还发现Main方法不是最好的地方，所以我们将代码放在了Program的静态构造方法中，这里是除了静态字段外的最早的起始地了。
<p><pre class="csharpcode"><span class="kwrd">static</span> Program() 

{ 

AppDomain.CurrentDomain.SetData(<span class="str">"PRIVATE_BINPATH"</span>, <span class="str">"Castle;Core;Module;UI;Misc;"</span>); 

AppDomain.CurrentDomain.SetData(<span class="str">"BINPATH_PROBE_ONLY"</span>, <span class="str">"Castle;Core;Module;UI;Misc;"</span>); 

var m = <span class="kwrd">typeof</span>(AppDomainSetup).GetMethod(<span class="str">"UpdateContextProperty"</span>, BindingFlags.NonPublic | BindingFlags.Static); 

var funsion = <span class="kwrd">typeof</span>(AppDomain).GetMethod(<span class="str">"GetFusionContext"</span>, BindingFlags.NonPublic | BindingFlags.Instance); 

m.Invoke(<span class="kwrd">null</span>, <span class="kwrd">new</span> <span class="kwrd">object</span>[] { funsion.Invoke(AppDomain.CurrentDomain, <span class="kwrd">null</span>), <span class="str">"PRIVATE_BINPATH"</span>, <span class="str">"Castle;Core;Module;UI;Misc;"</span> }); 

}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p></blockquote>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>