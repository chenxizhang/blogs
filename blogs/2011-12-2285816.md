# MVC3课程中的几个问题整理 
> 原文发表于 2011-12-13, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/12/13/2285816.html 


<p>这是几个小问题，整理出来给大家参考</p> <p>&nbsp;</p> <h1>1. 如何为不同类型的属性设置不同的编辑界面</h1> <p>备注：这个实例的源代码，可以通过这里下载 <a title="MvcApplicationEditTemplate.rar" href="http://files.cnblogs.com/chenxizhang/MvcApplicationEditTemplate.rar">MvcApplicationEditTemplate.rar</a></p> <p>&nbsp;</p> <p>我们探讨到了针对不同的属性，MVC3其实可以专门定制不同的编辑界面。这个概念，其实早在MVC出来之前，就曾经有过。之前有一个Dynamic Data的网站模板 ，里面大致也是用到了所谓的编辑器模板（FieldTemplates)的概念。</p> <p>我们可以大致看一眼之前的做法</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126283157.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126283190.png" width="337" height="732"></a></p> <p>注意,Dynamic Data这个模板，是基于Web Forms实现的一个应用架构。这里不作进一步展开，如果有兴趣的朋友，可以参考：<a title="http://msdn.microsoft.com/en-us/library/ee845452.aspx" href="http://msdn.microsoft.com/en-us/library/ee845452.aspx">http://msdn.microsoft.com/en-us/library/ee845452.aspx</a></p> <p>&nbsp;</p> <p>提一下Dynamic Data，是希望给大家一个初步印象，确实可以针对不同类型的字段，设置不同的界面来编辑或者显示。MVC中也提供了这样的机制。</p> <p>下面我们来做一个常见的例子，<strong><font color="#ff0000">我们希望那些类型为DateTime的属性，在页面上编辑的时候，自动调用jquery的一个日历效果让用户可以选择，而不是简单的一个文本框。</font></strong></p> <p>&nbsp;</p> <h2>准备一个业务实体类型(Employee)</h2><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Web;

<span class="kwrd">namespace</span> MvcApplicationEditTemplate.Models
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> Employee
    {
        <span class="kwrd">public</span> <span class="kwrd">int</span> ID { get; set; }
        <span class="kwrd">public</span> <span class="kwrd">string</span> FirstName { get; set; }
        <span class="kwrd">public</span> <span class="kwrd">string</span> LastName { get; set; }
        <span class="kwrd">public</span> DateTime Birthday { get; set; }
    }
}</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<h2>准备一个HomeController</h2><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Web;
<span class="kwrd">using</span> System.Web.Mvc;

<span class="kwrd">namespace</span> MvcApplicationEditTemplate.Controllers
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> HomeController : Controller
    {
        <span class="rem">//</span>
        <span class="rem">// GET: /Home/</span>

        <span class="kwrd">public</span> ActionResult Index()
        {
            var emp = <span class="kwrd">new</span> Models.Employee();

            <span class="kwrd">return</span> View(emp);
        }

    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<h2>为这个Action生成一个Edit视图</h2><pre class="csharpcode">@model MvcApplicationEditTemplate.Models.Employee

@{
    ViewBag.Title = "Index";
}

<span class="kwrd">&lt;</span><span class="html">h2</span><span class="kwrd">&gt;</span>Index<span class="kwrd">&lt;/</span><span class="html">h2</span><span class="kwrd">&gt;</span>



@using (Html.BeginForm()) {
    @Html.ValidationSummary(true)
    <span class="kwrd">&lt;</span><span class="html">fieldset</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">legend</span><span class="kwrd">&gt;</span>Employee<span class="kwrd">&lt;/</span><span class="html">legend</span><span class="kwrd">&gt;</span>

        @Html.HiddenFor(model =<span class="kwrd">&gt;</span> model.ID)

        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-label"</span><span class="kwrd">&gt;</span>
            @Html.LabelFor(model =<span class="kwrd">&gt;</span> model.FirstName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-field"</span><span class="kwrd">&gt;</span>
            @Html.EditorFor(model =<span class="kwrd">&gt;</span> model.FirstName)
            @Html.ValidationMessageFor(model =<span class="kwrd">&gt;</span> model.FirstName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-label"</span><span class="kwrd">&gt;</span>
            @Html.LabelFor(model =<span class="kwrd">&gt;</span> model.LastName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-field"</span><span class="kwrd">&gt;</span>
            @Html.EditorFor(model =<span class="kwrd">&gt;</span> model.LastName)
            @Html.ValidationMessageFor(model =<span class="kwrd">&gt;</span> model.LastName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-label"</span><span class="kwrd">&gt;</span>
            @Html.LabelFor(model =<span class="kwrd">&gt;</span> model.Birthday)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-field"</span><span class="kwrd">&gt;</span>
            @Html.EditorFor(model =<span class="kwrd">&gt;</span> model.Birthday)
            @Html.ValidationMessageFor(model =<span class="kwrd">&gt;</span> model.Birthday)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">input</span> <span class="attr">type</span><span class="kwrd">="submit"</span> <span class="attr">value</span><span class="kwrd">="Save"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">fieldset</span><span class="kwrd">&gt;</span>
}

<span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
    @Html.ActionLink("Back to List", "Index")
<span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
</pre>
<p>&nbsp;</p>
<p>注意看这里的语法：EditorFor。这是MVC比较推荐的做法，我发现不少朋友可能还是习惯自己去些input，但我个人觉得那不是一个很好的做法。</p>
<h2>预览效果 
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</h2>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126283223.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126293256.png" width="552" height="513"></a></p>
<p>我们的需求就是，将Birthday下面这个文本框定制一下，让他可以自动显示出来一个日历。（我们将采用jquery ui来实现）</p>
<p>&nbsp;</p>
<h2>添加一个EditorTemplate</h2>
<p>由于Birthday属性是DateTime类型，所以我们可以针对这个类型设计一个编辑器模板。为了共享，我们可以将这个模板放在Shared目录下面</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126292417.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126294959.png" width="348" height="114"></a></p>
<p>请注意，这里的目录名必须叫做：EditorTemplates。那个模板的名称也必须叫DateTime.cshtml。 再一次领教了MVC中约定胜于配置的特性吧。</p><pre class="csharpcode">@model System.DateTime
@Html.TextBox("",ViewData.TemplateInfo.FormattedModelValue,new {date_picker=true})
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>在这个文件中，我们只需要指定两行代码。（这是Razor表达式语法），从上面的语法可以看出，我们其实还是放了一个文本框（TextBox)，但这里的关键在于，我们会通过jquery来给这个文本框添加特效。</p>
<p>&nbsp;</p>
<h2>添加一个jscript文件（EditorBehavior.js)</h2><pre class="csharpcode"><span class="rem">/// &lt;reference path="jquery-1.5.1-vsdoc.js" /&gt;</span>
$(<span class="kwrd">function</span> () {
    $(<span class="str">":input[date-picker]"</span>).datepicker();
});</pre><pre class="csharpcode">&nbsp;</pre>
<h2>在视图中引入这个脚本文件</h2><pre class="csharpcode">@model MvcApplicationEditTemplate.Models.Employee

@{
    ViewBag.Title = "Index";
}

<span class="kwrd">&lt;</span><span class="html">h2</span><span class="kwrd">&gt;</span>Index<span class="kwrd">&lt;/</span><span class="html">h2</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="@Url.Content("</span>~/<span class="attr">Scripts</span>/<span class="attr">jquery-ui-1</span>.<span class="attr">8</span>.<span class="attr">11</span>.<span class="attr">js</span><span class="kwrd">")"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    &lt;script src=<span class="str">"@Url.Content("</span>~/Scripts/EditorBehavior.js<span class="str">")"</span> type=<span class="str">"text/javascript"</span>&gt;<span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>

@using (Html.BeginForm()) {
    @Html.ValidationSummary(true)
    <span class="kwrd">&lt;</span><span class="html">fieldset</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">legend</span><span class="kwrd">&gt;</span>Employee<span class="kwrd">&lt;/</span><span class="html">legend</span><span class="kwrd">&gt;</span>

        @Html.HiddenFor(model =<span class="kwrd">&gt;</span> model.ID)

        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-label"</span><span class="kwrd">&gt;</span>
            @Html.LabelFor(model =<span class="kwrd">&gt;</span> model.FirstName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-field"</span><span class="kwrd">&gt;</span>
            @Html.EditorFor(model =<span class="kwrd">&gt;</span> model.FirstName)
            @Html.ValidationMessageFor(model =<span class="kwrd">&gt;</span> model.FirstName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-label"</span><span class="kwrd">&gt;</span>
            @Html.LabelFor(model =<span class="kwrd">&gt;</span> model.LastName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-field"</span><span class="kwrd">&gt;</span>
            @Html.EditorFor(model =<span class="kwrd">&gt;</span> model.LastName)
            @Html.ValidationMessageFor(model =<span class="kwrd">&gt;</span> model.LastName)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-label"</span><span class="kwrd">&gt;</span>
            @Html.LabelFor(model =<span class="kwrd">&gt;</span> model.Birthday)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="editor-field"</span><span class="kwrd">&gt;</span>
            @Html.EditorFor(model =<span class="kwrd">&gt;</span> model.Birthday)
            @Html.ValidationMessageFor(model =<span class="kwrd">&gt;</span> model.Birthday)
        <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">input</span> <span class="attr">type</span><span class="kwrd">="submit"</span> <span class="attr">value</span><span class="kwrd">="Save"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">fieldset</span><span class="kwrd">&gt;</span>
}

<span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
    @Html.ActionLink("Back to List", "Index")
<span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>最后预览得到的效果就是下面这样。按照这样的思路，我们还可以给其他类型的属性指定编辑器模板。</p><pre class="csharpcode">&nbsp;</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126306420.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126305930.png" width="476" height="621"></a></p>
<p>&nbsp;</p>
<p>这个实例的源代码，可以通过这里下载 <a title="MvcApplicationEditTemplate.rar" href="http://files.cnblogs.com/chenxizhang/MvcApplicationEditTemplate.rar">MvcApplicationEditTemplate.rar</a></p>
<p>&nbsp;</p>
<h1>2. 为什么脚本移动位置之后，页面的样式变化了</h1>
<p>这是一个小问题，我们先来看一下默认情况下MVC项目的样式</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126314011.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126317109.png" width="931" height="627"></a></p>
<p>这个布局和样式，是在_layout.cshtml中定义好的</p><pre class="csharpcode"><span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">html</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">html</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">meta</span> <span class="attr">charset</span><span class="kwrd">="utf-8"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;</span>@ViewBag.Title<span class="kwrd">&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">link</span> <span class="attr">href</span><span class="kwrd">="@Url.Content("</span>~/<span class="attr">Content</span>/<span class="attr">Site</span>.<span class="attr">css</span><span class="kwrd">")"</span> <span class="attr">rel</span><span class="kwrd">="stylesheet"</span> <span class="attr">type</span><span class="kwrd">="text/css"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="@Url.Content("</span>~/<span class="attr">Scripts</span>/<span class="attr">jquery-1</span>.<span class="attr">5</span>.<span class="attr">1</span>.<span class="attr">min</span>.<span class="attr">js</span><span class="kwrd">")"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    &lt;script src=<span class="str">"@Url.Content("</span>~/Scripts/modernizr-1.7.min.js<span class="str">")"</span> type=<span class="str">"text/javascript"</span>&gt;<span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="page"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">header</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="title"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">h1</span><span class="kwrd">&gt;</span>
                    My MVC Application<span class="kwrd">&lt;/</span><span class="html">h1</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="logindisplay"</span><span class="kwrd">&gt;</span>
                @Html.Partial("_LogOnPartial")
            <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">nav</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">ul</span> <span class="attr">id</span><span class="kwrd">="menu"</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>@Html.ActionLink("Home", "Index", "Home")<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>@Html.ActionLink("About", "About", "Home")<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">ul</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">nav</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">header</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">section</span> <span class="attr">id</span><span class="kwrd">="main"</span><span class="kwrd">&gt;</span>
            @RenderBody()
        <span class="kwrd">&lt;/</span><span class="html">section</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">footer</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">footer</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span>
</pre>
<p>出于网站设计优化的考虑，我们知道应该尽可能地将javascript的引用放在页面底部。Yahoo有一个专门的文章讲这方面的内容：<a href="http://developer.yahoo.com/performance/rules.html">Best Practices for Speeding Up Your Web Site</a></p>
<p>&nbsp;</p>
<p>所以，你可能会尝试将脚本移动到footer里面，例如下面这样</p><pre class="csharpcode">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=<span class="str">"utf-8"</span> /&gt;
    &lt;title&gt;@ViewBag.Title&lt;/title&gt;
    &lt;link href=<span class="str">"@Url.Content("</span>~/Content/Site.css<span class="str">")"</span> rel=<span class="str">"stylesheet"</span> type=<span class="str">"text/css"</span> /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div <span class="kwrd">class</span>=<span class="str">"page"</span>&gt;
        &lt;header&gt;
            &lt;div id=<span class="str">"title"</span>&gt;
                &lt;h1&gt;
                    My MVC Application&lt;/h1&gt;
            &lt;/div&gt;
            &lt;div id=<span class="str">"logindisplay"</span>&gt;
                @Html.Partial(<span class="str">"_LogOnPartial"</span>)
            &lt;/div&gt;
            &lt;nav&gt;
                &lt;ul id=<span class="str">"menu"</span>&gt;
                    &lt;li&gt;@Html.ActionLink(<span class="str">"Home"</span>, <span class="str">"Index"</span>, <span class="str">"Home"</span>)&lt;/li&gt;
                    &lt;li&gt;@Html.ActionLink(<span class="str">"About"</span>, <span class="str">"About"</span>, <span class="str">"Home"</span>)&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/nav&gt;
        &lt;/header&gt;
        &lt;section id=<span class="str">"main"</span>&gt;
            @RenderBody()
        &lt;/section&gt;
        &lt;footer&gt;
            &lt;script src=<span class="str">"@Url.Content("</span>~/Scripts/jquery-1.5.1.min.js<span class="str">")"</span> type=<span class="str">"text/javascript"</span>&gt;&lt;/script&gt;
            &lt;script src=<span class="str">"@Url.Content("</span>~/Scripts/modernizr-1.7.min.js<span class="str">")"</span> type=<span class="str">"text/javascript"</span>&gt;&lt;/script&gt;
        &lt;/footer&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>看起来很好，但是再次打开网站的话，就会发现网页的样式有些问题</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/20111213112634503.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126358900.png" width="931" height="627"></a></p>
<p>这是为什么呢？原因是MVC3默认使用了HTML 5的语法来构建页面，目前HTML 5因为还没有成为事实上的标准，所以使用了一个专门的javascript库来提供支持。这个javascript库就是：modernizr-1.7.min.js， 这是一个开源的作品，请参考这里 <a title="http://www.modernizr.com/" href="http://www.modernizr.com/">http://www.modernizr.com/</a></p>
<p>在页面中用到的header,section,footer这类的tag其实是html 5专用的，所以如果上面这个脚本没有预先加载，可能显示的时候，就会有些问题。</p>
<p>所以，我们应该将modernizr-1.7.min.js放在header里面去。这样就和谐了</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126362031.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126368717.png" width="931" height="627"></a></p>
<p>值得一说的是，这个库只有10KB左右，所以将它放在header里面对性能影响很小。</p>
<p>我们还可以使用微软提供的CDN功能，尽可能地减少用户需要下载的javascript的体积。关于CDN，请参考这里：<a title="http://www.asp.net/ajaxlibrary/cdn.ashx" href="http://www.asp.net/ajaxlibrary/cdn.ashx">http://www.asp.net/ajaxlibrary/cdn.ashx</a></p>
<p>&nbsp;</p>
<h1>3.Remote验证</h1>



<p>MVC3提供了一个新增的数据验证功能，叫做Remote验证，意思是可以利用客户端javascript，发起异步的请求，调用服务器代码进行验证。这个功能很不错，例如有一个页面提供用户输入用户名进行注册，我们经常需要检测用户名是否已经被别人占用。这种验证显然是无法在客户端直接提供，而是需要利用服务器代码来实现。</p>
<p>下面来看一个例子</p>
<p>首先，我们要为类型定义Annotation，需要注意的是，Remote这个Annotation是MVC专用的，所以要using System.Web.Mvc</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Web;
<span class="kwrd">using</span> System.ComponentModel.DataAnnotations;
<span class="kwrd">using</span> System.Web.Mvc;

<span class="kwrd">namespace</span> MvcApplicationEditTemplate.Models
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> Employee
    {
        <span class="kwrd">public</span> <span class="kwrd">int</span> ID { get; set; }
        [Required]
        [Remote(<span class="str">"IsNameValid"</span>,<span class="str">"Home"</span>)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> FirstName { get; set; }
        <span class="kwrd">public</span> <span class="kwrd">string</span> LastName { get; set; }
        <span class="kwrd">public</span> DateTime Birthday { get; set; }
    }
}</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>这里指定了一个远程验证用的Controller（Home）和Action（IsNameValid）</p>
<p>所以，接下来我们准备这样一个Action</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Web;
<span class="kwrd">using</span> System.Web.Mvc;

<span class="kwrd">namespace</span> MvcApplicationEditTemplate.Controllers
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> HomeController : Controller
    {
        <span class="rem">//</span>
        <span class="rem">// GET: /Home/</span>

        <span class="kwrd">public</span> ActionResult Index()
        {
            var emp = <span class="kwrd">new</span> Models.Employee();

            <span class="kwrd">return</span> View(emp);
        }


        <span class="kwrd">public</span> ActionResult IsNameValid(<span class="kwrd">string</span> FirstName)
        {
            <span class="kwrd">if</span>(FirstName == <span class="str">"ares"</span>)
            {
                <span class="kwrd">return</span> Json(<span class="kwrd">true</span>, JsonRequestBehavior.AllowGet);
            }
            <span class="kwrd">return</span> Json(<span class="str">"Your name is invalid"</span>, JsonRequestBehavior.AllowGet);
        }

    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
注意，这里只是做了一个例子，直接比较FirstName是不是等于ares。实际情况下，这里可以执行数据库查询，得到结果。</p>
<p>还需要注意的是，这里必须返回json的数据，并且必须设置为AllowGet。</p>
<p>接下来，在视图中，要添加两个脚本引用，如下所示</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126362653.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126378783.png" width="699" height="732"></a></p>
<p>远程验证的效果如下</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126372719.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201112/201112131126372752.png" width="467" height="536"></a></p>