# 在Silverlight中使用HierarchicalDataTemplate为TreeView实现递归树状结构 
> 原文发表于 2011-06-22, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/22/2087692.html 


<p>这是项目中一个页面上的一个功能。我们需要在界面上通过一个TreeView控件显示一个递归的树状结构，也就是说会很多层嵌套的节点，而且层数是不确定的。</p> <p>这个功能，可以通过HierarchicalDataTemplate来很方便地实现</p> <h2>1. 业务实体</h2> <p>作为举例，我定义了一个大家都很熟悉的Folder类型，即文件夹。我们都知道，文件夹又可以包含子文件夹，而且可以多层嵌套。所以，这是一个递归的结构体。</p><pre class="csharpcode">    <span class="kwrd">public</span> <span class="kwrd">class</span> Folder
    {
        <span class="kwrd">public</span> <span class="kwrd">string</span> Name { get; set; }
        <span class="kwrd">public</span> ObservableCollection&lt;Folder&gt; Folders { get; set; }
    }
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<h2>2. 准备数据</h2>
<p>我用下面的代码，模拟一个数据读取操作。下面是硬编码出来的数据。实际情况下，可以读取数据库。</p><pre class="csharpcode">        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var result = <span class="kwrd">new</span>[]{
                <span class="kwrd">new</span> Folder(){Name=<span class="str">"Test"</span>,Folders =<span class="kwrd">new</span> ObservableCollection&lt;Folder&gt;(
                    <span class="kwrd">new</span>[]{
                        <span class="kwrd">new</span> Folder(){Name=<span class="str">"Test4"</span>},
                        <span class="kwrd">new</span> Folder(){Name=<span class="str">"Test3"</span>},
                        <span class="kwrd">new</span> Folder(){Name=<span class="str">"Test4"</span>,Folders=<span class="kwrd">new</span> ObservableCollection&lt;Folder&gt;(
                            <span class="kwrd">new</span> []{<span class="kwrd">new</span> Folder(){Name =<span class="str">"Test5"</span>}})
                        }
                    })}};

            tvFolders.ItemsSource = result;
        }</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<h2>3. 绑定控件</h2><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">UserControl</span> <span class="attr">x:Class</span><span class="kwrd">="SilverlightTreeviewSample.MainPage"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="attr">xmlns:d</span><span class="kwrd">="http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="attr">mc:Ignorable</span><span class="kwrd">="d"</span>
    <span class="attr">d:DesignHeight</span><span class="kwrd">="300"</span> <span class="attr">d:DesignWidth</span><span class="kwrd">="400"</span> <span class="attr">xmlns:sdk</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">UserControl.Resources</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">sdk:HierarchicalDataTemplate</span> <span class="attr">x:Key</span><span class="kwrd">="FolderItemTemplate"</span> <span class="attr">ItemsSource</span><span class="kwrd">="{Binding Folders}"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="{Binding Name}"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">sdk:HierarchicalDataTemplate</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Style</span> <span class="attr">TargetType</span><span class="kwrd">="sdk:TreeViewItem"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="IsExpanded"</span> <span class="attr">Value</span><span class="kwrd">="True"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>
       
    <span class="kwrd">&lt;/</span><span class="html">UserControl.Resources</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">Grid</span> <span class="attr">x:Name</span><span class="kwrd">="LayoutRoot"</span> <span class="attr">Background</span><span class="kwrd">="White"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">sdk:TreeView</span>  <span class="attr">Name</span><span class="kwrd">="tvFolders"</span> <span class="attr">ItemTemplate</span><span class="kwrd">="{StaticResource FolderItemTemplate}"</span><span class="kwrd">&gt;</span>
  
        <span class="kwrd">&lt;/</span><span class="html">sdk:TreeView</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">UserControl</span><span class="kwrd">&gt;</span>
</pre>
<p>请注意，我们这里用到一个特殊的DataTemplate：HierarchicalDataTemplate，并且将其设置为Treeview的ItemTemplate。
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>&nbsp;</p>
<h2>4. 查看效果</h2>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106222319461124.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106222319469521.png" width="641" height="229"></a></p>