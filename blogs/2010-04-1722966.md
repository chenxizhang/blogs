# 关于Silverlight对匿名类型数据绑定的问题及其解决方法 
> 原文发表于 2010-04-28, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/04/28/1722966.html 


<p>这是一个不得不说一下的问题。同样的代码在WPF应用程序中是可以工作的，而在Silverlight中却不可以。我们来看一下例子吧</p> <p>&nbsp;</p> <p>1.WPF窗体标记</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">Window</span> <span class="attr">x:Class</span><span class="kwrd">="WpfApplication1.MainWindow"</span>
        <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="attr">Title</span><span class="kwrd">="MainWindow"</span> <span class="attr">Height</span><span class="kwrd">="350"</span> <span class="attr">Width</span><span class="kwrd">="525"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ItemsControl</span> <span class="attr">x:Name</span><span class="kwrd">="EmployeeList"</span> <span class="attr">Margin</span><span class="kwrd">="10"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ItemsControl.ItemTemplate</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="{Binding FullName}"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ItemsControl.ItemTemplate</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ItemsControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">Window</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
2.WPF窗体代码</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;

<span class="kwrd">namespace</span> WpfApplication1
{
    <span class="rem">/// &lt;summary&gt;</span>
    <span class="rem">/// Interaction logic for MainWindow.xaml</span>
    <span class="rem">/// &lt;/summary&gt;</span>
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainWindow : Window
    {
        <span class="kwrd">public</span> MainWindow()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainWindow_Loaded);
        }

        <span class="kwrd">void</span> MainWindow_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var emps = <span class="kwrd">new</span>[]{
                <span class="kwrd">new</span>{
                    FullName=<span class="str">"陈希章"</span>

                },
                <span class="kwrd">new</span>{
                    FullName=<span class="str">"张三丰"</span>
                },
                <span class="kwrd">new</span>{
                    FullName=<span class="str">"张无忌"</span>
                }
            };

            EmployeeList.ItemsSource = emps;
        }
    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
3.WPF运行起来的效果</p>
<p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_2.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_thumb.png" width="529" height="354"></a> </p>
<p>&nbsp;</p>
<p>然后我们来看Silverlight</p>
<p>1. Silverlight页面标记</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">UserControl</span> <span class="attr">x:Class</span><span class="kwrd">="SilverlightApplication1.MainPage"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="attr">xmlns:d</span><span class="kwrd">="http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="attr">mc:Ignorable</span><span class="kwrd">="d"</span>
    <span class="attr">d:DesignHeight</span><span class="kwrd">="300"</span> <span class="attr">d:DesignWidth</span><span class="kwrd">="400"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Grid</span> <span class="attr">x:Name</span><span class="kwrd">="LayoutRoot"</span> <span class="attr">Background</span><span class="kwrd">="White"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ItemsControl</span> <span class="attr">x:Name</span><span class="kwrd">="EmployeeList" <span class="attr">Margin</span><span class="kwrd">="10"</span><span class="kwrd">&gt;</span></span>
            <span class="kwrd">&lt;</span><span class="html">ItemsControl.ItemTemplate</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="{Binding FullName}"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ItemsControl.ItemTemplate</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ItemsControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">UserControl</span><span class="kwrd">&gt;</span>
</pre>
<p>2. Silverlight页面代码</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;

<span class="kwrd">namespace</span> SilverlightApplication1
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainPage_Loaded);
        }

        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var emps = <span class="kwrd">new</span>[]{
                <span class="kwrd">new</span>{
                    FullName=<span class="str">"陈希章"</span>

                },
                <span class="kwrd">new</span>{
                    FullName=<span class="str">"张三丰"</span>
                },
                <span class="kwrd">new</span>{
                    FullName=<span class="str">"张无忌"</span>
                }
            };

            EmployeeList.ItemsSource = emps;
            
        }
    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>3. 运行起来看的效果</p>
<p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_6.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_thumb_2.png" width="516" height="367"></a> </p>
<p>是的，什么也没有。而如果我们不使用Binding语法，直接写好固定的文本值。例如下面这样</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">UserControl</span> <span class="attr">x:Class</span><span class="kwrd">="SilverlightApplication1.MainPage"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="attr">xmlns:d</span><span class="kwrd">="http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="attr">mc:Ignorable</span><span class="kwrd">="d"</span>
    <span class="attr">d:DesignHeight</span><span class="kwrd">="300"</span> <span class="attr">d:DesignWidth</span><span class="kwrd">="400"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Grid</span> <span class="attr">x:Name</span><span class="kwrd">="LayoutRoot"</span> <span class="attr">Background</span><span class="kwrd">="White"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ItemsControl</span> <span class="attr">x:Name</span><span class="kwrd">="EmployeeList"</span> <span class="attr">Margin</span><span class="kwrd">="10"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ItemsControl.ItemTemplate</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Hello,World"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ItemsControl.ItemTemplate</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ItemsControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">UserControl</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
则运行起来会怎么样呢？我们能看到三行数据</p>
<p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_8.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_thumb_3.png" width="516" height="367"></a> </p>
<p>这说明什么问题呢？我想至少说明，绑定的操作是已经发生了，只不过没有绑定到FullName而已，或者说FullName没有数据？</p>
<p>好吧，那么怎么解决该问题呢？答案是在Silverlight中要用强类型的方式来保存数据。</p>
<p>例如下面这样的代码</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Windows.Controls;

<span class="kwrd">namespace</span> SilverlightApplication1
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainPage_Loaded);
        }

        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {

            List&lt;Employee&gt; emps = <span class="kwrd">new</span> List&lt;Employee&gt;(){
                <span class="kwrd">new</span> Employee(){FullName=<span class="str">"陈希章"</span>},
                <span class="kwrd">new</span> Employee(){FullName=<span class="str">"张三丰"</span>},
                <span class="kwrd">new</span> Employee(){FullName=<span class="str">"张无忌"</span>}
            };


            EmployeeList.ItemsSource = emps;
            
        }

        <span class="kwrd">public</span> <span class="kwrd">class</span> Employee
        {
            <span class="kwrd">public</span> <span class="kwrd">string</span> FullName { get; set; }
        }
    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
然后，再次运行就可以了</p>
<p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_10.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/Silverlight_9DE7/image_thumb_4.png" width="516" height="367"></a> </p>
<p>这样就和谐了！</p>
<p>【注意】这个问题有些不合情理。但我目前也没有想明白为什么，或者是不是因为某些bug导致也未可知。先解决问题吧，以后再看看。如果有哪位朋友对此有什么高见，请不吝赐教</p>