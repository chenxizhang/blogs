# 如何让一个现有的程序集运行在Silverlight环境中 
> 原文发表于 2010-10-09, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/10/09/1846781.html 


<p>故事是这样的：我们有一个组件，是一个标准的Class Library，里面有一些代码是实现了某些计算或者业务逻辑。例如下面这样</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_6.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_2.png" width="916" height="670"></a></p> <p>然后，我们做了一个Silverlight的应用程序，和一个用于运行该程序的网站</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_8.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_3.png" width="916" height="670"></a></p> <p>我们想让这个按钮，能调用DAL中Customer的PlaceOrder方法。这样的要求很自然不过了吧</p> <p>我们马上会想到，要在SilverlightApplication中添加对DAL项目的引用。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_10.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_4.png" width="565" height="450"></a></p> <p>&nbsp;</p> <p>很不幸，我们居然会遇到一个错误<br><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_12.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_5.png" width="493" height="175"></a></p> <p>这个错误提示的意思是说，你只能引用Silverlight项目。</p> <p>&nbsp;</p> <p>我们先来说一下如何解决这个问题吧，最后会解释具体的原因。</p> <p>好吧，既然说只能引用Silverlight项目，那么我们就从善如流吧。接下来他们添加一个Silverlight的Class Library</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_14.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_6.png" width="959" height="664"></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_16.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_7.png" width="916" height="670"></a></p> <p>&nbsp;</p> <p>那么，我们要思考一个问题，既然我们在DAL中写好了那些代码，是否可以在这个项目中进行重用呢？</p> <p>有的童鞋马上会说，把那些cs文件复制过来吧。嗯，脑筋动得还是挺快的，不过。。</p> <p>下面要出绝招了。我们可以将DAL项目中的那些cs文件链接过来，这样就只要维护一份cs文件了，而不要复制多份。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_18.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_8.png" width="883" height="747"></a></p> <p>请注意，这里选择“Add as link”</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_20.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_9.png" width="916" height="670"></a></p> <p>&nbsp;</p> <p>赶紧编译一下吧。然后，我们在Silverlight Application中添加对这个DAL的引用</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_22.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/Windows-Live-Writer/Silverlight_F208/image_thumb_10.png" width="565" height="450"></a></p> <p>&nbsp;</p> <p>然后编写按钮代码如下</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Net;
<span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> System.Windows.Documents;
<span class="kwrd">using</span> System.Windows.Input;
<span class="kwrd">using</span> System.Windows.Media;
<span class="kwrd">using</span> System.Windows.Media.Animation;
<span class="kwrd">using</span> System.Windows.Shapes;

<span class="kwrd">using</span> DAL;

<span class="kwrd">namespace</span> SilverlightApplication
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> btTest_Click(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var customer = <span class="kwrd">new</span> Customer();
            MessageBox.Show(customer.PlaceOrder().ToString());
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>看起来还不错，不是吗？</p>
<p>&nbsp;</p>
<p>那么，这是为什么呢？这里的根本原因是<strong><font color="#ff0000">Silverlight的运行时（CLR)其实是一个独立的版本，它与所有标准的.NET FRAMEWORK版本下面的CLR都不一样。它只能做一部分事情，而不是全部的事情。（上述的DAL是很简单的一个示例，如果涉及到一些复杂操作，添加为link的方式不一定能编译通过）</font></strong></p>
<p>当然，事实上说起来，真的有必要在Silverlight的程序里面嵌入什么很复杂的程序集吗？我想未必。</p>
<p>尤其是在企业或者商业应用开发的场景下，Silverlight大多是作为一个UI的载体而已，几乎所有的功能（例如与外界资源的交互）都是通过服务来实现的。这里的服务主要指的是WCF服务，当然也不限于此。</p>