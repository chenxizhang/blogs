# 使用jquery构造自己的多级菜单 
> 原文发表于 2010-11-07, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/11/07/1870952.html 


<p>最近在讲AJAX方面的一些理论和在项目中的应用。我介绍到了AJAX的一些内部原理，以及两套AJAX框架：Microsoft ASP.NET AJAX和jquery.</p> <p>我个人很喜欢Jquery，我对它的赞美从不吝啬。呵呵</p> <p>关于Jquery，其实之前就写过不少，有兴趣的可以参考</p> <p><a title="http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20jquery" href="http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20jquery">http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20jquery</a></p> <p>&nbsp;</p> <p>课程中讲到一个问题，就是如何动态生成多级菜单。我知道网上有不少类似的菜单。但既然咱学了Jquery，为什么不可以尝试自己实践一下呢？</p> <p>我把例子整理如下，希望给大家一些启发和帮助。</p> <p>&nbsp;</p> <p>&nbsp;</p> <p>我们希望的结果简单如下：左侧会根据数据库结构展示一个菜单，默认只是显示第一级。用户可以根据需要点击任何一级，可以显示子级。而且同级会被隐藏。</p> <p>最后一层是链接，点击之后，在右侧显示有关的页面内容</p> <p><a href="http://www.xizhang.com/blogimages/jquery_85F3/image.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/jquery_85F3/image_thumb.png" width="244" height="173"></a><a href="http://www.xizhang.com/blogimages/jquery_85F3/image_3.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/jquery_85F3/image_thumb_3.png" width="244" height="173"></a><a href="http://www.xizhang.com/blogimages/jquery_85F3/image_4.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/jquery_85F3/image_thumb_4.png" width="244" height="173"></a></p> <p>&nbsp;</p> <h1>第一步：准备菜单数据页面</h1> <p>我们可以用一个页面，动态生成这个菜单的数据。本例我取名为menu.aspx</p><pre class="csharpcode">&lt;%@ Page Language=<span class="str">"C#"</span> ContentType=<span class="str">"text/xml"</span>%&gt;
&lt;%@ Import Namespace=<span class="str">"System.Xml.Linq"</span> %&gt;
&lt;%@ Import Namespace=<span class="str">"System.Linq"</span> %&gt;

&lt;script runat=<span class="str">"server"</span>&gt;
    <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnLoad(EventArgs e)
    {
        <span class="rem">//动态构造一个菜单（随机生成五层）</span>
        var rnd = <span class="kwrd">new</span> Random();


        var menu = <span class="kwrd">new</span> XElement(<span class="str">"MenuItems"</span>,
            from level1 <span class="kwrd">in</span> Enumerable.Range(1, 10)
            select <span class="kwrd">new</span> XElement(<span class="str">"div"</span>, <span class="str">"第"</span> + level1.ToString() + <span class="str">"章"</span>,
                from level2 <span class="kwrd">in</span> Enumerable.Range(1, rnd.Next(10))
                select <span class="kwrd">new</span> XElement(<span class="str">"div"</span>, <span class="str">"第"</span> + level2.ToString() + <span class="str">"节"</span>,
                    from level3 <span class="kwrd">in</span> Enumerable.Range(1, rnd.Next(5))
                    select <span class="kwrd">new</span> XElement(<span class="str">"div"</span>, <span class="str">"第"</span> + level3.ToString() + <span class="str">"小节"</span>,
                        from level4 <span class="kwrd">in</span> Enumerable.Range(1, rnd.Next(5))
                        select <span class="kwrd">new</span> XElement(<span class="str">"div"</span>, <span class="str">"第"</span> + level4.ToString() + <span class="str">"小小节"</span>,
                            <span class="kwrd">new</span> XElement(<span class="str">"ul"</span>,
                            from level5 <span class="kwrd">in</span> Enumerable.Range(1, rnd.Next(10))
                            select <span class="kwrd">new</span> XElement(<span class="str">"li"</span>,
                                <span class="kwrd">new</span> XElement(<span class="str">"a"</span>,
                                <span class="kwrd">new</span> XAttribute(<span class="str">"href"</span>, <span class="str">"a.aspx"</span>),
                                <span class="kwrd">new</span> XAttribute(<span class="str">"target"</span>, <span class="str">"content"</span>),
                                <span class="kwrd">new</span> XText(<span class="str">"第"</span> + level5.ToString() + <span class="str">"个链接"</span>)))))))));         
           
        Response.Write(menu.ToString());
                    
    }
&lt;/script&gt;</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>【注意】我这里只是为了演示目的，随机生成了五层，每层的元素也是随机生成的。真正在用的时候，可以读取数据库</p>
<p>这个页面，在浏览器中看起来是这样</p>
<p><a href="http://www.xizhang.com/blogimages/jquery_85F3/image_5.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/jquery_85F3/image_thumb_5.png" width="244" height="173"></a></p>
<p>【注意】因为我用的是随机数，所以你看到的结果可能跟这个不一样</p>
<p>&nbsp;</p>
<h1>第二步：准备一个测试用的链接页面</h1>
<p>本例中，我们需要一个a.aspx页面。</p>
<p>我只是简单地在这个页面中放了一些文字</p>
<p><a href="http://www.xizhang.com/blogimages/jquery_85F3/image_6.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/jquery_85F3/image_thumb_6.png" width="244" height="179"></a></p>
<p>&nbsp;</p>
<h1>第三步：编写主页面</h1><pre class="csharpcode"><span class="asp">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %&gt;</span>

<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">html</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="kwrd">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="jquery-1.4.1.js"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    &lt;style type=<span class="str">"text/css"</span>&gt;
        .selected
        {
            font-weight:bold;
        }
        div#menu div
        {
            padding-left: 20px;
            background-image: url(<span class="str">"images/min.gif"</span>);
            background-repeat: no-repeat;
            background-position: left top;
        }
        
        ul
        {
            padding-left:20px;
            padding-top:0px;
            padding-bottom:0px;
            margin:0px;
            display:none
        }
        
        html,body,form
        {
            height:100%;
            width:100%;
            overflow:hidden;
        }
        
        div#menu,div#content
        {
            <span class="kwrd">float</span>:left;
            height:100%;
            padding:10px
        }
        



    &lt;/style&gt;
    &lt;script language=<span class="str">"javascript"</span> type=<span class="str">"text/javascript"</span>&gt;
        $(<span class="kwrd">function</span> () {

            <span class="rem">//加载菜单数据</span>
            $(<span class="str">"div#menu"</span>).load(<span class="str">"menu.aspx"</span>, <span class="kwrd">null</span>, <span class="kwrd">function</span> () {
                $(<span class="str">"div#menu div"</span>).css(<span class="str">"display"</span>, <span class="str">"none"</span>).click(<span class="kwrd">function</span> () {

                    $(<span class="str">"div#menu div"</span>).removeClass(<span class="str">"selected"</span>);

                    $(<span class="kwrd">this</span>).addClass(<span class="str">"selected"</span>)
                        .children().show(<span class="str">"slow"</span>).end()
                        .siblings().children().slideUp(<span class="str">"slow"</span>);

                });

                $(<span class="str">"div#menu&gt;MenuItems&gt;div"</span>).css(<span class="str">"display"</span>, <span class="str">"block"</span>);
            });



        });
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="menu"</span> <span class="attr">style</span><span class="kwrd">="width:25%"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="content"</span> <span class="attr">style</span><span class="kwrd">="width:70%"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">iframe</span> <span class="attr">name</span><span class="kwrd">="content"</span> <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">height</span><span class="kwrd">="100%"</span> <span class="attr">frameborder</span><span class="kwrd">="0"</span><span class="kwrd">&gt;&lt;/</span><span class="html">iframe</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>很简单，我们在这个页面中左右两侧各放置了一个div。它们都是空的。在页面加载成功之后，我们再读取了menu.aspx页面。</p>
<p>【注意】本例中用了一个图片，min.gif.你可以替换掉该图片。尽量小一点。</p>