# MOSS 2010 沙箱解决方案(Sandboxed Solution) 
> 原文发表于 2010-04-05, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/04/05/1704505.html 


<p>这是一种新的解决方案类型，它出现的目的是让一般的站点集管理员可以部署解决方案，而不是要求场管理员来部署，由于它的这种特殊性，所以，它有很多限制，主要体现在安全性上面。</p> <p>例如最典型就是在这种解决方案中不能访问到SPFarm对象，因为那是属于场对象，也不能访问诸如<a href="http://www.xizhang.com">http://www.xizhang.com</a> 这种外部的资源。简而言之，它只能访问到自己SPSite里面的一些对象。即便是这样，它仍然能够被限制使用的资源，例如CPU时间和数据库查询的时间等等。这样做的目的就是为了避免一些恶意或者无意的破坏吧</p> <p>关于Sandboxed Solution，这里还有一篇介绍 </p> <p><a href="http://msdn.microsoft.com/en-us/magazine/ee335711.aspx">http://msdn.microsoft.com/en-us/magazine/ee335711.aspx</a></p> <p>&nbsp;</p> <p>那么，我们来观察一下，Sandboxed solution到底有什么不一样呢？请注意下图中的属性，Sandboxed solution设置为true</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_2.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb.png" width="1044" height="810"></a> </p> <p>如果对该属性进行切换的话，实际上会有两个不一样的提示</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_4.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_1.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_6.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_2.png" width="1044" height="810"></a> </p> <p>而我们观察下来，设置为true的话，会在元数据中添加</p> <p>[assembly: AllowPartiallyTrustedCallers()]</p> <p>这是什么东东呢？其实很简单，就是表示当前程序集允许部分信任调用。因为沙箱解决方案肯定是部分信任的，按照我的理解，它甚至可能会被单独放在一个应用程序域中执行，来实现安全性的隔离。</p> <p>&nbsp;</p> <p>关于这个属性，我很早之前也有一个文章专门介绍</p> <p><a href="http://www.cnblogs.com/chenxizhang/archive/2009/11/09/1599243.html">http://www.cnblogs.com/chenxizhang/archive/2009/11/09/1599243.html</a></p> <p>&nbsp;</p> <p>最后，我们来讨论一下沙箱解决方案与标准解决方案在部署上的不同</p> <p>1. 标准解决方案（场解决方案），仍然和MOSS 2007那样，是通过stsadm –o addsolution进行部署的</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_8.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_3.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_10.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_4.png" width="1044" height="810"></a> </p> <p>2. 沙箱解决方案，也可以通过stsadm进行部署，而且如果这样部署的话，那么与标准的解决方案就没有差别。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_12.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_5.png" width="1044" height="810"></a> </p> <p>但是通常它更多是通过网站集管理员进行部署。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_14.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_6.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_16.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_7.png" width="1044" height="810"></a> </p> <p>点击“上载解决方案”</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_18.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_8.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_20.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_9.png" width="1044" height="810"></a> </p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_22.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_10.png" width="1044" height="810"></a> </p> <p>点击“激活”</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_24.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_11.png" width="1044" height="810"></a> </p> <p>看起来也很方便，不是吗？</p> <p>&nbsp;</p> <p>最后，我们要提一下，沙箱解决方案依赖的服务：</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_26.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_12.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_28.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_13.png" width="1044" height="810"></a> </p> <p>而沙箱解决方案其实是单独运行在下面进程的</p> <p>•User Code Service<br>(SPUCHostService.exe) <p>•Sandbox Worker Process<br>(SPUCWorkerProcess.exe) <p>•Sandbox Worker Process Proxy<br>(SPUCWorkerProcessProxy.exe) <p>&nbsp; <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_30.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010SandboxedSolution_7F8D/image_thumb_14.png" width="1044" height="810"></a> </p> <p>&nbsp;</p> <p>从细节上来看，它到底能做哪些事情呢</p> <p>&nbsp;</p> <div class="O0"><span><span>•</span></span><span>Microsoft.SharePoint</span><span> </span><span>Except</span></div> <div class="O2"><span><span>•</span></span><span>SPSite</span><span> constructor</span></div> <div class="O2"><span><span>•</span></span><span>SPSecurity</span><span> object</span></div> <div class="O2"><span><span>•</span></span><span>SPWorkItem</span><span> and </span><span>SPWorkItemCollection</span><span> objects</span></div> <div class="O2"><span><span>•</span></span><span>SPAlertCollection.Add</span><span> </span><span>method</span></div> <div class="O2"><span><span>•</span></span><span>SPAlertTemplateCollection.Add</span><span> method</span></div> <div class="O2"><span><span>•</span></span><span>SPUserSolution</span><span> and </span><span>SPUserSolutionCollection</span><span> objects</span></div> <div class="O2"><span><span>•</span></span><span>SPTransformUtilities</span><span> </span></div> <div class="O0"><span><span>•</span></span><span>Microsoft.SharePoint.Navigation</span><span> </span></div> <div class="O0"><span><span>•</span></span><span>Microsoft.SharePoint.Utilities</span><span> </span><span>Except</span></div> <div class="O2"><span><span>•</span></span><span>SPUtility.SendEmail</span><span> method</span></div> <div class="O2"><span><span>•</span></span><span>SPUtility.GetNTFullNameandEmailFromLogin</span><span> method</span></div> <div class="O0"><span><span>•</span></span><span>Microsoft.SharePoint.Workflow</span><span> </span></div> <div class="O0"><span><span>•</span></span><span>Microsoft.SharePoint.WebPartPages</span><span> </span><span>Except</span></div> <div class="O2"><span><span>•</span></span><span>SPWebPartManager</span><span> object</span></div> <div class="O2"><span><span>•</span></span><span>SPWebPartConnection</span><span> object</span></div> <div class="O2"><span><span>•</span></span><span>WebPartZone</span><span> object</span></div> <div class="O2"><span><span>•</span></span><span>WebPartPage</span><span> object</span></div> <div class="O2"><span><span>•</span></span><span>ToolPane</span><span> object</span></div> <div class="O2"><span><span>•</span></span><span>ToolPart</span><span> object</span><span> </span></div> <p></p> <p></p> <p></p> <p></p> <p></p> <p>它支持的项目特性包括</p> <p>&nbsp;</p> <div class="O0"><font size="2"><span><span>•</span></span><span>Content Types, Site Columns</span></font></div> <div class="O0"><font size="2"><span><span>•</span></span><span>Custom Actions</span></font></div> <div class="O0"><font size="2"><span><span>•</span></span><span>Declarative Workflows</span></font></div> <div class="O0"><font size="2"><span><span>•</span></span><span>Event Receivers, Feature Receivers</span></font></div> <div class="O0"><font size="2"><span><span>•</span></span><span>InfoPath Forms Services (not admin-</span><span>appr</span></font><font size="2"><span>)<br>JavaScript, AJAX, </span><span>jQuery</span><span>, Silverlight</span></font></div> <div class="O0"><font size="2"><span><span>•</span></span><span>List Definitions</span></font></div> <div class="O0"><font size="2"><span><span>•</span></span><span>Non-visual web parts</span></font></div> <div><font size="2"><span><span>•</span></span><span>Site Pages</span></font></div> <div><font size="2"><span><span>•</span></span><span>SharePoint </span><span>OnLine</span></font><span> </span></div>