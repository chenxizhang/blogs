# WCF技术的不同应用场景及其实现分析(续） 
> 原文发表于 2011-06-21, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/21/2086314.html 


<p><a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/21/2085979.html#commentform">上一篇</a> 我总结介绍了WCF技术的背景，核心要素，和典型场景，目的是希望让大家更好地掌握WCF技术，并且在工作中知道如何选择。</p> <p>由于篇幅较长，这一篇继续写完第二部分。</p> <h4>应用场景：</h4> <p>WCF 从发布到现在的将近5年左右的时间，经过了多次增强和改进，从最开始单纯的SOAP Service的方式，发展出来其他多种应用场景，分别是 <blockquote> <p>1. SOAP Services <p>2. WebHttp Services <p>3. Data Services <p>4. Workflow Services <p>5. RIA Services</p></blockquote> <p>本文将讨论后面3种应用场景。 <p>&nbsp; <h2>3. Data Services</h2> <p>Data Service，顾名思义，是指数据服务。最开始的名称叫做ADO.NET Data Service，是从.NET Framework 3.5 SP1开始提供的功能。在.NET Framework 4.0中，已经改名为WCF Data Service. <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902033086.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902031724.png" width="722" height="358"></a> <p>&nbsp; <p>这个服务类型是WebHttp Service的一种特殊实现，也就是说，它延续了WebHttp Service的Restful的特点。但与标准的WebHttp Service，不同的是，它具有一套完整的API，包括客户端的访问API。这样也就允许，它既支持类似于Javascript这样的脚本访问，也支持在传统客户端中进行访问。 <p>需要注意的是，WCF Data Service既然是数据服务，它天生就是为数据访问有关。这是它最强的地方，它的出现大大简化了我们编写数据访问服务的工作。好不夸张地说，确实很酷。你可以想象一下，你有一个数据库，有N张表，你想实现对这些表的增删改查操作，如果你一个一个去编写，显然是一件非常辛苦而且没有效率的事情。 <p>&nbsp; <p>WCF Data Service支持两种数据模型，一种是LINQ to SQL, 一种是ADO.NET Entity Frmawork。下面的例子使用了LINQ to SQL. 使用的数据库是微软提供的范例数据库<a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034">Northwind</a>. <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902044298.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902048235.png" width="919" height="727"></a> <p>有了上面这个模型之后，我们就可以添加一个WCF Data Service了。这是一个继承子DataService的类型，并且通过svc这种Self Host的方式提供宿主。<pre class="csharpcode"><span class="kwrd">using</span> System.Data.Services;
<span class="kwrd">using</span> System.Data.Services.Common;

<span class="kwrd">namespace</span> WebApplication_WCFDataService_
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> NorthwindDataService : DataService&lt;<strong><font color="#ff0000">NorthwindDataClassesDataContext</font></strong>&gt;
    {
        <span class="rem">// This method is called only once to initialize service-wide policies.</span>
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> InitializeService(DataServiceConfiguration config)
        {
            <span class="rem">// TODO: set rules to indicate which entity sets and service operations are visible, updatable, etc.</span>
            <span class="rem">// Examples:</span>
            <font color="#ff0000"><strong>config.SetEntitySetAccessRule(<span class="str">"*"</span>, EntitySetRights.AllRead);</strong></font>
            <span class="rem">// config.SetServiceOperationAccessRule("MyServiceOperation", ServiceOperationRights.All);</span>
            config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp; <p>这样就完成了所有的操作，在浏览器中可以通过REST的风格测试该服务。例如，下面的语法是查看所有Customers的
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902044680.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902058857.png" width="1028" height="701"></a>
<p>下面是查看某个Customer信息的
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902053874.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902057811.png" width="1028" height="701"></a>
<p>我们可以看到，默认情况下,WCF服务是用XML返回数据的。关于如何让它返回JSON数据，我之前有一篇文章专门探讨。请参考：<a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/12/2078830.html">http://www.cnblogs.com/chenxizhang/archive/2011/06/12/2078830.html</a>
<p>&nbsp; <p>值得注意的是，与WebHttp Service不同的是，Data Service可以在标准客户端中进行访问。而且它的方式是有些特殊的，具体来说，客户端也是通过一个DataServiceContext的类型来访问的. 例如下面这样（这个文件是我们添加服务引用时自动生成的）
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902054463.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902061432.png" width="1012" height="278"></a>
<p>我们可以通过如下这样的代码进行调用<pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Linq;

<span class="kwrd">namespace</span> ConsoleApplication1
{
    <span class="kwrd">class</span> Program
    {
        <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
        {
            var ctx = <span class="kwrd">new</span> DataModel.NorthwindDataClassesDataContext(
                <span class="kwrd">new</span> Uri(<span class="str">"http://localhost.:9475/NorthwindDataService.svc/"</span>));

            var query = from c <span class="kwrd">in</span> ctx.Customers
                        select c;

            <span class="kwrd">foreach</span> (var item <span class="kwrd">in</span> query)
            {
                Console.WriteLine(item.CompanyName);
            }
        }
    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>【注意】这里调用的方式，返回的数据是XML格式的，而不是SOAP Envelope的那种方式。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902068956.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902065925.png" width="1012" height="761"></a></p>
<p>&nbsp;</p>
<p>关于Data Service与WebHttp Service的相同之处，还体现在它也可以添加自定义的Operation，例如下面这篇文章介绍的那样</p>
<p><a href="http://www.cnblogs.com/chenxizhang/archive/2010/02/28/1675270.html">http://www.cnblogs.com/chenxizhang/archive/2010/02/28/1675270.html</a></p>
<p>&nbsp;</p>
<p>常见的问题还有：Data Service如何做身份验证？我之前写过一篇文章介绍这个问题：<a href="http://www.cnblogs.com/chenxizhang/archive/2010/02/28/1675307.html">http://www.cnblogs.com/chenxizhang/archive/2010/02/28/1675307.html</a></p>
<p>&nbsp;</p>
<p><strong><font color="#ff0000">总结</font></strong>：Data Service是一种结合数据模型快速实现数据访问的方式。它依赖LINQ to SQL或者ADO.NET Entity Framework，并且提供了RESTFul的实现（它所使用的绑定就是WebHttpBinding)。它有一套专用的安全模型，与标准的WCF不一样。</p>
<p>&nbsp;</p>





<h2>4. Workflow Services</h2>
<p>这是一个很有意思的服务。这是在.NET Framework 4.0中开始出现的，也就是随着Workflow Foundation升级到4.0之后，提供了一种全新的服务类型，简单地来说，它是可以直接与Workflow Foundation(工作流）想结合的一种服务。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902065401.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902068466.png" width="735" height="243"></a></p>
<p>创建好的项目中，包含了一个特殊的文件，叫xamlx。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902079579.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902085010.png" width="919" height="727"></a></p>
<p>虽然该文件很怪异，但它在浏览器中打开来看的效果却有标准的WCF服务没有什么区别，如下</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902083615.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902087269.png" width="1028" height="701"></a></p>
<p>不少朋友都不理解为什么需要这样一个服务，我相信正在看这篇文章的你也一定心存疑惑吧？</p>
<p>这是一个WCF服务，但为什么要与Workflow(工作流）扯上关系呢？</p>
<p>答案就是：<strong><font color="#ff0000">如果你这个WCF服务，要提供的功能，希望用工作流的方式来设计和实现的话，你就可以用这个服务</font></strong>。</p>
<p>换句话说，这里的重点，仍然是WCF服务，而不是Workflow。Workflow是实现的一种方式。具体来说，在这种方式中，你可以不写任何代码就能实现一些流程功能。</p>
<p>Workflow的讨论显然超出了本文的范畴，这里就不多展开了。</p>
<p>以上面这个服务为例，它是公开了一个方法叫“GetData”，该方法接受一个参数，叫“data”，是整数型的。默认情况下，这个服务会将用户传入的参数data作为响应直接发给调用方。</p>
<p>&nbsp;</p>
<p>那么，如何理解工作流设计呢？假设我们希望为该服务添加一个简单逻辑，用户如果传入的data是偶数，则返回“偶数”，否则返回“奇数”这样的文本字符串。我们可以将这个服务稍做修改。如下图所示</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902091238.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902098240.png" width="948" height="732"></a></p>
<p>大家请注意，实现这个功能，我们并不需要编写代码。</p>
<p>实际上，上面这个服务就是一段XAML的定义。这种做法自有它的好处，但这里不深入讨论了。</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">WorkflowService</span> <span class="attr">mc:Ignorable</span><span class="kwrd">="sap"</span> <span class="attr">ConfigurationName</span><span class="kwrd">="Service1"</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="561,620"</span> <span class="attr">Name</span><span class="kwrd">="Service1"</span> <span class="attr">mva:VisualBasic</span>.<span class="attr">Settings</span><span class="kwrd">="Assembly references and imported namespaces serialized as XML namespaces"</span> <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/netfx/2009/xaml/servicemodel"</span> <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span> <span class="attr">xmlns:mv</span><span class="kwrd">="clr-namespace:Microsoft.VisualBasic;assembly=System"</span> <span class="attr">xmlns:mva</span><span class="kwrd">="clr-namespace:Microsoft.VisualBasic.Activities;assembly=System.Activities"</span> <span class="attr">xmlns:p</span><span class="kwrd">="http://tempuri.org/"</span> <span class="attr">xmlns:p1</span><span class="kwrd">="http://schemas.microsoft.com/netfx/2009/xaml/activities"</span> <span class="attr">xmlns:s</span><span class="kwrd">="clr-namespace:System;assembly=mscorlib"</span> <span class="attr">xmlns:s1</span><span class="kwrd">="clr-namespace:System;assembly=System"</span> <span class="attr">xmlns:s2</span><span class="kwrd">="clr-namespace:System;assembly=System.Xml"</span> <span class="attr">xmlns:s3</span><span class="kwrd">="clr-namespace:System;assembly=System.Core"</span> <span class="attr">xmlns:s4</span><span class="kwrd">="clr-namespace:System;assembly=System.ServiceModel"</span> <span class="attr">xmlns:sa</span><span class="kwrd">="clr-namespace:System.Activities;assembly=System.Activities"</span> <span class="attr">xmlns:sad</span><span class="kwrd">="clr-namespace:System.Activities.Debugger;assembly=System.Activities"</span> <span class="attr">xmlns:sap</span><span class="kwrd">="http://schemas.microsoft.com/netfx/2009/xaml/activities/presentation"</span> <span class="attr">xmlns:scg</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=System"</span> <span class="attr">xmlns:scg1</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=System.ServiceModel"</span> <span class="attr">xmlns:scg2</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=System.Core"</span> <span class="attr">xmlns:scg3</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=mscorlib"</span> <span class="attr">xmlns:sd</span><span class="kwrd">="clr-namespace:System.Data;assembly=System.Data"</span> <span class="attr">xmlns:sl</span><span class="kwrd">="clr-namespace:System.Linq;assembly=System.Core"</span> <span class="attr">xmlns:st</span><span class="kwrd">="clr-namespace:System.Text;assembly=mscorlib"</span> <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">p1:Sequence</span> <span class="attr">DisplayName</span><span class="kwrd">="Sequential Service"</span> <span class="attr">sad:XamlDebuggerXmlReader</span>.<span class="attr">FileName</span><span class="kwrd">="d:\temp\WCFTechonologyComparaionSolution\DeclarativeServiceLibrary1\Service1.xamlx"</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="531,590"</span> <span class="attr">mva:VisualBasic</span>.<span class="attr">Settings</span><span class="kwrd">="Assembly references and imported namespaces serialized as XML namespaces"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">p1:Sequence.Variables</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">p1:Variable</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="CorrelationHandle"</span> <span class="attr">Name</span><span class="kwrd">="handle"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">p1:Variable</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:Int32"</span> <span class="attr">Name</span><span class="kwrd">="data"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">p1:Variable</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String"</span> <span class="attr">Name</span><span class="kwrd">="result"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">p1:Sequence.Variables</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">sap:WorkflowViewStateService.ViewState</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">scg3:Dictionary</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String, x:Object"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">x:Boolean</span> <span class="attr">x:Key</span><span class="kwrd">="IsExpanded"</span><span class="kwrd">&gt;</span>True<span class="kwrd">&lt;/</span><span class="html">x:Boolean</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">scg3:Dictionary</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">sap:WorkflowViewStateService.ViewState</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Receive</span> <span class="attr">x:Name</span><span class="kwrd">="__ReferenceID0"</span> <span class="attr">CanCreateInstance</span><span class="kwrd">="True"</span> <span class="attr">DisplayName</span><span class="kwrd">="ReceiveRequest"</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="509,90"</span> <span class="attr">OperationName</span><span class="kwrd">="GetData"</span> <span class="attr">ServiceContractName</span><span class="kwrd">="p:IService"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">Receive.CorrelationInitializers</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">RequestReplyCorrelationInitializer</span> <span class="attr">CorrelationHandle</span><span class="kwrd">="[handle]"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">Receive.CorrelationInitializers</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">ReceiveMessageContent</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">p1:OutArgument</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:Int32"</span><span class="kwrd">&gt;</span>[data]<span class="kwrd">&lt;/</span><span class="html">p1:OutArgument</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">ReceiveMessageContent</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Receive</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">p1:If</span> <span class="attr">Condition</span><span class="kwrd">="[data Mod 2 = 0]"</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="509,206"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">p1:If.Then</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">p1:Assign</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="242,100"</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">p1:Assign.To</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">p1:OutArgument</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String"</span><span class="kwrd">&gt;</span>[result]<span class="kwrd">&lt;/</span><span class="html">p1:OutArgument</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">p1:Assign.To</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">p1:Assign.Value</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">p1:InArgument</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String"</span><span class="kwrd">&gt;</span>偶数<span class="kwrd">&lt;/</span><span class="html">p1:InArgument</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">p1:Assign.Value</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">p1:Assign</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">p1:If.Then</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">p1:If.Else</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">p1:Assign</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="242,100"</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">p1:Assign.To</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">p1:OutArgument</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String"</span><span class="kwrd">&gt;</span>[result]<span class="kwrd">&lt;/</span><span class="html">p1:OutArgument</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">p1:Assign.To</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">p1:Assign.Value</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">p1:InArgument</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String"</span><span class="kwrd">&gt;</span>奇数<span class="kwrd">&lt;/</span><span class="html">p1:InArgument</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">p1:Assign.Value</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">p1:Assign</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">p1:If.Else</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">p1:If</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">SendReply</span> <span class="attr">Request</span><span class="kwrd">="{x:Reference __ReferenceID0}"</span> <span class="attr">DisplayName</span><span class="kwrd">="SendResponse"</span> <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="509,90"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">SendMessageContent</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">p1:InArgument</span> <span class="attr">x:TypeArguments</span><span class="kwrd">="x:String"</span><span class="kwrd">&gt;</span>[result]<span class="kwrd">&lt;/</span><span class="html">p1:InArgument</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">SendMessageContent</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">SendReply</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">p1:Sequence</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">WorkflowService</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>那么，这个服务怎么使用呢？没有什么特别的，就和正常的WCF服务一样就可以了：添加服务引用，然后调用服务。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902096844.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902106321.png" width="635" height="514"></a></p>
<p>需要注意的是，这个服务是使用basicHttpBinding的，而且也无法修改</p><pre class="csharpcode"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">bindings</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">basicHttpBinding</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">binding</span> <span class="attr">name</span><span class="kwrd">="BasicHttpBinding_IService"</span> <span class="attr">closeTimeout</span><span class="kwrd">="00:01:00"</span>
                    <span class="attr">openTimeout</span><span class="kwrd">="00:01:00"</span> <span class="attr">receiveTimeout</span><span class="kwrd">="00:10:00"</span> <span class="attr">sendTimeout</span><span class="kwrd">="00:01:00"</span>
                    <span class="attr">allowCookies</span><span class="kwrd">="false"</span> <span class="attr">bypassProxyOnLocal</span><span class="kwrd">="false"</span> <span class="attr">hostNameComparisonMode</span><span class="kwrd">="StrongWildcard"</span>
                    <span class="attr">maxBufferSize</span><span class="kwrd">="65536"</span> <span class="attr">maxBufferPoolSize</span><span class="kwrd">="524288"</span> <span class="attr">maxReceivedMessageSize</span><span class="kwrd">="65536"</span>
                    <span class="attr">messageEncoding</span><span class="kwrd">="Text"</span> <span class="attr">textEncoding</span><span class="kwrd">="utf-8"</span> <span class="attr">transferMode</span><span class="kwrd">="Buffered"</span>
                    <span class="attr">useDefaultWebProxy</span><span class="kwrd">="true"</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">readerQuotas</span> <span class="attr">maxDepth</span><span class="kwrd">="32"</span> <span class="attr">maxStringContentLength</span><span class="kwrd">="8192"</span> <span class="attr">maxArrayLength</span><span class="kwrd">="16384"</span>
                        <span class="attr">maxBytesPerRead</span><span class="kwrd">="4096"</span> <span class="attr">maxNameTableCharCount</span><span class="kwrd">="16384"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">security</span> <span class="attr">mode</span><span class="kwrd">="None"</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">transport</span> <span class="attr">clientCredentialType</span><span class="kwrd">="None"</span> <span class="attr">proxyCredentialType</span><span class="kwrd">="None"</span>
                            <span class="attr">realm</span><span class="kwrd">=""</span> <span class="kwrd">/&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">message</span> <span class="attr">clientCredentialType</span><span class="kwrd">="UserName"</span> <span class="attr">algorithmSuite</span><span class="kwrd">="Default"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">security</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">binding</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">basicHttpBinding</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">bindings</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">client</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">endpoint</span> <span class="attr">address</span><span class="kwrd">="http://localhost:14262/Service1.xamlx"</span> <span class="attr">binding</span><span class="kwrd">="basicHttpBinding"</span>
                <span class="attr">bindingConfiguration</span><span class="kwrd">="BasicHttpBinding_IService"</span> <span class="attr">contract</span><span class="kwrd">="WorkflowService.IService"</span>
                <span class="attr">name</span><span class="kwrd">="BasicHttpBinding_IService"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">client</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>






<p>我们看看程序调用的效果吧</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Linq;

<span class="kwrd">namespace</span> ConsoleApplication1
{
    <span class="kwrd">class</span> Program
    {
        <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
        {

            var proxy = <span class="kwrd">new</span> WorkflowService.ServiceClient();
            Console.WriteLine(proxy.GetData(20));<span class="rem">//这个会返回“偶数”</span>
            Console.WriteLine(proxy.GetData(215));<span class="rem">//这个会返回“奇数”</span>

            Console.Read();
        }
    }
}
</pre>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902103289.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902107434.png" width="416" height="139"></a>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>&nbsp;</p>
<p><strong><font color="#ff0000">总结</font></strong>：Workflow Services是一种将Workflow Foundation与WCF结合的实现，它采用了basicHttpBinding, 允许我们通过声明（Declarative）而不是代码（Code）设计一个服务。</p>
<p>【备注】需要注意的是，在Workflow 的设计中，也可以发起WCF 调用，但这是另外一个问题了。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902106354.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902109419.png" width="236" height="206"></a></p>
<p>大家有点晕了对吧，我就不再往下展开了吧。</p>
<p>&nbsp;</p>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>5. RIA Services</h2>
<p>这是本文最后一个小节，将介绍RIA Services。</p>
<p>RIA的意思是，Rich Internet Application。在微软平台上，Silverlight就是RIA战略中的核心产品，所以很显然，RIA Service主要就是为Silverlight服务的。这个是.NET Framework 4.0中才有的功能，并且还需要安装RIA Service Toolkit。</p>
<p>推荐你使用微软免费提供的<a href="http://www.microsoft.com/web/downloads/platform.aspx">Web Platform Installer</a>来安装必要的一些组件</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621190211324.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902113978.png" width="784" height="544"></a></p>
<p>如果你对RIA Service一些基本概念不熟悉，请参考微软官方介绍 <a href="http://www.silverlight.net/getstarted/riaservices/">http://www.silverlight.net/getstarted/riaservices/</a></p>
<p>我们一般可以在新建Silverlight应用程序的时候，选择是否启用WCF RIA Services,如下图所示</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621190211946.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902111503.png" width="538" height="449"></a></p>
<p>启用该服务的意思是，让Silverlight程序链接到Web程序</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902125157.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902128014.png" width="866" height="693"></a></p>
<p>为什么需要这样一个链接呢？这是因为RIA Service会有一个特殊的机制，在Silverlight应用程序编译的时候，会自动去找到所链接的Web项目，将里面的RIA Service在本地生成一个代理类。</p>
<p>&nbsp;</p>
<p>RIA Services，具体到Web项目中来，其实是所谓的Domain Service。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902126618.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902138047.png" width="734" height="362"></a></p>
<p>与WCF Data Service相似的是，Domain Service也需要有一个数据模型。但不同的是，它支持ADO.NET Entity Framework之外，还支持自定义业务模型。</p>
<p>【注意】Domain Service目前不支持LINQ to SQL模型了。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902138669.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902151866.png" width="919" height="727"></a></p>
<p>创建Domain Service的时候可以选择到这个数据模型</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902153851.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621190215819.png" width="464" height="553"></a></p><pre class="csharpcode"> </pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>该工具会自动生成如下代码</p><pre class="csharpcode">
<span class="kwrd">namespace</span> SilverlightApplication1.Web
{
    <span class="kwrd">using</span> System.Data;
    <span class="kwrd">using</span> System.Linq;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.EntityFramework;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Hosting;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Server;


    <span class="rem">// Implements application logic using the NorthwindEntities context.</span>
    <span class="rem">// TODO: Add your application logic to these methods or in additional methods.</span>
    <span class="rem">// TODO: Wire up authentication (Windows/ASP.NET Forms) and uncomment the following to disable anonymous access</span>
    <span class="rem">// Also consider adding roles to restrict access as appropriate.</span>
    <span class="rem">// [RequiresAuthentication]</span>
    [EnableClientAccess()]
    <span class="kwrd">public</span> <span class="kwrd">class</span> NorthwindDomainService : LinqToEntitiesDomainService&lt;NorthwindEntities&gt;
    {

        <span class="rem">// TODO:</span>
        <span class="rem">// Consider constraining the results of your query method.  If you need additional input you can</span>
        <span class="rem">// add parameters to this method or create additional query methods with different names.</span>
        <span class="rem">// To support paging you will need to add ordering to the 'Customers' query.</span>
        [Query(IsDefault = <span class="kwrd">true</span>)]
        <span class="kwrd">public</span> IQueryable&lt;Customer&gt; GetCustomers()
        {
            <span class="kwrd">return</span> <span class="kwrd">this</span>.ObjectContext.Customers;
        }

        <span class="kwrd">public</span> <span class="kwrd">void</span> InsertCustomer(Customer customer)
        {
            <span class="kwrd">if</span> ((customer.EntityState != EntityState.Detached))
            {
                <span class="kwrd">this</span>.ObjectContext.ObjectStateManager.ChangeObjectState(customer, EntityState.Added);
            }
            <span class="kwrd">else</span>
            {
                <span class="kwrd">this</span>.ObjectContext.Customers.AddObject(customer);
            }
        }

        <span class="kwrd">public</span> <span class="kwrd">void</span> UpdateCustomer(Customer currentCustomer)
        {
            <span class="kwrd">this</span>.ObjectContext.Customers.AttachAsModified(currentCustomer, <span class="kwrd">this</span>.ChangeSet.GetOriginal(currentCustomer));
        }

        <span class="kwrd">public</span> <span class="kwrd">void</span> DeleteCustomer(Customer customer)
        {
            <span class="kwrd">if</span> ((customer.EntityState != EntityState.Detached))
            {
                <span class="kwrd">this</span>.ObjectContext.ObjectStateManager.ChangeObjectState(customer, EntityState.Deleted);
            }
            <span class="kwrd">else</span>
            {
                <span class="kwrd">this</span>.ObjectContext.Customers.Attach(customer);
                <span class="kwrd">this</span>.ObjectContext.Customers.DeleteObject(customer);
            }
        }
    }
}

</pre>
<p>与此同时，由于我的Silverlight 应用程序是链接到了这个Web项目的，所以如果此时编译Silverlight应用程序的话，会自动根据这个DomainService生成一个类型</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902158344.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902169490.png" width="920" height="723"></a></p>
<p>这个类型的大致代码如下</p><pre class="csharpcode"><span class="rem">//------------------------------------------------------------------------------</span>
<span class="rem">// &lt;auto-generated&gt;</span>
<span class="rem">//     This code was generated by a tool.</span>
<span class="rem">//     Runtime Version:4.0.30319.235</span>
<span class="rem">//</span>
<span class="rem">//     Changes to this file may cause incorrect behavior and will be lost if</span>
<span class="rem">//     the code is regenerated.</span>
<span class="rem">// &lt;/auto-generated&gt;</span>
<span class="rem">//------------------------------------------------------------------------------</span>

<span class="kwrd">namespace</span> SilverlightApplication1
{
    <span class="kwrd">using</span> System;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Client.ApplicationServices;
    
    
    <span class="rem">/// &lt;summary&gt;</span>
    <span class="rem">/// Context for the RIA application.</span>
    <span class="rem">/// &lt;/summary&gt;</span>
    <span class="rem">/// &lt;remarks&gt;</span>
    <span class="rem">/// This context extends the base to make application services and types available</span>
    <span class="rem">/// for consumption from code and xaml.</span>
    <span class="rem">/// &lt;/remarks&gt;</span>
    <span class="kwrd">public</span> <span class="kwrd">sealed</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> WebContext : WebContextBase
    {
        
        <span class="preproc">#region</span> Extensibility Method Definitions

        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// This method is invoked from the constructor once initialization is complete and</span>
        <span class="rem">/// can be used for further object setup.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCreated();

        <span class="preproc">#endregion</span>
        
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Initializes a new instance of the WebContext class.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">public</span> WebContext()
        {
            <span class="kwrd">this</span>.OnCreated();
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets the context that is registered as a lifetime object with the current application.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;exception cref="InvalidOperationException"&gt; is thrown if there is no current application,</span>
        <span class="rem">/// no contexts have been added, or more than one context has been added.</span>
        <span class="rem">/// &lt;/exception&gt;</span>
        <span class="rem">/// &lt;seealso cref="System.Windows.Application.ApplicationLifetimeObjects"/&gt;</span>
        <span class="kwrd">public</span> <span class="kwrd">new</span> <span class="kwrd">static</span> WebContext Current
        {
            get
            {
                <span class="kwrd">return</span> ((WebContext)(WebContextBase.Current));
            }
        }
    }
}
<span class="kwrd">namespace</span> SilverlightApplication1.Web
{
    <span class="kwrd">using</span> System;
    <span class="kwrd">using</span> System.Collections.Generic;
    <span class="kwrd">using</span> System.ComponentModel.DataAnnotations;
    <span class="kwrd">using</span> System.Runtime.Serialization;
    <span class="kwrd">using</span> System.ServiceModel;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Client;
    <span class="kwrd">using</span> System.ServiceModel.Web;
    
    
    <span class="rem">/// &lt;summary&gt;</span>
    <span class="rem">/// The 'Customer' entity class.</span>
    <span class="rem">/// &lt;/summary&gt;</span>
    [DataContract(Namespace=<span class="str">"http://schemas.datacontract.org/2004/07/SilverlightApplication1.Web"</span>)]
    <span class="kwrd">public</span> <span class="kwrd">sealed</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Customer : Entity
    {
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _address;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _city;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _companyName;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _contactName;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _contactTitle;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _country;
        
        <span class="kwrd">private</span> Nullable&lt;DateTime&gt; _creationDate;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _customerID;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _fax;
        
        <span class="kwrd">private</span> Nullable&lt;DateTime&gt; _lastEditDate;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _phone;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _postalCode;
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _region;
        
        <span class="preproc">#region</span> Extensibility Method Definitions

        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// This method is invoked from the constructor once initialization is complete and</span>
        <span class="rem">/// can be used for further object setup.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCreated();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnAddressChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnAddressChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCityChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCityChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCompanyNameChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCompanyNameChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnContactNameChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnContactNameChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnContactTitleChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnContactTitleChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCountryChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCountryChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCreationDateChanging(Nullable&lt;DateTime&gt; <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCreationDateChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCustomerIDChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCustomerIDChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnFaxChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnFaxChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnLastEditDateChanging(Nullable&lt;DateTime&gt; <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnLastEditDateChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnPhoneChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnPhoneChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnPostalCodeChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnPostalCodeChanged();
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnRegionChanging(<span class="kwrd">string</span> <span class="kwrd">value</span>);
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnRegionChanged();

        <span class="preproc">#endregion</span>
        
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Initializes a new instance of the &lt;see cref="Customer"/&gt; class.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">public</span> Customer()
        {
            <span class="kwrd">this</span>.OnCreated();
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'Address' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(60)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Address
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._address;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._address != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnAddressChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"Address"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"Address"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._address = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"Address"</span>);
                    <span class="kwrd">this</span>.OnAddressChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'City' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(15)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> City
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._city;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._city != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnCityChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"City"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"City"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._city = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"City"</span>);
                    <span class="kwrd">this</span>.OnCityChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'CompanyName' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [Required()]
        [StringLength(40)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> CompanyName
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._companyName;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._companyName != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnCompanyNameChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"CompanyName"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"CompanyName"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._companyName = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"CompanyName"</span>);
                    <span class="kwrd">this</span>.OnCompanyNameChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'ContactName' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(30)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> ContactName
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._contactName;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._contactName != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnContactNameChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"ContactName"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"ContactName"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._contactName = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"ContactName"</span>);
                    <span class="kwrd">this</span>.OnContactNameChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'ContactTitle' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(30)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> ContactTitle
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._contactTitle;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._contactTitle != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnContactTitleChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"ContactTitle"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"ContactTitle"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._contactTitle = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"ContactTitle"</span>);
                    <span class="kwrd">this</span>.OnContactTitleChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'Country' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(15)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Country
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._country;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._country != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnCountryChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"Country"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"Country"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._country = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"Country"</span>);
                    <span class="kwrd">this</span>.OnCountryChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'CreationDate' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        <span class="kwrd">public</span> Nullable&lt;DateTime&gt; CreationDate
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._creationDate;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._creationDate != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnCreationDateChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"CreationDate"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"CreationDate"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._creationDate = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"CreationDate"</span>);
                    <span class="kwrd">this</span>.OnCreationDateChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'CustomerID' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [Editable(<span class="kwrd">false</span>, AllowInitialValue=<span class="kwrd">true</span>)]
        [Key()]
        [Required()]
        [RoundtripOriginal()]
        [StringLength(5)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> CustomerID
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._customerID;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._customerID != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnCustomerIDChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"CustomerID"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._customerID = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaisePropertyChanged(<span class="str">"CustomerID"</span>);
                    <span class="kwrd">this</span>.OnCustomerIDChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'Fax' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(24)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Fax
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._fax;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._fax != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnFaxChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"Fax"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"Fax"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._fax = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"Fax"</span>);
                    <span class="kwrd">this</span>.OnFaxChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'LastEditDate' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        <span class="kwrd">public</span> Nullable&lt;DateTime&gt; LastEditDate
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._lastEditDate;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._lastEditDate != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnLastEditDateChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"LastEditDate"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"LastEditDate"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._lastEditDate = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"LastEditDate"</span>);
                    <span class="kwrd">this</span>.OnLastEditDateChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'Phone' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(24)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Phone
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._phone;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._phone != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnPhoneChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"Phone"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"Phone"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._phone = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"Phone"</span>);
                    <span class="kwrd">this</span>.OnPhoneChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'PostalCode' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(10)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> PostalCode
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._postalCode;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._postalCode != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnPostalCodeChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"PostalCode"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"PostalCode"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._postalCode = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"PostalCode"</span>);
                    <span class="kwrd">this</span>.OnPostalCodeChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets or sets the 'Region' value.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [DataMember()]
        [StringLength(15)]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Region
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">this</span>._region;
            }
            set
            {
                <span class="kwrd">if</span> ((<span class="kwrd">this</span>._region != <span class="kwrd">value</span>))
                {
                    <span class="kwrd">this</span>.OnRegionChanging(<span class="kwrd">value</span>);
                    <span class="kwrd">this</span>.RaiseDataMemberChanging(<span class="str">"Region"</span>);
                    <span class="kwrd">this</span>.ValidateProperty(<span class="str">"Region"</span>, <span class="kwrd">value</span>);
                    <span class="kwrd">this</span>._region = <span class="kwrd">value</span>;
                    <span class="kwrd">this</span>.RaiseDataMemberChanged(<span class="str">"Region"</span>);
                    <span class="kwrd">this</span>.OnRegionChanged();
                }
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Computes a value from the key fields that uniquely identifies this entity instance.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;returns&gt;An object instance that uniquely identifies this entity instance.&lt;/returns&gt;</span>
        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">object</span> GetIdentity()
        {
            <span class="kwrd">return</span> <span class="kwrd">this</span>._customerID;
        }
    }
    
    <span class="rem">/// &lt;summary&gt;</span>
    <span class="rem">/// The DomainContext corresponding to the 'NorthwindDomainService' DomainService.</span>
    <span class="rem">/// &lt;/summary&gt;</span>
    <span class="kwrd">public</span> <span class="kwrd">sealed</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> NorthwindDomainContext : DomainContext
    {
        
        <span class="preproc">#region</span> Extensibility Method Definitions

        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// This method is invoked from the constructor once initialization is complete and</span>
        <span class="rem">/// can be used for further object setup.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCreated();

        <span class="preproc">#endregion</span>
        
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Initializes a new instance of the &lt;see cref="NorthwindDomainContext"/&gt; class.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">public</span> NorthwindDomainContext() : 
                <span class="kwrd">this</span>(<span class="kwrd">new</span> WebDomainClient&lt;INorthwindDomainServiceContract&gt;(<span class="kwrd">new</span> Uri(<span class="str">"SilverlightApplication1-Web-NorthwindDomainService.svc"</span>, UriKind.Relative)))
        {
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Initializes a new instance of the &lt;see cref="NorthwindDomainContext"/&gt; class with the specified service URI.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;param name="serviceUri"&gt;The NorthwindDomainService service URI.&lt;/param&gt;</span>
        <span class="kwrd">public</span> NorthwindDomainContext(Uri serviceUri) : 
                <span class="kwrd">this</span>(<span class="kwrd">new</span> WebDomainClient&lt;INorthwindDomainServiceContract&gt;(serviceUri))
        {
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Initializes a new instance of the &lt;see cref="NorthwindDomainContext"/&gt; class with the specified &lt;paramref name="domainClient"/&gt;.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;param name="domainClient"&gt;The DomainClient instance to use for this DomainContext.&lt;/param&gt;</span>
        <span class="kwrd">public</span> NorthwindDomainContext(DomainClient domainClient) : 
                <span class="kwrd">base</span>(domainClient)
        {
            <span class="kwrd">this</span>.OnCreated();
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets the set of &lt;see cref="Customer"/&gt; entity instances that have been loaded into this &lt;see cref="NorthwindDomainContext"/&gt; instance.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="kwrd">public</span> EntitySet&lt;Customer&gt; Customers
        {
            get
            {
                <span class="kwrd">return</span> <span class="kwrd">base</span>.EntityContainer.GetEntitySet&lt;Customer&gt;();
            }
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Gets an EntityQuery instance that can be used to load &lt;see cref="Customer"/&gt; entity instances using the 'GetCustomers' query.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;returns&gt;An EntityQuery that can be loaded to retrieve &lt;see cref="Customer"/&gt; entity instances.&lt;/returns&gt;</span>
        <span class="kwrd">public</span> EntityQuery&lt;Customer&gt; GetCustomersQuery()
        {
            <span class="kwrd">this</span>.ValidateMethod(<span class="str">"GetCustomersQuery"</span>, <span class="kwrd">null</span>);
            <span class="kwrd">return</span> <span class="kwrd">base</span>.CreateQuery&lt;Customer&gt;(<span class="str">"GetCustomers"</span>, <span class="kwrd">null</span>, <span class="kwrd">false</span>, <span class="kwrd">true</span>);
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Creates a new EntityContainer for this DomainContext's EntitySets.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;returns&gt;A new container instance.&lt;/returns&gt;</span>
        <span class="kwrd">protected</span> <span class="kwrd">override</span> EntityContainer CreateEntityContainer()
        {
            <span class="kwrd">return</span> <span class="kwrd">new</span> NorthwindDomainContextEntityContainer();
        }
        
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// Service contract for the 'NorthwindDomainService' DomainService.</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        [ServiceContract()]
        <span class="kwrd">public</span> <span class="kwrd">interface</span> INorthwindDomainServiceContract
        {
            
            <span class="rem">/// &lt;summary&gt;</span>
            <span class="rem">/// Asynchronously invokes the 'GetCustomers' operation.</span>
            <span class="rem">/// &lt;/summary&gt;</span>
            <span class="rem">/// &lt;param name="callback"&gt;Callback to invoke on completion.&lt;/param&gt;</span>
            <span class="rem">/// &lt;param name="asyncState"&gt;Optional state object.&lt;/param&gt;</span>
            <span class="rem">/// &lt;returns&gt;An IAsyncResult that can be used to monitor the request.&lt;/returns&gt;</span>
            [FaultContract(<span class="kwrd">typeof</span>(DomainServiceFault), Action=<span class="str">"http://tempuri.org/NorthwindDomainService/GetCustomersDomainServiceFault"</span>, Name=<span class="str">"DomainServiceFault"</span>, Namespace=<span class="str">"DomainServices"</span>)]
            [OperationContract(AsyncPattern=<span class="kwrd">true</span>, Action=<span class="str">"http://tempuri.org/NorthwindDomainService/GetCustomers"</span>, ReplyAction=<span class="str">"http://tempuri.org/NorthwindDomainService/GetCustomersResponse"</span>)]
            [WebGet()]
            IAsyncResult BeginGetCustomers(AsyncCallback callback, <span class="kwrd">object</span> asyncState);
            
            <span class="rem">/// &lt;summary&gt;</span>
            <span class="rem">/// Completes the asynchronous operation begun by 'BeginGetCustomers'.</span>
            <span class="rem">/// &lt;/summary&gt;</span>
            <span class="rem">/// &lt;param name="result"&gt;The IAsyncResult returned from 'BeginGetCustomers'.&lt;/param&gt;</span>
            <span class="rem">/// &lt;returns&gt;The 'QueryResult' returned from the 'GetCustomers' operation.&lt;/returns&gt;</span>
            QueryResult&lt;Customer&gt; EndGetCustomers(IAsyncResult result);
            
            <span class="rem">/// &lt;summary&gt;</span>
            <span class="rem">/// Asynchronously invokes the 'SubmitChanges' operation.</span>
            <span class="rem">/// &lt;/summary&gt;</span>
            <span class="rem">/// &lt;param name="changeSet"&gt;The change-set to submit.&lt;/param&gt;</span>
            <span class="rem">/// &lt;param name="callback"&gt;Callback to invoke on completion.&lt;/param&gt;</span>
            <span class="rem">/// &lt;param name="asyncState"&gt;Optional state object.&lt;/param&gt;</span>
            <span class="rem">/// &lt;returns&gt;An IAsyncResult that can be used to monitor the request.&lt;/returns&gt;</span>
            [FaultContract(<span class="kwrd">typeof</span>(DomainServiceFault), Action=<span class="str">"http://tempuri.org/NorthwindDomainService/SubmitChangesDomainServiceFault"</span>, Name=<span class="str">"DomainServiceFault"</span>, Namespace=<span class="str">"DomainServices"</span>)]
            [OperationContract(AsyncPattern=<span class="kwrd">true</span>, Action=<span class="str">"http://tempuri.org/NorthwindDomainService/SubmitChanges"</span>, ReplyAction=<span class="str">"http://tempuri.org/NorthwindDomainService/SubmitChangesResponse"</span>)]
            IAsyncResult BeginSubmitChanges(IEnumerable&lt;ChangeSetEntry&gt; changeSet, AsyncCallback callback, <span class="kwrd">object</span> asyncState);
            
            <span class="rem">/// &lt;summary&gt;</span>
            <span class="rem">/// Completes the asynchronous operation begun by 'BeginSubmitChanges'.</span>
            <span class="rem">/// &lt;/summary&gt;</span>
            <span class="rem">/// &lt;param name="result"&gt;The IAsyncResult returned from 'BeginSubmitChanges'.&lt;/param&gt;</span>
            <span class="rem">/// &lt;returns&gt;The collection of change-set entry elements returned from 'SubmitChanges'.&lt;/returns&gt;</span>
            IEnumerable&lt;ChangeSetEntry&gt; EndSubmitChanges(IAsyncResult result);
        }
        
        <span class="kwrd">internal</span> <span class="kwrd">sealed</span> <span class="kwrd">class</span> NorthwindDomainContextEntityContainer : EntityContainer
        {
            
            <span class="kwrd">public</span> NorthwindDomainContextEntityContainer()
            {
                <span class="kwrd">this</span>.CreateEntitySet&lt;Customer&gt;(EntitySetOperations.All);
            }
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>我们看到，其实在客户端是有一个WebContext的类型的。下面演示一下，我们具体在Silverlight里面如何使用该服务吧</p>
<p>MainPage.xaml</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">UserControl</span> <span class="attr">x:Class</span><span class="kwrd">="SilverlightApplication1.MainPage"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="attr">xmlns:d</span><span class="kwrd">="http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="attr">mc:Ignorable</span><span class="kwrd">="d"</span>
    <span class="attr">d:DesignHeight</span><span class="kwrd">="300"</span> <span class="attr">d:DesignWidth</span><span class="kwrd">="400"</span> <span class="attr">xmlns:sdk</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">Grid</span> <span class="attr">x:Name</span><span class="kwrd">="LayoutRoot"</span> <span class="attr">Background</span><span class="kwrd">="White"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">sdk:DataGrid</span> <span class="attr">AutoGenerateColumns</span><span class="kwrd">="true"</span> <span class="attr">Margin</span><span class="kwrd">="20,26,23,12"</span> <span class="attr">Name</span><span class="kwrd">="dataGrid1"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">UserControl</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>&nbsp;</p>
<p>MainPage.xaml.cs</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> SilverlightApplication1.Web;

<span class="kwrd">namespace</span> SilverlightApplication1
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainPage_Loaded);
        }

        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var ctx = <span class="kwrd">new</span> NorthwindDomainContext();
            var op = ctx.Load&lt;Customer&gt;(ctx.GetCustomersQuery());
            dataGrid1.ItemsSource = op.Entities;
        }
    }
}
</pre>
<p>【备注】我们都知道Silverlight中访问数据都是异步的（一般编写代码都比较繁琐），RIA Service对此做了优化，但实际上上面这个Load方法也是一个异步方法。</p>
<p>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902178160.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621190218768.png" width="1028" height="701"></a></p>
<p>如果我们需要对数据进行过滤，服务器不需要做任何修改。只要在Silverlight中用下面这样的语法就可以了</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> SilverlightApplication1.Web;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.ServiceModel.DomainServices.Client;

<span class="kwrd">namespace</span> SilverlightApplication1
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainPage_Loaded);
        }

        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var ctx = <span class="kwrd">new</span> NorthwindDomainContext();
            var query = from c <span class="kwrd">in</span> ctx.GetCustomersQuery()
                        <span class="kwrd">where</span> c.Country == <span class="str">"USA"</span>
                        select c;

                        
            var op = ctx.Load&lt;Customer&gt;(query);
            dataGrid1.ItemsSource = op.Entities;
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902189197.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621190219900.png" width="1028" height="701"></a></p>
<p>这是多么方便啊。所以，我有时候也喜欢将RIA解读为:Rapid Internet Application. 它大大地提高了Silverlight应用程序开发的生产力。</p>
<p>&nbsp;</p>
<p>那么，RIA Service后台到底是如何实现的呢？与前面几种都不同的是，它是通过一个特殊的HttpModule实现的</p><pre class="csharpcode">  <span class="kwrd">&lt;</span><span class="html">configSections</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">sectionGroup</span> <span class="attr">name</span><span class="kwrd">="system.serviceModel"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">section</span> <span class="attr">name</span><span class="kwrd">="domainServices"</span> <span class="attr">type</span><span class="kwrd">="System.ServiceModel.DomainServices.Hosting.DomainServicesSection, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="attr">allowDefinition</span><span class="kwrd">="MachineToApplication"</span> <span class="attr">requirePermission</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">sectionGroup</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">configSections</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">modules</span> <span class="attr">runAllManagedModulesForAllRequests</span><span class="kwrd">="true"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="DomainServiceModule"</span> <span class="attr">preCondition</span><span class="kwrd">="managedHandler"</span>
        <span class="attr">type</span><span class="kwrd">="System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">modules</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">validation</span> <span class="attr">validateIntegratedModeConfiguration</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">httpModules</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="DomainServiceModule"</span> <span class="attr">type</span><span class="kwrd">="System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">httpModules</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">compilation</span> <span class="attr">debug</span><span class="kwrd">="true"</span> <span class="attr">targetFramework</span><span class="kwrd">="4.0"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">assemblies</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">assembly</span><span class="kwrd">="System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">assemblies</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">compilation</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.web</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>【备注】RIA Service并没有显式的SVC文件，但会有一个隐含的svc路径可以访问。（请参考下图）</p>
<p>&nbsp;</p>
<p>那么，RIA Service是使用什么样的Binding呢？根据资料，它应该支持下面三种Binding。默认是第三种，它用二进制的方式发送数据，目的主要是提高传输效率。</p>
<ol>
<li>For WebHttpBinding: “baseAddress" (REST with JSON Endpoint)</li>
<li>For BasicHttpBinding: “baseAddress” + “/soap” (SOAP with XML Endpoint)</li>
<li>For BinaryHttpBinding: “baseAddress” + “/binary” (SOAP with Binary Endpoint)</li></ol>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902209919.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902216953.png" width="1028" height="701"></a></p>
<p>&nbsp;</p>
<p>那么，是否可以让RIA Service支持标准的SOAP endpoint呢？</p>
<p>这个问题，之前有一个专门的文章介绍，请参考这里：<a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/14/2080887.html">http://www.cnblogs.com/chenxizhang/archive/2011/06/14/2080887.html</a></p>
<p>&nbsp;</p>
<p><strong><font color="#ff0000">总结</font></strong>：RIA Service是一种主要用于Silverlight应用程序的服务。它可以结合ADO.NET Entity Framework数据模型，或者自定义数据模型，极大地方便了Silverlight应用程序进行数据访问的设计。它默认是用二进制的binding，但也可以通过一些配置添加soap endpoint.</p>
<p>&nbsp;</p>
<p>最后，本文总结分析了五种主要的WCF服务类型，以及他们的一些内在设计原理，下面这个表格可以做一个综合比较</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902217510.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211902216430.png" width="865" height="188"></a></p>