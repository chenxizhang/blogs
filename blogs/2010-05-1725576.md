# MOSS 2010:Visual Studio 2010开发体验（22）&mdash;&mdash;利用BCS和WCF进行应用程序集成 
> 原文发表于 2010-05-01, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/05/01/1725576.html 


<p><a href="http://www.cnblogs.com/chenxizhang/archive/2010/05/01/1725531.html">上一篇</a>，我们讲到了如何利用BCS服务，直接连接到SQL Server数据库实现一些简单的应用程序集成的场景。看起来很不错，不是吗？</p> <p>但是，事实上，直接连接到数据库也许有时候是不可能实现的任务，很多系统并不可能直接将数据库暴露出来的。地球人都知道，那样的风险极高。</p> <p>那么，比较可行的是什么方式呢？我觉得很多系统倒是有公开一些服务，这些服务有的使用Web Service实现，有的不是。这都不要紧。总之，由这些服务去连接数据库，而我们做集成的时候，并不需要知道数据库在哪里？以及什么结构等等信息。</p> <p>&nbsp;</p> <p>这一篇，我们讲解使用WCF作为服务，实现应用程序集成的简单步骤</p> <p>&nbsp;</p> <h2>1. 创建一个测试用的服务</h2> <p>为了快速开发，我们会将该服务宿主在一个Web Application中，所以首先我们需要创建这个Application</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_2.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb.png" width="1044" height="810"></a> </p> <p>默认会有下面这样的项目结构</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_4.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_1.png" width="1044" height="810"></a> </p> <p></p> <p>我们无需修改default.aspx.因为我们根本不使用它</p> <p>为了读取数据库，我们可以创建一个LINQ to SQL数据模型</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_6.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_2.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_8.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_3.png" width="1044" height="810"></a> </p> <p>我们可以将Northwind数据库的连接定义在Server Explorer中，并且将Employees表拖拽到这个设计器中来</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_10.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_4.png" width="1044" height="810"></a> </p> <p>保存该模型。下面我们就来添加我们的服务了</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_12.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_5.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_14.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_6.png" width="1044" height="810"></a> </p> <p>修改这个IEmployeeService成下面这样</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Runtime.Serialization;
<span class="kwrd">using</span> System.ServiceModel;
<span class="kwrd">using</span> System.Text;

<span class="kwrd">namespace</span> NorthwindService
{
    <span class="rem">// NOTE: You can use the "Rename" command on the "Refactor" menu to change the interface name "IEmployeeService" in both code and config file together.</span>
    [ServiceContract]
    <span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeService
    {
        [OperationContract]
        Employee[] GetEmployeeList();

        [OperationContract]
        Employee GetEmployeeItem(<span class="kwrd">int</span> id);
    }
}
</pre>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_16.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_7.png" width="1044" height="810"></a> </p>
<p>接下来修改EmployeeService.svc.cs</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Runtime.Serialization;
<span class="kwrd">using</span> System.ServiceModel;
<span class="kwrd">using</span> System.Text;

<span class="kwrd">namespace</span> NorthwindService
{
    <span class="rem">// NOTE: You can use the "Rename" command on the "Refactor" menu to change the class name "EmployeeService" in code, svc and config file together.</span>
    <span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeService : IEmployeeService
    {

        <span class="kwrd">public</span> Employee[] GetEmployeeList()
        {
            NorthwindDataContext context = <span class="kwrd">new</span> NorthwindDataContext();
            <span class="kwrd">return</span> context.Employees.ToArray();
        }

        <span class="kwrd">public</span> Employee GetEmployeeItem(<span class="kwrd">int</span> id)
        {
            NorthwindDataContext context = <span class="kwrd">new</span> NorthwindDataContext();
            <span class="kwrd">return</span> context.Employees.FirstOrDefault(e =&gt; e.EmployeeID == id);
        }
    }
}
</pre>
<p>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_20.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_9.png" width="1044" height="810"></a> 
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>这样就好了，下面我们可以测试该服务了</p>
<p>选中“EmployeeService.svc”这个文件，右键，</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_22.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_10.png" width="704" height="530"></a> </p>
<p>如果看到下面这样的界面，则基本上是表示服务创建没有什么大的问题</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_24.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_11.png" width="1044" height="810"></a> </p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>点击<a href="http://localhost:8027/EmployeeService.svc?wsdl">http://localhost:8027/EmployeeService.svc?wsdl</a>这个链接</p>
<p>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_26.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_12.png" width="1044" height="810"></a> </p>
<p>我们可以用一个工具来测试一下到底能不能返回正确的结果</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_28.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_13.png" width="1044" height="810"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_30.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_14.png" width="1044" height="810"></a> </p>
<p>点击“File”=》”Add Service”,然后输入服务地址</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_32.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_15.png" width="1044" height="810"></a> </p>
<p>【注意】你的地址可能和我不一样，主要检查端口号</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_34.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_16.png" width="1044" height="810"></a> </p>
<p>双击GetEmployeeItem，输入一个id的值（例如10），然后点击 ”Invoke“按钮</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_36.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_17.png" width="1044" height="810"></a> </p>
<p>好，如果是这样的话，则表示该服务是能够正常工作的。</p>
<p>&nbsp;</p>
<h2>2. 创建BCS 内容类型，使用该服务</h2>
<p>既然服务准备好了，下面我们就来看看如何在BCS外部内容类型中使用该服务</p>
<p>首先，仍然是在下面的界面中，点击左上角的 “External Content Type”按钮</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_38.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_18.png" width="704" height="530"></a> </p>
<p>然后做一些必要的修改，使界面看起来像下面这样</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_40.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_19.png" width="1044" height="810"></a> </p>
<p>仍然是点击”Click here to discover external data sources …“</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_42.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_20.png" width="1044" height="810"></a> </p>
<p>再次点击 “Add Connection”</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_44.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_21.png" width="1044" height="810"></a> </p>
<p>将Type设置为WCF Service</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_46.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_22.png" width="1044" height="810"></a> </p>
<p>Ooooop ,我收到了一个错误</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_48.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_23.png" width="1044" height="810"></a> </p>
<p>它的意思是说，不能使用localhost这个写法。好吧，我们从善如流吧。我们可以将网站发布到IIS</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_54.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_26.png" width="1044" height="810"></a></p>
<p>【注意】这个发布向导是VS2010新增的，还可以</p>
<p>&nbsp;</p>
<p>发布之后，应该可以看到IIS中如下的效果</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_56.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_27.png" width="1044" height="810"></a> </p>
<p>然后，我们确认在浏览器中，可以通过下面的地址访问到服务</p>
<p><a title="http://nymoss2010/NorthwindServices/EmployeeService.svc" href="http://nymoss2010/NorthwindServices/EmployeeService.svc">http://nymoss2010/NorthwindServices/EmployeeService.svc</a></p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_58.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_28.png" width="1044" height="810"></a> </p>
<p>修改下面的地址</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_60.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_29.png" width="1044" height="810"></a> </p>
<p>但是却仍然是报告错误</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_62.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_30.png" width="1044" height="810"></a> </p>
<p>My God !<a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/%E5%A4%AA%E4%BC%A4%E5%BF%83%E4%BA%86_2.gif" class="thickbox"><img title="太伤心了" border="0" alt="太伤心了" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/%E5%A4%AA%E4%BC%A4%E5%BF%83%E4%BA%86_thumb.gif" width="42" height="42"></a>  好吧，再大的困难也难不倒英雄的中华儿女们。为了排除到底是不是IIS的问题，我们可以单独来做一个宿主好了。</p>
<p>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_64.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_31.png" width="1044" height="810"></a> </p>
<p>添加引用</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_66.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_32.png" width="1044" height="810"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_68.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_33.png" width="1044" height="810"></a> </p>
<p>在Main方法中编写如下代码</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Text;
<span class="kwrd">using</span> System.ServiceModel;
<span class="kwrd">using</span> NorthwindService;
<span class="kwrd">using</span> System.ServiceModel.Description;

<span class="kwrd">namespace</span> EmployeeServiceHost
{
    <span class="kwrd">class</span> Program
    {
        <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
        {
            <span class="kwrd">using</span> (ServiceHost host = <span class="kwrd">new</span> ServiceHost(
                <span class="kwrd">typeof</span>(EmployeeService), <span class="kwrd">new</span> Uri(<span class="str">"http://nymoss2010/NorthwindService"</span>)))
            {
                host.AddServiceEndpoint(
                    <span class="kwrd">typeof</span>(IEmployeeService).FullName,
                    <span class="kwrd">new</span> BasicHttpBinding(),
                    <span class="str">""</span>);


                ServiceMetadataBehavior behavior = <span class="kwrd">new</span> ServiceMetadataBehavior();
                behavior.HttpGetEnabled = <span class="kwrd">true</span>;
                host.Description.Behaviors.Add(behavior);

                host.AddServiceEndpoint(
                    <span class="str">"IMetadataExchange"</span>,
                    MetadataExchangeBindings.CreateMexHttpBinding(),
                    <span class="str">"mex"</span>);

                host.Open();
                Console.WriteLine(<span class="str">"Server is ready"</span>);
                Console.Read();

            }
        }
    }
}
</pre>
<p>同时，在这个宿主中添加一个配置文件app.config，编辑内容如下
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br>&lt;configuration&gt;<br>&nbsp; &lt;connectionStrings&gt;<br>&nbsp;&nbsp;&nbsp; &lt;add name="NorthwindConnectionString" connectionString="Data Source=(local);Initial Catalog=Northwind;Integrated Security=True"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; providerName="System.Data.SqlClient" /&gt;<br>&nbsp; &lt;/connectionStrings&gt;<br>&lt;/configuration&gt;
<p>&nbsp;</p>
<p>将该程序启动为调试状态</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_70.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_34.png" width="1044" height="810"></a> </p>
<p>然后可以通过下面地址访问到该服务</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_72.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_35.png" width="1044" height="810"></a> </p>
<p>然后再去添加该服务吧</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_74.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_36.png" width="1044" height="810"></a> </p>
<p>【注意】Service Metadata URL是有一个?wsdl的后缀的</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_76.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_37.png" width="1044" height="810"></a> </p>
<p>【注意】我们发现现在是可以了。所以刚才那个应该是IIS某些地方出了问题，也可能是因为beta版的缘故吧。暂时不理会它。</p>
<p>&nbsp;</p>
<p>选中 “GetEmployeeList”，右键，选择”New Read List Operation“</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_82.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_40.png" width="704" height="530"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_84.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_41.png" width="1044" height="810"></a> </p>
<p>点击Next</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_86.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_42.png" width="1044" height="810"></a> </p>
<p>继续Next</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_88.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_43.png" width="1044" height="810"></a> </p>
<p>选中”EmployeeId“，将其Map toIdentifier</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_90.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_44.png" width="1044" height="810"></a> </p>
<p>点击Finish完成该Operation的定义</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_92.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_45.png" width="1044" height="810"></a> </p>
<p>然后，我们再 选中GetEmployeeItem，右键，New Read Item Operation</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_94.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_46.png" width="704" height="530"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_96.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_47.png" width="1044" height="810"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_98.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_48.png" width="1044" height="810"></a> </p>
<p>【注意】这里也需要Map to identifier</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_100.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_49.png" width="1044" height="810"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_102.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_50.png" width="1044" height="810"></a> </p>
<p>保存（CTRL+S) ,然后点击“Create Lists &amp; Form”按钮</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_104.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_51.png" width="1044" height="810"></a> </p>
<p>&nbsp;</p>
<p>创建成功之后，我们兴冲冲地去网页中查看这个列表，却发现如下的错误</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_106.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_52.png" width="1044" height="810"></a> </p>
<p>这是好事多磨啊，<a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/%E5%95%8A_2.gif" class="thickbox"><img title="啊" border="0" alt="啊" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/%E5%95%8A_thumb.gif" width="42" height="42"></a>&nbsp; focus，focus……. 继续排除错误</p>
<p>我用之前用过的一个工具，来确认一下方法哪里出了问题。我发现果然是那个GetEmployeeList出现了问题</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_108.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_53.png" width="1044" height="810"></a> </p>
<p>但是，GetEmployeeitem却是可以返回的</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_110.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_54.png" width="1044" height="810"></a> </p>
<p>那么，这说明什么问题呢？我联想到员工表是有一个相片字段的，而相片的长度是很长的，应该是总的数据量超过了WCF的默认限制（64KB）所导致的问题</p>
<p>&nbsp;</p>
<p>为了验证我的想法，我修改一下源代码</p><pre class="csharpcode">        <span class="kwrd">public</span> Employee[] GetEmployeeList()
        {
            <span class="rem">//NorthwindDataContext context = new NorthwindDataContext();</span>
            <span class="rem">//return context.Employees.ToArray();</span>
            <span class="kwrd">return</span> <span class="kwrd">new</span> Employee[]{
                <span class="kwrd">new</span> Employee(){EmployeeID=1,FirstName=<span class="str">"Ares"</span>,LastName=<span class="str">"Chen"</span>}
            };
        }
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>然后再测试</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_112.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_55.png" width="1044" height="810"></a> </p>
<p>现在就可以正常返回了。所以，我们如果回到网页中去，刷新列表，应该也是可以的</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_114.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_56.png" width="1044" height="810"></a>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_116.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_57.png" width="1044" height="810"></a> </p>
<p>为了避免图片导致数据太大，我们修改了代码如下。</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Runtime.Serialization;
<span class="kwrd">using</span> System.ServiceModel;
<span class="kwrd">using</span> System.Text;

<span class="kwrd">namespace</span> NorthwindService
{
    <span class="rem">// NOTE: You can use the "Rename" command on the "Refactor" menu to change the class name "EmployeeService" in code, svc and config file together.</span>
    <span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeService : IEmployeeService
    {

        <span class="kwrd">public</span> Employee[] GetEmployeeList()
        {
            NorthwindDataContext ctx = <span class="kwrd">new</span> NorthwindDataContext();
            List&lt;Employee&gt; result = <span class="kwrd">new</span> List&lt;Employee&gt;();
            <span class="kwrd">foreach</span> (var e <span class="kwrd">in</span> ctx.Employees)
            {
                result.Add(<span class="kwrd">new</span> Employee
                        {
                            EmployeeID = e.EmployeeID,
                            FirstName = e.FirstName,
                            LastName = e.LastName,
                            Country = e.Country,
                            Region = e.Region,
                            City = e.City
                        });

            }
            <span class="kwrd">return</span> result.ToArray();

        }

        <span class="kwrd">public</span> Employee GetEmployeeItem(<span class="kwrd">int</span> id)
        {
            NorthwindDataContext context = <span class="kwrd">new</span> NorthwindDataContext();
            var e = context.Employees.FirstOrDefault(emp =&gt; emp.EmployeeID == id);

            <span class="kwrd">return</span> <span class="kwrd">new</span> Employee
                        {
                            EmployeeID = e.EmployeeID,
                            FirstName = e.FirstName,
                            LastName = e.LastName,
                            Country = e.Country,
                            Region = e.Region,
                            City = e.City
                        };

                       
            
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_118.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_58.png" width="1044" height="810"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_120.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201022BCSWCF_C36F/image_thumb_59.png" width="1044" height="810"></a> </p>
<p>&nbsp;</p>
<p>【注意】当然，有可以通过调整WCF的binding的一些参数来让它可以传输更多数据量，那属于是WCF本身的技术。大家有兴趣可以参考一下</p>
<p><a href="http://msdn.microsoft.com/en-us/library/system.servicemodel.basichttpbinding.maxbuffersize.aspx">http://msdn.microsoft.com/en-us/library/system.servicemodel.basichttpbinding.maxbuffersize.aspx</a></p>
<p>&nbsp;</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p>总结：这一篇文章讲解了如何结合WCF技术实现应用程序集成设计。这是比直接访问数据库要灵活得多的一种方案。</p>
<p>如你所见，我在写这个文档的时候，估计暴露出来了一些错误的场景，这可以帮助大家更好地学习和掌握有关的技术。</p>