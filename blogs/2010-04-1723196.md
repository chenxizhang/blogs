# MOSS 2010:Visual Studio 2010开发体验（19）&mdash;&mdash;ECMAScript Object Model 
> 原文发表于 2010-04-28, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/04/28/1723196.html 


<p>这篇文章部分材料摘自下面这个地址，我做了翻译，并且按照我的案例场景做了补充</p> <p><a href="http://www.codeproject.com/Articles/60348/SharePoint-2010-Client-Object-Model-for-JavaScript.aspx">http://www.codeproject.com/Articles/60348/SharePoint-2010-Client-Object-Model-for-JavaScript.aspx</a></p> <p>&nbsp;</p> <p>ECMAScript Client OM is SharePoint 2010 client object model extension for using with JavaScript or JScript. Few points to notice about ECMAScript Client OM: <ul> <li>ECMAScript object model can only be used in SharePoint sites. So you can’t use this object model in an asp.net site to access SharePoint resources deployed in another url as this is cross-site scripting and not allowed. （<strong><font color="#ff0000">这个对象模型是只能用在SharePoint页面内部，不能用在单独的网站中。而且也不能跨站访问外部资源</font></strong>） <li>You can’t use this object model in a SharePoint site to access resources in different SharePoint sites(i.e., different urls). For example, from mysite.mysp.com you can access resources in yoursite.yoursp.com using ECMAScript client OM. This is also cross-site scripting. （<strong><font color="#ff0000">即便是在SharePoint的不同站点中，也不能互相访问，其实这也是一种跨站访问</font></strong>） <li>You can use JQuery with ECMAScript Client OM and for this you don’t need to do some extra work. All you need to do to use JQuery is to add reference to JQuery.js file and start using JQuery. （<strong><font color="#ff0000">可以配合jquery使用该对象模型</font></strong>） <li>You can use this ECMAScript Client OM in web part pages or application pages (aspx pages) by referencing a javascript file (SP.js). You don’t need to add reference to the file manually rather use &lt;SharePoint:ScriptLink Name=”sp.js” ………. /&gt;. The file is located on the path “Program Files\Common Files\Microsoft Shared\Web Server Extensions\14\TEMPLATE\LAYOUTS”（<strong><font color="#ff0000">我们可以在WebPart页面或者Application页面中使用该模型，但无需直接添加对其脚本文件SP.JS的引用，而是可以通过一个所谓的链接即可</font></strong>）</li></ul> <p>其实该脚本文件是在下面的位置</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_18.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_8.png" width="1044" height="810"></a> </p> <p>这套客户端对象模型的详细资料，可以参考<a href="http://msdn.microsoft.com/en-us/library/ee538253(office.14).aspx">http://msdn.microsoft.com/en-us/library/ee538253(office.14).aspx</a></p> <p>&nbsp;</p> <p>好了，上面几点我之所以保留中英文，是因为原作者总结得很不错。下面开始我们的ECMAScript Object Model之旅了</p> <p>&nbsp;</p> <p>&nbsp;</p> <h2>1. 为什么需要这个对象模型</h2> <p>这个答案是显而易见的，它提供了在javascript或者Jscript中对SharePoint对象进行存取的机制，例如创建一个列表，或者更新一个列表条目。这个以前可只能通过服务器对象模型，通过C#或者VB.NET这样的语言才能做的。</p> <p>&nbsp;</p> <h2>2. 现在内置的功能中哪些是用到了这个模型？</h2> <p>很多朋友第一次用MOSS 2010的时候都会赞叹说现在的界面体验比以前好多了，一个最明显的区别就是现在不要老是从一个页面跳到另外一个页面，取而代之的是，现在提供了一种弹出对话框的方式进行操作。如下图所示</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_2.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb.png" width="1044" height="810"></a> </p> <p>以上图为例，我们可以通过这样的界面来新建一个项目。当点击保存的时候，其实是需要用javasript的方式去保存该项目的数据。不是吗？此时，基于javascript的对象模型就很重要了。</p> <p>事实上，MOSS 2010很多的地方都用到了这套ECMAScript 对象模型，用于很多页面的异步操作和刷新等功能。</p> <p>&nbsp;</p> <h2>3. 如何使用该模型？</h2> <p>好的，介绍完如上的这些基本概念后，我们就来动手做一个例子吧。还是很前面几篇文章一样，我们需要访问到当前站点的一个Employees列表，然后将其中的年龄小于60岁的员工筛选出来。</p> <p>关于其他几篇文章，如果你没有看过，请参考下面的链接</p> <ul> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2010/04/26/1721653.html">http://www.cnblogs.com/chenxizhang/archive/2010/04/26/1721653.html</a></li> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2010/04/28/1722759.html">http://www.cnblogs.com/chenxizhang/archive/2010/04/28/1722759.html</a></li></ul> <p>&nbsp;</p> <p>我们准备这样来实现这个例子：</p> <ol> <li>用一个专门的Application Page来做，以便理解</li> <li>使用jquery来开发</li></ol> <p>&nbsp;</p> <p>我们还等什么，马上开始吧</p> <p>首先，创建一个空白的SharePoint项目</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_4.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_1.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_6.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_2.png" width="1044" height="810"></a> </p> <p>然后，我们添加一个Application Page</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_8.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_3.png" width="1044" height="810"></a> </p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_10.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_4.png" width="1044" height="810"></a> </p> <p>接下来，添加SP.js的引用，并且对其他几个区域做一些初始化工作</p><pre class="csharpcode"><span class="asp">&lt;%@ Assembly Name="$SharePoint.Project.AssemblyFullName$" %&gt;</span>
<span class="asp">&lt;%@ Import Namespace="Microsoft.SharePoint.ApplicationPages" %&gt;</span>
<span class="asp">&lt;%@ Register Tagprefix="SharePoint" Namespace="Microsoft.SharePoint.WebControls" Assembly="Microsoft.SharePoint, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Register Tagprefix="Utilities" Namespace="Microsoft.SharePoint.Utilities" Assembly="Microsoft.SharePoint, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Register Tagprefix="asp" Namespace="System.Web.UI" Assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" %&gt;</span>
<span class="asp">&lt;%@ Import Namespace="Microsoft.SharePoint" %&gt;</span>
<span class="asp">&lt;%@ Assembly Name="Microsoft.Web.CommandUI, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="MyClientOMPage.aspx.cs" Inherits="SharePointProject1.Layouts.SharePointProject1.MyClientOMPage" DynamicMasterPageFile="~masterurl/default.master" %&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageHead"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderAdditionalPageHead"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">SharePoint:ScriptLink</span> <span class="attr">Name</span><span class="kwrd">="SP.JS"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">OnDemand</span><span class="kwrd">="true"</span> <span class="attr">Localizable</span><span class="kwrd">="false"</span><span class="kwrd">&gt;&lt;/</span><span class="html">SharePoint:ScriptLink</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="Main"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderMain"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">SharePoint:FormDigest</span> <span class="attr">ID</span><span class="kwrd">="FormDigest1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="kwrd">/&gt;&lt;!</span><span class="html">-如果需要修改数据的话</span>，<span class="attr">则需要添加这个</span>，<span class="attr">以便做身份信息的校验--</span><span class="kwrd">&gt;</span>

<span class="rem">&lt;!--下面这个表格将用来填充员工数据--&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">table</span> id=”employees” <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">border</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">thead</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>FirstName<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>LastName<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">thead</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">tbody</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">tr</span> <span class="attr">id</span><span class="kwrd">="template"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">tbody</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageTitle"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderPageTitle"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
ECMAScript 客户端对象模型演示页面
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageTitleInTitleArea"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderPageTitleInTitleArea"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="kwrd">&gt;</span>
Employee List
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>接下来，我们准备使用jquery来提供更加好的javascript编写体验。（在处理DOM元素方面，jquery的确很棒，我已经不能掩饰对它的喜爱）</p>
<p>关于jquery的官方资料，可以参考<a href="http://jquery.com/">http://jquery.com/</a></p>
<p>其实，如果你在用VS 2010做网站开发，就会发现默认就有jquery方面的脚本。你可以随便创建一个空白的Web Application.就可以看到有三个js文件。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_12.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_5.png" width="1044" height="810"></a> </p>
<p>【注意】在VS2010的正式版中，jquery的版本也升级到了1.4.1</p>
<p>好了，不扯太远了。我们需要将这几个js文件添加到之前的那个项目</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_14.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_6.png" width="1044" height="810"></a> </p>
<p>然后来编写一点脚本吧</p><pre class="csharpcode"><span class="asp">&lt;%@ Assembly Name="$SharePoint.Project.AssemblyFullName$" %&gt;</span>
<span class="asp">&lt;%@ Import Namespace="Microsoft.SharePoint.ApplicationPages" %&gt;</span>
<span class="asp">&lt;%@ Register Tagprefix="SharePoint" Namespace="Microsoft.SharePoint.WebControls" Assembly="Microsoft.SharePoint, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Register Tagprefix="Utilities" Namespace="Microsoft.SharePoint.Utilities" Assembly="Microsoft.SharePoint, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Register Tagprefix="asp" Namespace="System.Web.UI" Assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" %&gt;</span>
<span class="asp">&lt;%@ Import Namespace="Microsoft.SharePoint" %&gt;</span>
<span class="asp">&lt;%@ Assembly Name="Microsoft.Web.CommandUI, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="MyClientOMPage.aspx.cs" Inherits="SharePointProject1.Layouts.SharePointProject1.MyClientOMPage" DynamicMasterPageFile="~masterurl/default.master" %&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageHead"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderAdditionalPageHead"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">SharePoint:ScriptLink</span> <span class="attr">Name</span><span class="kwrd">="SP.JS"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">OnDemand</span><span class="kwrd">="true"</span> <span class="attr">Localizable</span><span class="kwrd">="false"</span><span class="kwrd">&gt;&lt;/</span><span class="html">SharePoint:ScriptLink</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="/_layouts/jquery-1.3.2.min.js"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    
    &lt;script language=<span class="str">"javascript"</span> type=<span class="str">"text/javascript"</span>&gt;
        $(<span class="kwrd">function</span> () {
            <span class="rem">//先不读取对象模型，而是尝试填充一点范例数据</span>
            <span class="kwrd">for</span> (<span class="kwrd">var</span> i = 0; i &lt; 10; i++) {
                <span class="kwrd">var</span> data = $(<span class="str">"#template"</span>).clone();
                data.find(<span class="str">"td:first"</span>).text(<span class="str">"Ares"</span>);
                data.find(<span class="str">"td:last"</span>).text(<span class="str">"Chen"</span>);
                $(<span class="str">"#employees tbody"</span>).append(data);
            }

            $(<span class="str">"#template"</span>).remove();

            $(<span class="str">"#employees tbody tr:even"</span>).css(<span class="str">"background-color"</span>, <span class="str">"silver"</span>);

        });
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="Main"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderMain"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">SharePoint:FormDigest</span> <span class="attr">ID</span><span class="kwrd">="FormDigest1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="kwrd">/&gt;&lt;-</span><span class="html">-如果需要修改数据的话</span>，<span class="attr">则需要添加这个</span>，<span class="attr">以便做身份信息的校验--</span><span class="kwrd">&gt;</span>

<span class="rem">&lt;!--下面这个表格将用来填充员工数据--&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">table</span> <span class="attr">id</span><span class="kwrd">="employees"</span> <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">border</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">thead</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>FirstName<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>LastName<span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">thead</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">tbody</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">tr</span> <span class="attr">id</span><span class="kwrd">="template"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">tbody</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageTitle"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderPageTitle"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
ECMAScript 客户端对象模型演示页面
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageTitleInTitleArea"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderPageTitleInTitleArea"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="kwrd">&gt;</span>
Employee List
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
</pre>
<p>【注意】你可能会问这些javascript写起来有没有什么好的工具呢？当然，请注意我们刚才添加的几个js文件中，有一个vsdoc文件，这就是用于visual studio的智能感知文件</p>
<p>其实，我只是写好之后，将它拿掉了而已。关于如何使用智能感知，可以参考我之前的文章 <a href="http://www.cnblogs.com/chenxizhang/archive/2009/05/27/1490537.html">http://www.cnblogs.com/chenxizhang/archive/2009/05/27/1490537.html</a>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>&nbsp;</p>
<p>现在可以部署该项目，看看效果如何</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_16.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_7.png" width="1044" height="810"></a> </p>
<p>【注意】作为演示，我们并没有花很多时间去做样式方面的设置。</p>
<p>&nbsp;</p>
<p>看起来，已经有些效果了。我们通过javascript的方式动态地生成了10个员工的数据。并且通过交错行的颜色区分，让他们看起来更清楚。</p>
<p>以上的效果确认了之后，我们就进入本篇文章的最后一部分，通过ECMAScript Object Model实现对列表的查询</p>
<p>&nbsp;</p><pre class="csharpcode"><span class="asp">&lt;%@ Assembly Name="$SharePoint.Project.AssemblyFullName$" %&gt;</span>
<span class="asp">&lt;%@ Import Namespace="Microsoft.SharePoint.ApplicationPages" %&gt;</span>
<span class="asp">&lt;%@ Register TagPrefix="SharePoint" Namespace="Microsoft.SharePoint.WebControls"
    Assembly="Microsoft.SharePoint, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Register TagPrefix="Utilities" Namespace="Microsoft.SharePoint.Utilities" Assembly="Microsoft.SharePoint, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>
<span class="asp">&lt;%@ Register TagPrefix="asp" Namespace="System.Web.UI" Assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" %&gt;</span>
<span class="asp">&lt;%@ Import Namespace="Microsoft.SharePoint" %&gt;</span>
<span class="asp">&lt;%@ Assembly Name="Microsoft.Web.CommandUI, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %&gt;</span>

<span class="asp">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="MyClientOMPage.aspx.cs"
    Inherits="SharePointProject1.Layouts.SharePointProject1.MyClientOMPage" DynamicMasterPageFile="~masterurl/default.master" %&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageHead"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderAdditionalPageHead"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="/_layouts/jquery-1.3.2.min.js"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    &lt;SharePoint:ScriptLink ID=<span class="str">"ScriptLink1"</span> Name=<span class="str">"SP.JS"</span> runat=<span class="str">"server"</span>        Localizable=<span class="str">"false"</span> LoadAfterUI=<span class="str">"true"</span>&gt;
    &lt;/SharePoint:ScriptLink&gt;
    &lt;script language=<span class="str">"javascript"</span> type=<span class="str">"text/javascript"</span>&gt;
        <span class="kwrd">var</span> collListItem;
        <span class="kwrd">function</span> LoadEmployees() {
            <span class="kwrd">var</span> clientContext = <span class="kwrd">new</span> SP.ClientContext.get_current();
            <span class="kwrd">var</span> web = clientContext.get_web();
            <span class="kwrd">var</span> list = web.get_lists().getByTitle(<span class="str">'Employees'</span>);
            <span class="kwrd">var</span> camlQuery = <span class="kwrd">new</span> SP.CamlQuery();
            camlQuery.set_viewXml(<span class="str">"&lt;View&gt;&lt;Query&gt;&lt;Where&gt;&lt;Lt&gt;&lt;FieldRef Name='Age' /&gt;&lt;Value Type='Number'&gt;60&lt;/Value&gt;&lt;/Lt&gt;&lt;/Where&gt;&lt;/Query&gt;&lt;RowLimit&gt;100&lt;/RowLimit&gt;&lt;/View&gt;"</span>);
            <span class="kwrd">this</span>.collListItem = list.getItems(camlQuery);
            clientContext.load(<span class="kwrd">this</span>.collListItem);
            clientContext.executeQueryAsync(
Function.createDelegate(<span class="kwrd">this</span>, <span class="kwrd">this</span>.onQuerySucceeded),
Function.createDelegate(<span class="kwrd">this</span>, <span class="kwrd">this</span>.onQueryFailed));
        }

        $(<span class="kwrd">function</span> () { LoadEmployees(); });


        <span class="kwrd">function</span> onQuerySucceeded(<span class="kwrd">object</span>, args) {
            <span class="kwrd">var</span> count = <span class="kwrd">this</span>.collListItem.get_count();
            <span class="kwrd">for</span> (<span class="kwrd">var</span> i = 0; i &lt; count; i++) {
                <span class="kwrd">var</span> item = <span class="kwrd">this</span>.collListItem.itemAt(i);
                <span class="kwrd">var</span> data = $(<span class="str">"#template"</span>).clone();
                data.find(<span class="str">"td:first"</span>).text(item.get_fieldValues()[<span class="str">"FirstName"</span>]);
                data.find(<span class="str">"td:last"</span>).text(item.get_fieldValues()[<span class="str">"LastName"</span>]);
                $(<span class="str">"#employees tbody"</span>).append(data);

            }

            $(<span class="str">"#template"</span>).remove();
            $(<span class="str">"#employees tbody tr:even"</span>).css(<span class="str">"background-color"</span>, <span class="str">"silver"</span>);
        }

        <span class="kwrd">function</span> onQueryFailed(<span class="kwrd">object</span>, args) {
            alert(<span class="str">"加载列表出现异常:"</span> + args.message);
        }
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="Main"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderMain"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">SharePoint:FormDigest</span> <span class="attr">ID</span><span class="kwrd">="FormDigest1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;!</span><span class="html">-如果需要修改数据的话</span>，<span class="attr">则需要添加这个</span>，<span class="attr">以便做身份信息的校验--</span><span class="kwrd">&gt;</span>
    <span class="rem">&lt;!--下面这个表格将用来填充员工数据--&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">input</span> <span class="attr">type</span><span class="kwrd">="button"</span> <span class="attr">onclick</span><span class="kwrd">="LoadEmployees()"</span> <span class="attr">value</span><span class="kwrd">="加载数据"</span> <span class="kwrd">/&gt;&lt;</span><span class="html">hr</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">table</span> <span class="attr">id</span><span class="kwrd">="employees"</span> <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">border</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">thead</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">tr</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                    FirstName
                <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                    LastName
                <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">thead</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">tbody</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">tr</span> <span class="attr">id</span><span class="kwrd">="template"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">td</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">td</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">tr</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">tbody</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">table</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageTitle"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderPageTitle"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    ECMAScript 客户端对象模型演示页面
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="PageTitleInTitleArea"</span> <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="PlaceHolderPageTitleInTitleArea"</span>
    <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    Employee List
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
<pre class="csharpcode">【注意】编写这个脚本没有办法使用智能感知。我同意，这是比较麻烦一些的。目前来说，你还是应该多查<a href="http://msdn.microsoft.com/en-us/library/ee538253(office.14).aspx">http://msdn.microsoft.com/en-us/library/ee538253(office.14).aspx</a></pre><pre class="csharpcode">&nbsp;</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_20.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_9.png" width="1044" height="810"></a> </p>
<p>【注意】页面上这个按钮并不是必须的。我只是为了测试方便放在上面的。</p>
<p>&nbsp;</p>
<p>好了，该庆祝一下了。<img title="未命名" alt="未命名" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/%E6%9C%AA%E5%91%BD%E5%90%8D_3.gif" width="100" height="100"> </p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>但是，它到底是怎么工作的呢？</p>
<p>其实，通过工具一监控我们就能看出来，其实它不过也就是调用了一个client.svc的服务，执行有关的操作而已</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_22.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_10.png" width="1044" height="810"></a> </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_24.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio201019ECMAScriptObje_F66F/image_thumb_11.png" width="1044" height="810"></a> </p>
<p>其实它返回的数据是一段json</p>
<p>&nbsp;</p><pre class="csharpcode">[
{
"SchemaVersion":"14.0.0.0","LibraryVersion":"14.0.4536.1000","ErrorInfo":null
},1,{
"IsNull":false
},3,{
"IsNull":false
},5,{
"IsNull":false
},7,{
"IsNull":false
},8,{
"_ObjectIdentity_":"740c6a0b-85e2-48a0-a494-e0f1759d4aa7:web:a50d9eca-848c-4f11-9dca-e1a7ddc01cb3:list:a07b5ffe-b6a1-4e0b-aa66-e5ffb7f6f06c"
},10,{
"IsNull":false
},11,{
"_ObjectType_":"SP.ListItemCollection","ListItemCollectionPosition":null,"_Child_Items_":[
{
"_ObjectType_":"SP.ListItem","_ObjectIdentity_":"740c6a0b-85e2-48a0-a494-e0f1759d4aa7:web:a50d9eca-848c-4f11-9dca-e1a7ddc01cb3:list:a07b5ffe-b6a1-4e0b-aa66-e5ffb7f6f06c:item:1,1","_ObjectVersion_":"1","Id":1,"FileSystemObjectType":0,"ContentTypeId":{
"_ObjectType_":"SP.ContentTypeId","StringValue":"0x0100C28FC2EA6E2236489CE7A12D5313F362"
},"Title":null,"_ModerationComments":null,"File_x0020_Type":null,"EmployeeID":1,"FirstName":"Ares","LastName":"Chen","Age":25,"ID":1,"Modified":"\/Date(1272265389000)\/","Created":"\/Date(1272265389000)\/","Author":{
"_ObjectType_":"SP.FieldUserValue","LookupId":1073741823,"LookupValue":"\u7cfb\u7edf\u5e10\u6237"
},"Editor":{
"_ObjectType_":"SP.FieldUserValue","LookupId":1073741823,"LookupValue":"\u7cfb\u7edf\u5e10\u6237"
},"_HasCopyDestinations":null,"_CopySource":null,"owshiddenversion":1,"WorkflowVersion":1,"_UIVersion":512,"_UIVersionString":"1.0","Attachments":false,"_ModerationStatus":0,"InstanceID":null,"Order":100,"GUID":"\/Guid(e98a7765-5cee-4d4d-b4b5-273a0e2c5d35)\/","WorkflowInstanceID":null,"FileRef":"\u002fsites\u002fdev\u002fLists\u002fEmployees\u002f1_.000","FileDirRef":"\u002fsites\u002fdev\u002fLists\u002fEmployees","Last_x0020_Modified":"2010-04-26T07:03:09Z","Created_x0020_Date":"2010-04-26T07:03:09Z","FSObjType":"0","SortBehavior":{
"_ObjectType_":"SP.FieldLookupValue","LookupId":1,"LookupValue":"0"
},"FileLeafRef":"1_.000","UniqueId":"\/Guid(aa56e815-1a5f-4059-80e4-e1122a056222)\/","SyncClientId":{
"_ObjectType_":"SP.FieldLookupValue","LookupId":1,"LookupValue":null
},"ProgId":"","ScopeId":"{1DFA4219-116B-4E85-BCAF-8668049B05DF}","MetaInfo":"","_Level":1,"_IsCurrentVersion":true,"ItemChildCount":"0","FolderChildCount":"0"
},{
"_ObjectType_":"SP.ListItem","_ObjectIdentity_":"740c6a0b-85e2-48a0-a494-e0f1759d4aa7:web:a50d9eca-848c-4f11-9dca-e1a7ddc01cb3:list:a07b5ffe-b6a1-4e0b-aa66-e5ffb7f6f06c:item:2,1","_ObjectVersion_":"1","Id":2,"FileSystemObjectType":0,"ContentTypeId":{
"_ObjectType_":"SP.ContentTypeId","StringValue":"0x0100C28FC2EA6E2236489CE7A12D5313F362"
},"Title":null,"_ModerationComments":null,"File_x0020_Type":null,"EmployeeID":2,"FirstName":"Bill","LastName":"Shan","Age":30,"ID":2,"Modified":"\/Date(1272265422000)\/","Created":"\/Date(1272265422000)\/","Author":{
"_ObjectType_":"SP.FieldUserValue","LookupId":1073741823,"LookupValue":"\u7cfb\u7edf\u5e10\u6237"
},"Editor":{
"_ObjectType_":"SP.FieldUserValue","LookupId":1073741823,"LookupValue":"\u7cfb\u7edf\u5e10\u6237"
},"_HasCopyDestinations":null,"_CopySource":null,"owshiddenversion":1,"WorkflowVersion":1,"_UIVersion":512,"_UIVersionString":"1.0","Attachments":false,"_ModerationStatus":0,"InstanceID":null,"Order":200,"GUID":"\/Guid(dd831bd4-fc64-4491-bd7c-61a7a24c1d08)\/","WorkflowInstanceID":null,"FileRef":"\u002fsites\u002fdev\u002fLists\u002fEmployees\u002f2_.000","FileDirRef":"\u002fsites\u002fdev\u002fLists\u002fEmployees","Last_x0020_Modified":"2010-04-26T07:03:42Z","Created_x0020_Date":"2010-04-26T07:03:42Z","FSObjType":"0","SortBehavior":{
"_ObjectType_":"SP.FieldLookupValue","LookupId":2,"LookupValue":"0"
},"FileLeafRef":"2_.000","UniqueId":"\/Guid(7cbffcdb-122f-440e-9d73-9ad952d3a4e0)\/","SyncClientId":{
"_ObjectType_":"SP.FieldLookupValue","LookupId":2,"LookupValue":null
},"ProgId":"","ScopeId":"{1DFA4219-116B-4E85-BCAF-8668049B05DF}","MetaInfo":"","_Level":1,"_IsCurrentVersion":true,"ItemChildCount":"0","FolderChildCount":"0"
}
]
}
]</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>那么这个client.svc到底是何方神圣呢？我们在其他地方能不能使用它呢？这个问题，请听下回分解吧</p>