# XMLDatabase项目已经发布到nuget gallery 
> 原文发表于 2011-06-25, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/25/2090180.html 


<p>如果你在使用Visual Studio 2010，你应该了解nuget。如果你还是不了解，可以参考下面这些介绍</p> <p><a href="http://zzk.cnblogs.com/s?w=nuget">http://zzk.cnblogs.com/s?w=nuget</a></p> <p>&nbsp;</p> <p>今天介绍一下，之前我开发过的一个开源数据库项目（XMLDatabase）也已经发布到了unget gallery,有兴趣的朋友可以在项目中使用</p> <p>该项目的永久位置在：<a href="http://xmldatabase.codeplex.com/">http://xmldatabase.codeplex.com/</a></p> <p>该项目的文档和范例程序在：<a href="http://xmldatabase.codeplex.com/releases/view/32227">http://xmldatabase.codeplex.com/releases/view/32227</a></p> <p>以前在我的博客中也讨论过这个项目</p> <ul> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2009/08/08/1541888.html">http://www.cnblogs.com/chenxizhang/archive/2009/08/08/1541888.html</a></li> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2009/08/09/1542354.html">http://www.cnblogs.com/chenxizhang/archive/2009/08/09/1542354.html</a></li> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2009/08/11/1543908.html">http://www.cnblogs.com/chenxizhang/archive/2009/08/11/1543908.html</a></li> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2009/08/12/1544105.html">http://www.cnblogs.com/chenxizhang/archive/2009/08/12/1544105.html</a></li></ul> <p>回过去看这些文字，一晃又是两年快要过去了啊，虽然又是感慨时间是过得真快。呵呵</p> <p>这个项目上次发布之后，我在一些项目中用过，还没有大面积使用。源代码也没有太太改动，之前有些朋友跟我联系过，期间也修正了一些小的bug。以后看情况也可能会继续做些升级。例如支持Silverlight等。(目前还没有时间表）</p> <p>如果有兴趣的朋友，也可以研究一下代码，我也欢迎大家提出一些建设性的建议和想法。</p> <p>&nbsp;</p> <p>如何在你的项目中使用它呢？你需要确保你安装好了nuget这个插件。如果你还没有下载，请访问官方站点 <a href="http://www.nuget.org/">http://www.nuget.org/</a></p> <p>如果安装好了，则可以在项目中，选择“References”，右键，然后选择”Manag NuGet Packages…”</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110625144044990.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440447119.png" width="704" height="530"></a></p> <p>然后在接下来的这个对话框中，输入xmldatabase进行搜索，就可以找到这个package</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110625144044184.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440448024.png" width="802" height="608"></a></p> <p>点击“install”按钮，会有一个License Acceptance的对话框。该开源项目使用的协议是：Microsoft Public License (Ms-PL)</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440457185.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440454153.png" width="354" height="304"></a></p> <p>点击“I Accept”,就可以完成安装</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440459726.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440459203.png" width="804" height="609"></a></p> <p>完成安装之后，会自动添加好dll引用，而且会有一个readme文件，帮助大家更好地了解这个开源项目</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440453140.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251440463696.png" width="307" height="234"></a></p> <p>【备注】目前只支持.NET Framework 3.5和.NET Framework 4.0</p> <p>&nbsp;</p> <p>然后，你可以参考下面范例代码进行数据库的操作</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Text;

<span class="preproc">#region</span> 添加两个命名空间
<span class="kwrd">using</span> XmlDatabase.Core;
<span class="kwrd">using</span> DataEntities;
<span class="preproc">#endregion</span>

<span class="kwrd">namespace</span> SampleApp
{
    <span class="kwrd">class</span> Program
    {
        <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
        {
            <span class="rem">//这个程序演示了XmlDatabase的简单使用方式.注意，目前的版本是alpha，后续可能还会有所更改</span>


            <span class="rem">//第一步：创建或者打开一个数据库</span>
            <span class="kwrd">using</span> (XDatabase db = XDatabase.Open(<span class="str">"Test"</span>))
            {
                <span class="rem">//如果要重定向日志输出，请使用下面的语法即可</span>
                db.Log = Console.Out;


                <span class="preproc">#region</span> <span class="rem">//第二步：创建几个数据实体类型.</span>
                <span class="rem">//值得说明一下，这些数据实体类型没有任何特殊的要求，不需要添加任何的Attribute。但最好是遵守以下的两条简单的规则</span>
                <span class="rem">//1.属性都是可读可写的，都是Public的</span>
                <span class="rem">//2.重写ToString方法，这是为了让引擎在做日志记录的时候用的</span>

                Customer customer = <span class="kwrd">new</span> Customer()
                {
                    CustomerID = <span class="str">"ALFKI"</span>,
                    CompanyName = <span class="str">"Alfreds Futterkiste"</span>,
                    Country = <span class="str">"Germany"</span>,
                    Region = <span class="str">"BC"</span>,
                    City = <span class="str">"Berlin"</span>,
                    ContactName = <span class="str">"Maria Anders"</span>,
                    Address = <span class="str">"Obere Str. 57"</span>
                };

                Employee employee = <span class="kwrd">new</span> Employee()
                {
                    EmployeeId = 1,
                    FirstName = <span class="str">"Nancy"</span>,
                    LastName = <span class="str">"Davolio"</span>,
                    Title = <span class="str">"Sales Representative"</span>
                };


                Product product = <span class="kwrd">new</span> Product()
                {
                    ProductId = 1,
                    ProductName = <span class="str">"Chai"</span>
                };
                
                Order Order = <span class="kwrd">new</span> Order()
                {
                    OrderID = 10248,
                    OrderDate = DateTime.Now,
                    Customer = customer,
                    Employee = employee,
                    OrderItems = <span class="kwrd">new</span> List&lt;OrderItem&gt;()
                    {
                        <span class="kwrd">new</span> OrderItem(){
                            Product=product,
                            UnitPrice=20.5m,
                            Quantity=3
                        },
                        <span class="kwrd">new</span> OrderItem(){
                            Product=<span class="kwrd">new</span> Product(){ 
                                ProductId=2, 
                                ProductName=<span class="str">"Grandma's Boysenberry Spread"</span>},
                            UnitPrice=333,
                            Quantity=1
                        }
                    }
                };

                <span class="preproc">#endregion</span>


                <span class="rem">//第三步：插入对象</span>
                db.Store(Order);<span class="rem">//只要调用该方法就可以了。默认情况下，这是立即生效的</span>

                Customer c = <span class="kwrd">new</span> Customer() { CustomerID = <span class="str">"ABCD"</span> };
                db.Store(c);
                var cs = db.Query&lt;Customer&gt;().First();
                Console.WriteLine(cs);

                
                <span class="rem">//第四步：读取对象 （这里还可以做任何的LINQ查询操作）</span>
                var query = from o <span class="kwrd">in</span> db.Query&lt;Order&gt;()
                            <span class="kwrd">where</span> o.OrderID==10248
                            select o;
                Order firstOrder = query.First();
                Console.WriteLine(<span class="str">"{0},总金额为:{1}"</span>, firstOrder, firstOrder.OrderItems.Sum(i =&gt; i.Quantity * i.UnitPrice));


                <span class="rem">//第五步：更新对象</span>
                firstOrder.OrderID = 10249;<span class="rem">//假设我们修改一下订单编号</span>
                <span class="rem">//你还可以对该对象做任何的修改，例如增加一个订单记录</span>
                firstOrder.OrderItems.Add(<span class="kwrd">new</span> OrderItem()
                {
                    Product = <span class="kwrd">new</span> Product() { ProductId = 3, ProductName = <span class="str">"Mishi Kobe Niku"</span> },
                    UnitPrice = 10000,
                    Quantity = 1
                });

                db.Store(firstOrder);<span class="rem">//更新的语法与刚才插入的时候是一模一样的，内部会判断出来到底是更新还是新增</span>
                Console.WriteLine(<span class="str">"{0},总金额为:{1}"</span>, firstOrder, firstOrder.OrderItems.Sum(i =&gt; i.Quantity * i.UnitPrice));


                <span class="rem">//第六步：删除对象</span>
                db.Delete(firstOrder);

                <span class="rem">//第七步：批处理（上面的操作都是立即生效的，如果操作数不多的话，很简单也很直接，但因为每次都涉及到数据文件的读写，如果我们有一个循环，要批量做一些事情，则可能会有性能方面的问题，所以下面提供了批处理模式）</span>

                <span class="rem">//首先得将数据库的模式切换到批处理模式</span>
                db.AutoSubmitMode = <span class="kwrd">false</span>;
                <span class="kwrd">for</span> (<span class="kwrd">int</span> i = 0; i &lt; 10; i++)
                {
                    Order temp = <span class="kwrd">new</span> Order()
                    {
                        OrderID = 10248,
                        OrderDate = DateTime.Now,
                        Customer = customer,
                        Employee = employee,
                        OrderItems = <span class="kwrd">new</span> List&lt;OrderItem&gt;()
                    {
                        <span class="kwrd">new</span> OrderItem(){
                            Product=product,
                            UnitPrice=20.5m,
                            Quantity=3
                        },
                        <span class="kwrd">new</span> OrderItem(){
                            Product=<span class="kwrd">new</span> Product(){ 
                                ProductId=2, 
                                ProductName=<span class="str">"Grandma's Boysenberry Spread"</span>},
                            UnitPrice=333,
                            Quantity=1
                        }
                    }
                    };

                    db.Store(temp);<span class="rem">//语法还是一模一样的</span>
                }

                <span class="rem">//区别在于，如果是批处理模式，则必须明确地调用SubmitChanges才生效</span>
                XSubmitStatus status = db.SubmitChanges();
                <span class="rem">//这个SubmitChanges方法默认情况下，如果遇到某个操作出错，那么后面的操作就不会进行了。</span>
                <span class="rem">//如果希望出错后继续，那么应该使用下面的语法</span>
                <span class="rem">//XSubmitStatus status=db.SubmitChanges(true);</span>

                <span class="rem">//第八步：事务性操作</span>
                <span class="rem">//要进行事务性操作，必须处于批处理模式中。我最后将它做了简化，调用下面的方法即可</span>
                <span class="rem">//XSubmitStatus status = db.SubmitChangesWithTransaction();</span>


                <span class="rem">//第九步：关闭数据库</span>
                db.Close();
            }

            Console.Read();
            <span class="rem">//后续任务</span>
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>希望这样可以更加方便大家使用这个组件。如果有什么反馈建议，请给我留言或者邮件。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>最后，很多朋友可能都感兴趣，我自己如何发布Package呢？其实不难，请参考下面的两个链接</p>
<h3>Creating and Publishing a Package</h3>
<p><a href="http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package">http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package</a></p>
<p>&nbsp;</p>
<h3>Using A GUI (Package Explorer) to build packages</h3>
<p><a href="http://docs.nuget.org/docs/creating-packages/using-a-gui-to-build-packages#Creating_a_Package">http://docs.nuget.org/docs/creating-packages/using-a-gui-to-build-packages#Creating_a_Package</a></p>