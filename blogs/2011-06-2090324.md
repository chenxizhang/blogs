# 通过t4模板结合XML定义文件生成MVVM中的Model Entity Class 代码 
> 原文发表于 2011-06-25, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/25/2090324.html 


<p>在之前的两篇文章，我针对MVVM项目实践中如何简化Model和ViewModel类型的编码工作，提供了两种不同的方法。它们分别是</p> <ul> <li> <h4><a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/24/2089392.html">如何利用AOP简化MVVM中Model和ViewModel的设计</a></h4></li> <ul> <li><a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/24/2089392.html">http://www.cnblogs.com/chenxizhang/archive/2011/06/24/2089392.html</a></li></ul> <li> <h4><a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/24/2089431.html">如何利用Interception简化MVVM中的Model和ViewModel的设计</a></h4></li> <ul> <li> <p><a href="http://www.cnblogs.com/chenxizhang/archive/2011/06/24/2089431.html">http://www.cnblogs.com/chenxizhang/archive/2011/06/24/2089431.html</a></p></li></ul></ul> <p>这一篇是这个话题的最后一篇，将提供第三种方法。</p> <p>我们的思路就是，AOP和Interception都是需要做代码注入的，它们的使用也或多越少会有一些特殊的要求，例如Interception这种做法，它将使得我们无法直接通过new的方式创建Model的实例。那么是否可以有办法不进行这些复杂的步骤，而只是通过一些自动化的方式来生成我们需要的Model类型代码呢？</p> <p>答案是：有。在Visual Studio 2010中全新支持的t4模板将很好地支持这一点。我记得多年前，我用过CodeSmith等一些工具生成代码，感觉还是不错的。但这些工具或多或少都需要收费，现在Visual Studio 2010既然内置支持代码生成，对我们来说绝对是一个好消息。</p> <p>&nbsp;</p> <p>关于t4模板，以及一些基本概念，请参考</p> <p><a href="http://msdn.microsoft.com/en-us/library/bb126445.aspx">http://msdn.microsoft.com/en-us/library/bb126445.aspx</a></p> <p>&nbsp;</p> <p>好了，我介绍一下我编写的这个模板吧。我的思路是这样的</p> <p>1. 通过一个XML文件，定义项目中所需要的Model类型以及他们的属性</p> <p>2. 通过一个t4模板，读取该XML文件，并且生成所有有关的Class，包括ModelBase，和每个Model</p> <p>&nbsp;</p> <h1>第一步，定义XML文件(我称其为ModelsDef文件）</h1><pre class="csharpcode"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">ModelsDef</span><span class="kwrd">&gt;</span>
  
  <span class="rem">&lt;!--根节点上面还可以指定所有模型的基类，默认为ModelBase--&gt;</span>
  
  <span class="rem">&lt;!--</span>
<span class="rem">    MVVM实体模型定义文件</span>
<span class="rem">    作者：陈希章</span>
<span class="rem">    时间：2011年6月</span>
<span class="rem">    说明：该文件是用来生成业务实体模型代码的，将结合t4模板生成。</span>
<span class="rem">    反馈：ares@xizhang.com</span>
<span class="rem">  --&gt;</span>

  <span class="rem">&lt;!--</span>
<span class="rem">    这里开始定义模型（下面是几个范例，你可以根据它们进行修改</span>
<span class="rem">    规范：</span>
<span class="rem">    1. 每个业务实体，定义一个Model元素，必须要有name（整个定义文件中，至少得有一个Model元素）</span>
<span class="rem">    2. 每个实体至少要有一个属性:Property</span>
<span class="rem">    3. 属性有三种定义方式</span>
<span class="rem">       3.1 只提供name属性，则表示该Property为string类型</span>
<span class="rem">       3.2 如果不是string类型，则需要指定type</span>
<span class="rem">       3.3 如果是一个集合类型，则需要指定Collection, 并且此时就要指定collectionType</span>
<span class="rem">  --&gt;</span>

  <span class="kwrd">&lt;</span><span class="html">Model</span> <span class="attr">name</span><span class="kwrd">="Customer"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="CustomerID"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="CompanyName"</span><span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">Model</span><span class="kwrd">&gt;</span>

  <span class="kwrd">&lt;</span><span class="html">Model</span> <span class="attr">name</span><span class="kwrd">="Order"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="OrderID"</span> <span class="attr">type</span><span class="kwrd">="int"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="OrderDate"</span> <span class="attr">type</span><span class="kwrd">="DateTime"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="CustomerID"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="Items"</span> <span class="attr">type</span><span class="kwrd">="Collection"</span> <span class="attr">collectionType</span><span class="kwrd">="OrderItem"</span><span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">Model</span><span class="kwrd">&gt;</span>

  <span class="kwrd">&lt;</span><span class="html">Model</span> <span class="attr">name</span><span class="kwrd">="OrderItem"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="OrderID"</span> <span class="attr">type</span><span class="kwrd">="int"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="ProductName"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="UnitPrice"</span> <span class="attr">type</span><span class="kwrd">="decimal"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">name</span><span class="kwrd">="Quantity"</span> <span class="attr">type</span><span class="kwrd">="int"</span><span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">Model</span><span class="kwrd">&gt;</span>
  
  
  
  <span class="rem">&lt;!--</span>
<span class="rem">    架构定义，这是为了提供智能提示（通常你不需要做任何修改）</span>
<span class="rem">  --&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">xs:schema</span> 
    <span class="attr">xmlns:xs</span><span class="kwrd">="http://www.w3.org/2001/XMLSchema"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">xs:element</span> <span class="attr">name</span><span class="kwrd">="ModelsDef"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">xs:complexType</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:sequence</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">xs:element</span> <span class="attr">name</span><span class="kwrd">="Model"</span> <span class="attr">minOccurs</span><span class="kwrd">="1"</span> <span class="attr">maxOccurs</span><span class="kwrd">="unbounded"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">xs:complexType</span><span class="kwrd">&gt;</span>
              <span class="kwrd">&lt;</span><span class="html">xs:sequence</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">xs:element</span> <span class="attr">name</span><span class="kwrd">="Property"</span> <span class="attr">minOccurs</span><span class="kwrd">="1"</span> <span class="attr">maxOccurs</span><span class="kwrd">="unbounded"</span><span class="kwrd">&gt;</span>
                  <span class="kwrd">&lt;</span><span class="html">xs:complexType</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">xs:attribute</span> <span class="attr">name</span><span class="kwrd">="name"</span> <span class="attr">type</span><span class="kwrd">="xs:string"</span> <span class="attr">use</span><span class="kwrd">="required"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">xs:attribute</span> <span class="attr">name</span><span class="kwrd">="type"</span> <span class="attr">type</span><span class="kwrd">="systemTypes"</span> <span class="attr">default</span><span class="kwrd">="string"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">xs:attribute</span> <span class="attr">name</span><span class="kwrd">="collectionType"</span> <span class="attr">type</span><span class="kwrd">="xs:string"</span> <span class="attr">use</span><span class="kwrd">="optional"</span> <span class="kwrd">/&gt;</span>
                  <span class="kwrd">&lt;/</span><span class="html">xs:complexType</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">xs:element</span><span class="kwrd">&gt;</span>
              <span class="kwrd">&lt;/</span><span class="html">xs:sequence</span><span class="kwrd">&gt;</span>
              <span class="kwrd">&lt;</span><span class="html">xs:attribute</span> <span class="attr">name</span><span class="kwrd">="name"</span> <span class="attr">type</span><span class="kwrd">="xs:string"</span> <span class="attr">use</span><span class="kwrd">="required"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">xs:complexType</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">xs:element</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">xs:sequence</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:attribute</span> <span class="attr">name</span><span class="kwrd">="baseClass"</span> <span class="attr">type</span><span class="kwrd">="xs:string"</span> <span class="attr">default</span><span class="kwrd">="ModelBase"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">xs:complexType</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">xs:element</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">xs:simpleType</span> <span class="attr">name</span><span class="kwrd">="systemTypes"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">xs:restriction</span> <span class="attr">base</span><span class="kwrd">="xs:string"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:enumeration</span> <span class="attr">value</span><span class="kwrd">="string"</span><span class="kwrd">&gt;&lt;/</span><span class="html">xs:enumeration</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:enumeration</span> <span class="attr">value</span><span class="kwrd">="int"</span><span class="kwrd">&gt;&lt;/</span><span class="html">xs:enumeration</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:enumeration</span> <span class="attr">value</span><span class="kwrd">="decimal"</span><span class="kwrd">&gt;&lt;/</span><span class="html">xs:enumeration</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:enumeration</span> <span class="attr">value</span><span class="kwrd">="double"</span><span class="kwrd">&gt;&lt;/</span><span class="html">xs:enumeration</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:enumeration</span> <span class="attr">value</span><span class="kwrd">="DateTime"</span><span class="kwrd">&gt;&lt;/</span><span class="html">xs:enumeration</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">xs:enumeration</span> <span class="attr">value</span><span class="kwrd">="Collection"</span><span class="kwrd">&gt;&lt;/</span><span class="html">xs:enumeration</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">xs:restriction</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">xs:simpleType</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">xs:schema</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">ModelsDef</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>定义好了一个XSD Schema（这是为了便于使用，在Visual Studio中可以提供智能提示），并且提供了几个Model的范例。</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913502736.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913508624.png" width="704" height="530"></a></p>
<p>&nbsp;</p>
<h1>第二步，定义一个t4模板</h1>
<p>&nbsp;</p><pre class="csharpcode">&lt;#@ template debug=<span class="str">"false"</span> hostspecific=<span class="str">"true"</span> language=<span class="str">"C#"</span> #&gt;
&lt;#@ output extension=<span class="str">".cs"</span> #&gt;
&lt;#@ assembly name=<span class="str">"System.Core.dll"</span> #&gt;
&lt;#@ assembly name=<span class="str">"System.Xml"</span> #&gt;
&lt;#@ assembly name=<span class="str">"System.Xml.Linq"</span> #&gt;
&lt;#@ assembly name=<span class="str">"EnvDTE"</span> #&gt;
&lt;#@ import <span class="kwrd">namespace</span>=<span class="str">"EnvDTE"</span> #&gt;
&lt;#@ import <span class="kwrd">namespace</span>=<span class="str">"System"</span> #&gt;
&lt;#@ import <span class="kwrd">namespace</span>=<span class="str">"System.Linq"</span> #&gt;
&lt;#@ import <span class="kwrd">namespace</span>=<span class="str">"System.Xml.Linq"</span> #&gt;
&lt;# 
    <span class="rem">/*</span>
<span class="rem">        MVVM业务实体代码生成模板</span>
<span class="rem">        作者：陈希章</span>
<span class="rem">        时间：2011年6月</span>
<span class="rem">        说明：这个模板会读取一个XML文件，并且根据该文件定义生成业务实体代码。该文件有规定的架构。请参考ModelsDef.xml</span>
<span class="rem">        反馈：ares@xizhang.com</span>
<span class="rem">        </span>
<span class="rem">    */</span>

<span class="kwrd">string</span> defaultNamespace =<span class="kwrd">string</span>.Empty;<span class="rem">//这里可以替换为你需要的命名空间，如果不指定，则自动获取当前项目的命名空间下面，再加一个Models的子空间</span>
<span class="kwrd">string</span> definitionFile =<span class="str">"ModelsDef.xml"</span>;<span class="rem">//这是默认的定义文件，可以替换掉</span>

IServiceProvider serviceProvider = (IServiceProvider)<span class="kwrd">this</span>.Host;
DTE dte = serviceProvider.GetService(<span class="kwrd">typeof</span>(DTE)) <span class="kwrd">as</span> DTE;  

<span class="kwrd">try</span>{
    definitionFile = Host.ResolvePath(definitionFile);
    Project p = ((Array)dte.ActiveSolutionProjects).GetValue(0) <span class="kwrd">as</span> Project;
    <span class="kwrd">if</span>(<span class="kwrd">string</span>.IsNullOrEmpty(defaultNamespace)) 
        defaultNamespace=p.Properties.Item(<span class="str">"RootNamespace"</span>).Value.ToString()+<span class="str">".Models"</span>;
    
    
    var doc = XDocument.Load(Host.ResolvePath(definitionFile));
    <span class="kwrd">string</span> baseClass= <span class="kwrd">this</span>.GetAttributeValue(doc.Root,<span class="str">"baseClass"</span>,<span class="str">"ModelBase"</span>);
#&gt;

<span class="kwrd">namespace</span> &lt;#= defaultNamespace #&gt;{
    <span class="kwrd">using</span> System;
    <span class="kwrd">using</span> System.ComponentModel;
    <span class="kwrd">using</span> System.Collections.ObjectModel;
    <span class="kwrd">public</span> <span class="kwrd">abstract</span> <span class="kwrd">class</span> &lt;#= baseClass #&gt; : MarshalByRefObject, INotifyPropertyChanged
    {

        <span class="kwrd">public</span> <span class="kwrd">event</span> PropertyChangedEventHandler PropertyChanged;

        <span class="kwrd">protected</span> <span class="kwrd">virtual</span> <span class="kwrd">void</span> OnPropertyChanged(<span class="kwrd">string</span> name)
        {
            <span class="kwrd">if</span> (PropertyChanged != <span class="kwrd">null</span>)
                PropertyChanged(<span class="kwrd">this</span>, <span class="kwrd">new</span> PropertyChangedEventArgs(name));
        }

    }
&lt;#
<span class="kwrd">foreach</span> (var item <span class="kwrd">in</span> doc.Root.Elements(<span class="str">"Model"</span>))
{
    <span class="kwrd">string</span> modelName =<span class="kwrd">this</span>.GetAttributeValue(item,<span class="str">"name"</span>,<span class="kwrd">string</span>.Empty);
    <span class="kwrd">if</span>(<span class="kwrd">string</span>.IsNullOrEmpty(modelName))<span class="kwrd">continue</span>;#&gt;
            
    <span class="kwrd">public</span> <span class="kwrd">class</span> &lt;#= modelName #&gt; : &lt;#= baseClass #&gt;
    {&lt;#
    
        <span class="kwrd">foreach</span> (var property <span class="kwrd">in</span> item.Elements(<span class="str">"Property"</span>))
        {
            <span class="kwrd">string</span> propName =<span class="kwrd">this</span>.GetAttributeValue(property,<span class="str">"name"</span>,<span class="kwrd">string</span>.Empty);
            <span class="kwrd">string</span> type =<span class="kwrd">this</span>.GetPropertyTypeString(property);
            <span class="kwrd">string</span> fieldName = <span class="kwrd">string</span>.Format(<span class="str">"_{0}"</span>,propName.First().ToString().ToLower()+propName.Substring(1));
            <span class="kwrd">if</span>(<span class="kwrd">string</span>.IsNullOrEmpty(propName))<span class="kwrd">continue</span>;#&gt;

        <span class="kwrd">private</span> &lt;#= type #&gt; &lt;#= fieldName #&gt;;
        <span class="kwrd">public</span> &lt;#= type #&gt; &lt;#= propName #&gt;
        {
            get{<span class="kwrd">return</span> &lt;#= fieldName #&gt;;}
            set{
                <span class="kwrd">if</span>(&lt;#= fieldName #&gt;!=<span class="kwrd">value</span>){
                    &lt;#= fieldName #&gt;=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"&lt;#= propName #&gt;"</span>);
                }
            }
        }
        &lt;#}#&gt;
        
    }
    
&lt;#

}
#&gt;}&lt;#

}
<span class="kwrd">catch</span>(Exception ex){
    Write(ex.Message);
    Error(ex.Message);
}
#&gt;


&lt;#+ 
    <span class="kwrd">public</span> <span class="kwrd">string</span> GetAttributeValue(XElement element,<span class="kwrd">string</span> attr,<span class="kwrd">string</span> defaultValue){
        <span class="kwrd">return</span> element.Attribute(attr)!=<span class="kwrd">null</span>?element.Attribute(attr).Value:defaultValue;
    }
    
    <span class="kwrd">public</span> <span class="kwrd">string</span> GetPropertyTypeString(XElement element){
        var type = <span class="kwrd">this</span>.GetAttributeValue(element,<span class="str">"type"</span>,<span class="str">"string"</span>);
        var collectionType = <span class="kwrd">this</span>.GetAttributeValue(element,<span class="str">"collectionType"</span>,<span class="kwrd">string</span>.Empty);
        
        <span class="kwrd">if</span>(type==<span class="str">"Collection"</span>){
            <span class="kwrd">return</span> <span class="kwrd">string</span>.Format(<span class="str">"ObservableCollection&lt;{0}&gt;"</span>,collectionType);
        }
        <span class="kwrd">else</span>
            <span class="kwrd">return</span> type;
    }
#&gt;
</pre>
<p>这个模板的原理是，读取模板文件同一个目录下面的ModelsDef.xml文件，并且生成全部的代码。下面是一个例子</p><pre class="csharpcode">
<span class="kwrd">namespace</span> ConsoleApplication1.Models{
    <span class="kwrd">using</span> System;
    <span class="kwrd">using</span> System.ComponentModel;
    <span class="kwrd">using</span> System.Collections.ObjectModel;
    <span class="kwrd">public</span> <span class="kwrd">abstract</span> <span class="kwrd">class</span> ModelBase : MarshalByRefObject, INotifyPropertyChanged
    {

        <span class="kwrd">public</span> <span class="kwrd">event</span> PropertyChangedEventHandler PropertyChanged;

        <span class="kwrd">protected</span> <span class="kwrd">virtual</span> <span class="kwrd">void</span> OnPropertyChanged(<span class="kwrd">string</span> name)
        {
            <span class="kwrd">if</span> (PropertyChanged != <span class="kwrd">null</span>)
                PropertyChanged(<span class="kwrd">this</span>, <span class="kwrd">new</span> PropertyChangedEventArgs(name));
        }

    }
            
    <span class="kwrd">public</span> <span class="kwrd">class</span> Customer : ModelBase
    {
        <span class="kwrd">private</span> <span class="kwrd">string</span> _customerID;
        <span class="kwrd">public</span> <span class="kwrd">string</span> CustomerID
        {
            get{<span class="kwrd">return</span> _customerID;}
            set{
                <span class="kwrd">if</span>(_customerID!=<span class="kwrd">value</span>){
                    _customerID=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"CustomerID"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _companyName;
        <span class="kwrd">public</span> <span class="kwrd">string</span> CompanyName
        {
            get{<span class="kwrd">return</span> _companyName;}
            set{
                <span class="kwrd">if</span>(_companyName!=<span class="kwrd">value</span>){
                    _companyName=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"CompanyName"</span>);
                }
            }
        }
                
    }
    
            
    <span class="kwrd">public</span> <span class="kwrd">class</span> Order : ModelBase
    {
        <span class="kwrd">private</span> <span class="kwrd">int</span> _orderID;
        <span class="kwrd">public</span> <span class="kwrd">int</span> OrderID
        {
            get{<span class="kwrd">return</span> _orderID;}
            set{
                <span class="kwrd">if</span>(_orderID!=<span class="kwrd">value</span>){
                    _orderID=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"OrderID"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> DateTime _orderDate;
        <span class="kwrd">public</span> DateTime OrderDate
        {
            get{<span class="kwrd">return</span> _orderDate;}
            set{
                <span class="kwrd">if</span>(_orderDate!=<span class="kwrd">value</span>){
                    _orderDate=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"OrderDate"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _customerID;
        <span class="kwrd">public</span> <span class="kwrd">string</span> CustomerID
        {
            get{<span class="kwrd">return</span> _customerID;}
            set{
                <span class="kwrd">if</span>(_customerID!=<span class="kwrd">value</span>){
                    _customerID=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"CustomerID"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> ObservableCollection&lt;OrderItem&gt; _items;
        <span class="kwrd">public</span> ObservableCollection&lt;OrderItem&gt; Items
        {
            get{<span class="kwrd">return</span> _items;}
            set{
                <span class="kwrd">if</span>(_items!=<span class="kwrd">value</span>){
                    _items=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"Items"</span>);
                }
            }
        }
                
    }
    
            
    <span class="kwrd">public</span> <span class="kwrd">class</span> OrderItem : ModelBase
    {
        <span class="kwrd">private</span> <span class="kwrd">int</span> _orderID;
        <span class="kwrd">public</span> <span class="kwrd">int</span> OrderID
        {
            get{<span class="kwrd">return</span> _orderID;}
            set{
                <span class="kwrd">if</span>(_orderID!=<span class="kwrd">value</span>){
                    _orderID=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"OrderID"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> <span class="kwrd">string</span> _productName;
        <span class="kwrd">public</span> <span class="kwrd">string</span> ProductName
        {
            get{<span class="kwrd">return</span> _productName;}
            set{
                <span class="kwrd">if</span>(_productName!=<span class="kwrd">value</span>){
                    _productName=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"ProductName"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> <span class="kwrd">decimal</span> _unitPrice;
        <span class="kwrd">public</span> <span class="kwrd">decimal</span> UnitPrice
        {
            get{<span class="kwrd">return</span> _unitPrice;}
            set{
                <span class="kwrd">if</span>(_unitPrice!=<span class="kwrd">value</span>){
                    _unitPrice=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"UnitPrice"</span>);
                }
            }
        }
        
        <span class="kwrd">private</span> <span class="kwrd">int</span> _quantity;
        <span class="kwrd">public</span> <span class="kwrd">int</span> Quantity
        {
            get{<span class="kwrd">return</span> _quantity;}
            set{
                <span class="kwrd">if</span>(_quantity!=<span class="kwrd">value</span>){
                    _quantity=<span class="kwrd">value</span>;
                    OnPropertyChanged(<span class="str">"Quantity"</span>);
                }
            }
        }
                
    }
    
}

</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>看起来还不错，不是吗？那么，你将如何获得这个模板，以及在你的项目中使用呢？</p>
<p>其实很简单，你可以在Nuget gallary中找到我发布的这个Package。</p>
<p>如果你对Nuget不了解，请参考 <a href="http://www.nuget.org/">http://www.nuget.org/</a></p>
<p>&nbsp;</p>
<p>在项目中，”Manage NuGet Packages…”</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913507229.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913505833.png" width="704" height="530"></a></p>
<p>用“MVVM_ModelEntity”作为关键字进行搜索</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913512802.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913519770.png" width="801" height="315"></a></p>
<p>点击“Install”，这个工具会在你的项目中创建一个Models目录，并且添加两个文件</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913516738.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913513707.png" width="919" height="729"></a></p>
<p>选择“ModelTemplate.tt”，然后”Run Custom Tool”</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913515899.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913511232.png" width="704" height="530"></a></p>
<p>然后，你可以去查看ModelTemplate.cs文件</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913519836.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106251913521265.png" width="917" height="379"></a></p>
<p>&nbsp;</p>
<p>有兴趣的朋友，赶紧试试看吧</p>