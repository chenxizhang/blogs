# WCF技术的不同应用场景及其实现分析 
> 原文发表于 2011-06-21, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/21/2085979.html 


<p>这一篇文章，是总结一下WCF技术，以及基于这个技术发展出来的几个典型应用场景，并且我将尝试对这些不同的WCF实现的原理进行一些比较分析。</p> <p>关于WCF这个技术的基本概念，如果你不是很清楚，可以参考一下有关的文档</p> <p>微软开发者中心</p> <p><a href="http://msdn.microsoft.com/en-us/netframework/aa663324">http://msdn.microsoft.com/en-us/netframework/aa663324</a></p> <p>&nbsp;</p> <p>我的博客中先前也有很多这方面的介绍</p> <p><a href="http://zzk.cnblogs.com/s?w=blog%3achenxizhang+wcf&amp;p=1">http://zzk.cnblogs.com/s?w=blog%3achenxizhang+wcf&amp;p=1</a></p> <p>&nbsp;</p> <p>言归正传，我将先概括一下WCF技术的背景、核心要素、目前的典型应用场景。然后针对这些应用场景进一步地展开一些分析和比较，以便帮助大家更好地理解，并且知道在何时应该选用哪一种场景。（即便你没有时间去看那么多资料，通过本文也将有一个提纲挈领的认识）</p> <p>&nbsp;</p> <h2>历史背景：</h2> <p>WCF，全称是Windows Communication Founcation，它作为微软新一代的通讯技术，首先正式出现在.NET Framework 3.0中，伴随着Windows Vista的发布而名噪一时。在此之前，曾经作为Winfx的一部分为人所知，其代号为indigo。</p> <p>作为Foundation（基础模块），WCF是定位在微软.NET平台上实现统一的消息服务通讯机制。它很好地吸收了之前的多种分布式开发技术的优点，并且提供了统一的编程和访问的模型，逐渐成为SOA解决方案中的主流技术，受到了广泛的关注和使用。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353035673.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353031594.png" width="915" height="693"></a><br></p> <h2>核心要素：</h2> <p>从技术层面理解WCF，可以分为三个要素（俗称WCF的ABC)</p> <blockquote> <p>1.<strong><font color="#ff0000">A</font></strong>ddress（where)：地址，是指访问服务的URI（可以是一个http地址，也可以是tcp的地址）</p> <p>2.<font color="#ff0000"><strong>B</strong></font>inding（how）：绑定，是指通讯所使用的协议，例如http,net.tcp,msmq等等</p> <p>3.<strong><font color="#ff0000">C</font></strong>ontract（what）：合约，是指通讯的规范，例如服务的合约，数据的合约等等。</p></blockquote> <p>&nbsp;</p> <p>从系统层面理解WCF,可以分为四个要素</p> <blockquote> <p>1.Contract：合约，定义一套合约，通常是WCF开发的起点。这也是唯一需要在宿主和客户端之间共享的信息，通常是一些接口(interface)定义。</p> <p>2.Service：服务，基于合约实现的一个具体服务。通常是一些类型（class)定义，实现了业务逻辑。</p> <p>3.Host：宿主，既然服务是一个class，它自身是无法对客户端请求进行响应的。所以需要有一个宿主程序来提供持续的监听。WCF的宿主可以是任意的应用程序，非常灵活。</p> <p>4.Client：客户端，任何客户端（例如Windows Forms，WPF, Silverlight，Console Application，甚至Javascript，或者java，php等等）都可以通过自己的方式来访问WCF.</p></blockquote> <p>&nbsp;</p> <h2>应用场景：</h2> <p>WCF 从发布到现在的将近5年左右的时间，经过了多次增强和改进，从最开始单纯的SOAP Service的方式，发展出来其他多种应用场景，分别是</p> <blockquote> <p>1. SOAP Services</p> <p>2. WebHttp Services</p> <p>3. Data Services</p> <p>4. Workflow Services</p> <p>5. RIA Services</p></blockquote> <p>&nbsp;</p> <p>下面我将针对这些应用场景一一进行讲解</p> <p>【注意】我经常使用WCF技术以及一些讲座中，都会感慨WCF配置的强大。宿主和客户端都可以通过配置文件的方式定义、更改WCF服务的行为。可以这么说，在WCF中，几乎什么都可以配置。这确实很酷。所以下面的讲解，很多都是用配置文件的方式来说明问题。</p> <p>&nbsp;</p> <h2>1. SOAP Services</h2> <p>这种场景是WCF一开始就支持的，也是最完整的一个。</p> <p>为什么称为SOAP Services呢？这是因为WCF服务是基于消息的通讯机制，而它的消息是被封装为一个SOAP Envelope（SOAP 信封的）</p> <p>【备注】SOAP的全称是Simple Object Access Protocol，我们一般翻译为简单对象访问协议。</p> <p>一个典型的SOAP Request（代表了客户端发到服务器的请求）</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353031071.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353036087.png" width="805" height="320"></a></p> <p>一个典型的SOAP Response</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353049152.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353042217.png" width="925" height="688"></a></p> <p>这种服务是以操作(Operation)为中心的，也就是说，我们可以完全控制服务的所有细节，包括定义合约，实现服务，实现宿主等等。这里面有两层意思，我们将有足够的灵活性，因为所有一切都是可以控制的；同时，我们也需要具备足够的专业知识，因为所有一切都需要你自己控制。</p> <p>我们来看一个典型的WCF SOAP Service的配置文件</p><pre class="csharpcode">  <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">services</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">service</span> <span class="attr">name</span><span class="kwrd">="WcfService2.Service1"</span> <span class="attr">behaviorConfiguration</span><span class="kwrd">="WcfService2.Service1Behavior"</span><span class="kwrd">&gt;</span>
        <span class="rem">&lt;!-- Service Endpoints --&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">endpoint</span> <span class="attr">address</span><span class="kwrd">=""</span> <span class="attr">binding</span><span class="kwrd">="wsHttpBinding"</span> <span class="attr">contract</span><span class="kwrd">="WcfService2.IService1"</span><span class="kwrd">&gt;</span>
          <span class="rem">&lt;!-- </span>
<span class="rem">              Upon deployment, the following identity element should be removed or replaced to reflect the </span>
<span class="rem">              identity under which the deployed service runs.  If removed, WCF will infer an appropriate identity </span>
<span class="rem">              automatically.</span>
<span class="rem">          --&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">identity</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">dns</span> <span class="attr">value</span><span class="kwrd">="localhost"</span><span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">identity</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">endpoint</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">endpoint</span> <span class="attr">address</span><span class="kwrd">="mex"</span> <span class="attr">binding</span><span class="kwrd">="mexHttpBinding"</span> <span class="attr">contract</span><span class="kwrd">="IMetadataExchange"</span><span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">service</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">services</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behavior</span> <span class="attr">name</span><span class="kwrd">="WcfService2.Service1Behavior"</span><span class="kwrd">&gt;</span>
          <span class="rem">&lt;!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment --&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceMetadata</span> <span class="attr">httpGetEnabled</span><span class="kwrd">="true"</span><span class="kwrd">/&gt;</span>
          <span class="rem">&lt;!-- To receive exception details in faults for debugging purposes, set the value below to true.  Set to false before deployment to avoid disclosing exception information --&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceDebug</span> <span class="attr">includeExceptionDetailInFaults</span><span class="kwrd">="false"</span><span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>SOAP Services是从.NET Framework 3.0一开始就提供的，在后续版本中，也有很多改进，包括对WS-*标准更好的支持，以及提供了很多默认的配置选项，简化了配置的工作。</p>
<p>【备注】值得一提的是，微软研发集团上海办公室这边有一个团队，直接参与了WCF的新版本的很多功能和工具的设计和开发，包括对于配置的简化设计。感谢他们的工作。</p>
<p>&nbsp;</p>
<p>我们来看一个.NET Framework 4.0下面的WCF服务默认的配置文件</p><pre class="csharpcode">  <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
          <span class="rem">&lt;!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment --&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceMetadata</span> <span class="attr">httpGetEnabled</span><span class="kwrd">="true"</span><span class="kwrd">/&gt;</span>
          <span class="rem">&lt;!-- To receive exception details in faults for debugging purposes, set the value below to true.  Set to false before deployment to avoid disclosing exception information --&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceDebug</span> <span class="attr">includeExceptionDetailInFaults</span><span class="kwrd">="false"</span><span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">serviceHostingEnvironment</span> <span class="attr">multipleSiteBindingsEnabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span></pre>
<p>通过简单地比较就可以知道，在.NET Framework 4.0中，我们并没有看到端点（EndPoint）的定义，这是怎么回事呢？难道现在不需要定义端点了吗？当然不是，区别在于，.NET Framework4的ServiceHost将自动地注册几个默认的EndPoint。</p>
<p>【备注】如果不是为了在开发阶段调试需要而开启元数据和调试支持，上面的配置文件，甚至可以是空的，什么都不需要定义。</p>
<p>&nbsp;</p>
<p>关于ServiceHost以及默认的端点的信息，有兴趣可以参考</p>
<p><a href="http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehost.aspx">http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehost.aspx</a></p>
<p>&nbsp;</p>
<p><font color="#ff0000"><strong>总结</strong></font>：采用这种方式进行开发的WCF，可以根据我们的需求，使用任意的Binding，以支持不同的客户端，并且提供在不同的场合下最好的速度，还可以实现诸如缓存，队列，事务协调等高级功能。</p>
<p>&nbsp;</p>
<h2>2. WebHttp Services</h2>
<p>这种服务的出现，是基于一个比较热的概念：RESTFul。可以这么说，这是WCF Restful的一个具体实现。从.NET Framework 3.5开始提供。</p>
<p>所谓RESTFul的概念，有兴趣可以参考 <a href="http://zh.wikipedia.org/wiki/REST">http://zh.wikipedia.org/wiki/REST</a> 以及我之前写过的一些博客文章：<a href="http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20rest">http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20rest</a></p>
<p>&nbsp;</p>
<p>大致的意思是：</p>
<blockquote>
<p><b>表象化状态转变</b>（英文：<b>Representational State Transfer</b>，简称<b>REST</b>）是<a href="http://zh.wikipedia.org/w/index.php?title=Roy_Fielding&amp;action=edit&amp;redlink=1">Roy Fielding</a>博士在2000年他的博士论文中提出来的一种<a href="http://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84">软件架构</a>风格。
<p>目前在三种主流的<a href="http://zh.wikipedia.org/wiki/Web%E6%9C%8D%E5%8A%A1">Web服务</a>实现方案中，因为REST模式的<a href="http://zh.wikipedia.org/wiki/Web%E6%9C%8D%E5%8A%A1">Web服务</a>与复杂的<a href="http://zh.wikipedia.org/wiki/SOAP">SOAP</a>和<a href="http://zh.wikipedia.org/wiki/XML-RPC">XML-RPC</a>对比来讲明显的更加简洁，越来越多的web服务开始采用REST风格设计和实现。例如，<a href="http://zh.wikipedia.org/wiki/Amazon.com">Amazon.com</a>提供接近REST风格的Web服务进行图书查找；<a href="http://zh.wikipedia.org/wiki/%E9%9B%85%E8%99%8E">雅虎</a>提供的Web服务也是REST风格的。</p></blockquote>
<blockquote>
<p>REST 从资源的角度来观察整个网络，分布在各处的资源由<a href="http://zh.wikipedia.org/wiki/URI">URI</a>确定，而客户端的应用通过URI来获取资源的表形。获得这些表形致使这些应用程序转变了其状态。随着不断获取资源的表形，客户端应用不断地在转变着其状态，所谓表形化的状态转变（Representational State Transfer）。</p></blockquote>
<p>今天不是专门来探讨REST的，我们主要看看WCF是如何实现对REST支持，以及如何使用这种风格的服务。
<p>实现WCF Restful，关键在于一个新的Binding方式，也就是WebHttpBinding。所以这种服务，我这里将其称为WebHttp Services。
<p>WebHttp Services是在传统的SOAP Services基础上的一个增强，它仍然是基于操作（Operation）的，只不过这些Operation可以直接通过Uri访问到，而无需客户去编写一个特殊的客户端。
<p>同时，WebHttp Services提供了两种不同的消息格式，第一种是XML，第二种是Json。这将更加有利于诸如Javascript这种客户端来访问服务。
<p>要实现WebHttp，我们首先要添加一个引用，如下
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353042250.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353042283.png" width="743" height="467"></a>
<p>&nbsp; <p>然后 ，我们可以定义一个特殊的Operation<pre class="csharpcode">
        [OperationContract]
        [WebGet]
        <span class="kwrd">string</span> HelloWorld();
</pre>
<p>【注意】这里通过WebGet这个Attribute，声明该操作是可以直接在Http访问中访问的</p>
<p>下面是该操作的实现</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.ServiceModel.Activation;

<span class="kwrd">namespace</span> WcfService1
{
    <span class="rem">// NOTE: You can use the "Rename" command on the "Refactor" menu to change the class name "Service1" in code, svc and config file together.</span>
  <strong><font color="#ff0000">  [AspNetCompatibilityRequirements(RequirementsMode= AspNetCompatibilityRequirementsMode.Required)]</font></strong>
    <span class="kwrd">public</span> <span class="kwrd">class</span> Service1 : IService1
    {
        <span class="kwrd">public</span> <span class="kwrd">string</span> GetData(<span class="kwrd">int</span> <span class="kwrd">value</span>)
        {
            <span class="kwrd">return</span> <span class="kwrd">string</span>.Format(<span class="str">"You entered: {0}"</span>, <span class="kwrd">value</span>);
        }

        <span class="kwrd">public</span> CompositeType GetDataUsingDataContract(CompositeType composite)
        {
            <span class="kwrd">if</span> (composite == <span class="kwrd">null</span>)
            {
                <span class="kwrd">throw</span> <span class="kwrd">new</span> ArgumentNullException(<span class="str">"composite"</span>);
            }
            <span class="kwrd">if</span> (composite.BoolValue)
            {
                composite.StringValue += <span class="str">"Suffix"</span>;
            }
            <span class="kwrd">return</span> composite;
        }


    <strong><font color="#ff0000">    <span class="kwrd">public</span> <span class="kwrd">string</span> HelloWorld()
        {
            <span class="kwrd">return</span> <span class="str">"Hello,world"</span>;
        }</font></strong>
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>【备注】该服务必须声明为AspNetCompatibility</p>
<p>&nbsp;</p>
<p>为了使用该服务支持WebHttpBinding,我们需要修改配置文件如下（粗体部分是我们这次添加的）</p><pre class="csharpcode"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span>?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

  <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">compilation</span> <span class="attr">debug</span><span class="kwrd">="true"</span> <span class="attr">targetFramework</span><span class="kwrd">="4.0"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
   <strong><font color="#ff0000"> <span class="kwrd">&lt;</span><span class="html">services</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">service</span> <span class="attr">name</span><span class="kwrd">="WcfService1.Service1"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">endpoint</span> <span class="attr">address</span><span class="kwrd">=""</span> <span class="attr">behaviorConfiguration</span><span class="kwrd">="WcfService1.Service1AspNetAjaxBehavior"</span>
          <span class="attr">binding</span><span class="kwrd">="webHttpBinding"</span> <span class="attr">contract</span><span class="kwrd">="WcfService1.IService1"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">service</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">services</span><span class="kwrd">&gt;</span></font></strong>
    <span class="kwrd">&lt;</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
     <strong> <span class="kwrd">&lt;</span><span class="html">endpointBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behavior</span> <span class="attr">name</span><span class="kwrd">="WcfService1.Service1AspNetAjaxBehavior"</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">enableWebScript</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">endpointBehaviors</span><span class="kwrd">&gt;</span></strong>
      <span class="kwrd">&lt;</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behavior</span> <span class="attr">name</span><span class="kwrd">=""</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceMetadata</span> <span class="attr">httpGetEnabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceDebug</span> <span class="attr">includeExceptionDetailInFaults</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">serviceHostingEnvironment</span> <span class="attr">aspNetCompatibilityEnabled</span><span class="kwrd">="true"</span>
      <span class="attr">multipleSiteBindingsEnabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
 <span class="kwrd">&lt;</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">modules</span> <span class="attr">runAllManagedModulesForAllRequests</span><span class="kwrd">="true"</span><span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
  
<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>如果是这样的定义，那么在浏览器中我们就可以直接访问该服务及其操作</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353058728.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353054301.png" width="1028" height="701"></a></p>
<p>既然是RESTful，那么就可以直接在地址栏像下面这样访问</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353059317.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353058478.png" width="1028" height="701"></a></p>
<p>我们发现它的返回值是application/json格式的</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353067398.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353067955.png" width="852" height="314"></a></p>
<p>具体返回的是什么内容呢？</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353067431.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621135306496.png" width="799" height="294"></a></p>
<p>&nbsp;</p>
<p>也就是说,WebHttp Service默认是返回json格式的数据的，这就很容易在JAVASCRIPT中使用该服务。例如</p><pre class="csharpcode"><span class="asp">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="default.aspx.cs" Inherits="WcfService1._default" %&gt;</span>

<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">html</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="kwrd">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="jquery-1.4.3.min.js"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    &lt;script type=<span class="str">"text/javascript"</span> language=<span class="str">"javascript"</span>&gt;
        $(<span class="kwrd">function</span> () {
            $(<span class="str">"#btHelloworld"</span>).click(<span class="kwrd">function</span> () {
                <span class="kwrd">var</span> uri = <span class="str">"Service1.svc/HelloWorld"</span>;
                $.getJSON(uri, <span class="kwrd">null</span>, <span class="kwrd">function</span> (result) {
                    alert(result.d);
                });
            });

        });
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">input</span> <span class="attr">type</span><span class="kwrd">="button"</span> <span class="attr">id</span><span class="kwrd">="btHelloworld"</span>  <span class="attr">value</span><span class="kwrd">="call webhttp Service"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span>
</pre>
<p>在页面中测试的效果如下
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353067464.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353064433.png" width="699" height="358"></a></p>
<p>&nbsp;</p>
<p>值得注意的是，WebHttp Service除了支持Json格式之外，也支持XML格式，我们可以通过修改WebGet这个Attribute的设置来达到目的</p><pre class="csharpcode">
        [OperationContract]
        [WebGet(ResponseFormat=WebMessageFormat.Xml)]
        <span class="kwrd">string</span> HelloWorld();</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>也可以通过配置文件的方式来设置（注意粗体部分）</p><pre class="csharpcode"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span>?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

  <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">compilation</span> <span class="attr">debug</span><span class="kwrd">="true"</span> <span class="attr">targetFramework</span><span class="kwrd">="4.0"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">services</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">service</span> <span class="attr">name</span><span class="kwrd">="WcfService1.Service1"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">endpoint</span> <span class="attr">address</span><span class="kwrd">=""</span> <span class="attr">behaviorConfiguration</span><span class="kwrd">="WcfService1.Service1AspNetAjaxBehavior"</span>
          <span class="attr">binding</span><span class="kwrd">="webHttpBinding"</span> <span class="attr">contract</span><span class="kwrd">="WcfService1.IService1"</span> <span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">service</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">services</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">endpointBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behavior</span> <span class="attr">name</span><span class="kwrd">="WcfService1.Service1AspNetAjaxBehavior"</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">enableWebScript</span> <span class="kwrd">/&gt;</span>
          <strong><span class="kwrd">&lt;</span><span class="html">webHttp</span> <span class="attr">defaultOutgoingResponseFormat</span><span class="kwrd">="Xml"</span><span class="kwrd">/&gt;</span></strong>
        <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">endpointBehaviors</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behavior</span> <span class="attr">name</span><span class="kwrd">=""</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceMetadata</span> <span class="attr">httpGetEnabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">serviceDebug</span> <span class="attr">includeExceptionDetailInFaults</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">serviceHostingEnvironment</span> <span class="attr">aspNetCompatibilityEnabled</span><span class="kwrd">="true"</span>
      <span class="attr">multipleSiteBindingsEnabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
 <span class="kwrd">&lt;</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">modules</span> <span class="attr">runAllManagedModulesForAllRequests</span><span class="kwrd">="true"</span><span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
  
<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>如果用XML格式的话，那么在浏览器测试的效果如下</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353077530.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353087106.png" width="1028" height="701"></a></p>






<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106211353086583.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110621135308204.png" width="1028" height="701"></a></p>
<p>&nbsp;</p>
<p><strong><font color="#ff0000">总结</font></strong>：WebHttp Services是在SOAP Services基础上的一个改进，它不是返回SOAP Evenlope，而是根据需要返回XML或者JSON数据。这样的设计，目的是让服务更加易于使用。同时，该服务是WCF Restful的具体实现。</p>
<p>&nbsp;</p>
<p>【备注】 由于篇幅过长，另外三种服务，我将另外单独用一篇文章来分析比较，敬请期待</p>
<p>3. Data Services</p>
<p>4. Workflow Services</p>
<p>5. RIA Services</p>