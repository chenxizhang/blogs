# 在jquery中处理带有命名空间的XML数据 
> 原文发表于 2011-06-12, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/12/2078975.html 


<p>这一篇记录一个小技巧。</p> <p>如果你在做AJAX应用，则你可能经常会用到jquery（或者其他框架）处理服务返回的数据。如果用Jquery处理Json格式，将是相当方便的。但不幸的是，很多服务返回的数据仍然是XML格式的。</p> <p>jquery对于xml这种数据的处理是内置支持的，这一点没有任何问题。但前提是返回的数据没有带任何命名空间。例如下面这份数据</p><pre class="csharpcode">&lt;?xml version=<span class="str">"1.0"</span> encoding=<span class="str">"utf-8"</span> ?&gt;
&lt;data&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
  &lt;Employee id=<span class="str">"1"</span> firstName=<span class="str">"ares"</span> lastName=<span class="str">"chen"</span>&gt;&lt;/Employee&gt;
&lt;/data&gt;</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>要处理这样的数据，jquery代码大致如下</p><pre class="csharpcode">            <span class="kwrd">var</span> div = $(<span class="str">"#placeholder"</span>);

            

            <span class="rem">// 处理不带命名空间的xml</span>
            $.get(<span class="str">"data.xml"</span>, <span class="kwrd">null</span>, <span class="kwrd">function</span> (data) {
                <span class="kwrd">var</span> employees = $(<span class="str">"Employee"</span>, data); <span class="rem">//找到所有的Employee节点</span>

                <span class="kwrd">var</span> ul = $(<span class="str">"&lt;ul /&gt;"</span>);

                employees.each(<span class="kwrd">function</span> () {
                    $(<span class="str">"&lt;li /&gt;"</span>).text($(<span class="kwrd">this</span>).attr(<span class="str">"firstName"</span>) + <span class="str">" "</span> + $(<span class="kwrd">this</span>).attr(<span class="str">"lastName"</span>)).appendTo(ul);<span class="rem">// 将每一行数据构造一个新的li标签，并且将其插入到ul中</span>

                });

                ul.appendTo(div);
            });
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>但如果我们的XML数据带有命名空间，则上述代码就会无效。原因是因为jquery默认处理不了命名空间</p><pre class="csharpcode"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">data</span> <span class="attr">xmlns:d</span><span class="kwrd">="http://tech.xizhang.com"</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">d:Employee</span> <span class="attr">id</span><span class="kwrd">="1"</span> <span class="attr">firstName</span><span class="kwrd">="bill"</span> <span class="attr">lastName</span><span class="kwrd">="gates"</span><span class="kwrd">&gt;&lt;/</span><span class="html">d:Employee</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">data</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
<br>为了解决这个问题，有热心的网友，编写了一个jquery插件，叫做jquery.xmlns.js，有兴趣可以通过下面了解和下载
<p><a href="http://www.rfk.id.au/blog/entry/xmlns-selectors-jquery/">http://www.rfk.id.au/blog/entry/xmlns-selectors-jquery/</a></p>
<p>那么，我们可以用如下的方法来解决问题</p><pre class="csharpcode">     
            $.xmlns[<span class="str">"d"</span>] = <span class="str">"http://tech.xizhang.com"</span>;
            <span class="rem">// 处理带命名空间的xml</span>
            $.get(<span class="str">"datawithnamespace.xml"</span>, <span class="kwrd">null</span>, <span class="kwrd">function</span> (data) {
                <span class="kwrd">var</span> employees = $(<span class="str">"d|Employee"</span>, data); <span class="rem">//找到所有的Employee节点</span>

                <span class="kwrd">var</span> ul = $(<span class="str">"&lt;ul /&gt;"</span>);

                employees.each(<span class="kwrd">function</span> () {
                    $(<span class="str">"&lt;li /&gt;"</span>).text($(<span class="kwrd">this</span>).attr(<span class="str">"firstName"</span>) + <span class="str">" "</span> + $(<span class="kwrd">this</span>).attr(<span class="str">"lastName"</span>)).appendTo(ul);

                });

                ul.appendTo(div);

            });
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>不得不说，XML这个技术规范中的命名空间真是一个很不好的设计。增加了很多麻烦，胜过于它带来的好处。</p>
<p>&nbsp;</p>
<p>本文的例子完整代码如下</p><pre class="csharpcode"><span class="asp">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="WebForm1.aspx.cs" Inherits="WebApplication1.WebForm1" %&gt;</span>

<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">html</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="kwrd">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">src</span><span class="kwrd">="Scripts/jquery-1.4.1.min.js"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
    &lt;script src=<span class="str">"Scripts/jquery.xmlns.js"</span> type=<span class="str">"text/javascript"</span>&gt;&lt;/script&gt;
    &lt;script language=<span class="str">"javascript"</span> type=<span class="str">"text/javascript"</span>&gt;
        $(<span class="kwrd">function</span> () {

            <span class="kwrd">var</span> div = $(<span class="str">"#placeholder"</span>);

            

            <span class="rem">// 处理不带命名空间的xml</span>
            $.get(<span class="str">"data.xml"</span>, <span class="kwrd">null</span>, <span class="kwrd">function</span> (data) {
                <span class="kwrd">var</span> employees = $(<span class="str">"Employee"</span>, data); <span class="rem">//找到所有的Employee节点</span>

                <span class="kwrd">var</span> ul = $(<span class="str">"&lt;ul /&gt;"</span>);

                employees.each(<span class="kwrd">function</span> () {
                    $(<span class="str">"&lt;li /&gt;"</span>).text($(<span class="kwrd">this</span>).attr(<span class="str">"firstName"</span>) + <span class="str">" "</span> + $(<span class="kwrd">this</span>).attr(<span class="str">"lastName"</span>)).appendTo(ul);<span class="rem">// 将每一行数据构造一个新的li标签，并且将其插入到ul中</span>

                });

                ul.appendTo(div);
            });


            $(<span class="str">"&lt;br /&gt;"</span>).appendTo(div);

     
            $.xmlns[<span class="str">"d"</span>] = <span class="str">"http://tech.xizhang.com"</span>;
            <span class="rem">// 处理带命名空间的xml</span>
            $.get(<span class="str">"datawithnamespace.xml"</span>, <span class="kwrd">null</span>, <span class="kwrd">function</span> (data) {
                <span class="kwrd">var</span> employees = $(<span class="str">"d|Employee"</span>, data); <span class="rem">//找到所有的Employee节点</span>

                <span class="kwrd">var</span> ul = $(<span class="str">"&lt;ul /&gt;"</span>);

                employees.each(<span class="kwrd">function</span> () {
                    $(<span class="str">"&lt;li /&gt;"</span>).text($(<span class="kwrd">this</span>).attr(<span class="str">"firstName"</span>) + <span class="str">" "</span> + $(<span class="kwrd">this</span>).attr(<span class="str">"lastName"</span>)).appendTo(ul);

                });

                ul.appendTo(div);

            });


        });
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="placeholder"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>最后，在浏览器中看到的效果如下。有图有真相</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106121803311987.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106121803315924.png" width="589" height="519"></a></p>