# Convert XElement to XmlNode (and Convert XmlNode to XElement){转载} 
> 原文发表于 2010-03-24, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/03/24/1693383.html 


<p>本文转载自：<a title="http://blogs.msdn.com/ericwhite/archive/2008/12/22/convert-xelement-to-xmlnode-and-convert-xmlnode-to-xelement.aspx" href="http://blogs.msdn.com/ericwhite/archive/2008/12/22/convert-xelement-to-xmlnode-and-convert-xmlnode-to-xelement.aspx">http://blogs.msdn.com/ericwhite/archive/2008/12/22/convert-xelement-to-xmlnode-and-convert-xmlnode-to-xelement.aspx</a></p> <p>&nbsp;</p><pre class="csharpcode">Sometimes you want to convert an XmlNode to an XElement and back again.  Some programming libraries define methods that take XmlNode objects <span class="kwrd">as</span> parameters.  These libraries also may contain properties and methods that <span class="kwrd">return</span> XmlNode objects.  However, it <span class="kwrd">is</span> more convenient to work with LINQ to XML instead of the classes <span class="kwrd">in</span> System.Xml (XmlDocument, XmlNode, etc.)  This post presents a bit of code to <span class="kwrd">do</span> these conversions.

(Update March 5, 2009 - I've written a blog post that shows how to convert from XDocument to XmlDocument (and vice versa).  The code presented <span class="kwrd">in</span> that post <span class="kwrd">is</span> a superset of the code presented <span class="kwrd">in</span> <span class="kwrd">this</span> code.)

As an example of <span class="kwrd">where</span> you need these methods, you can <span class="kwrd">do</span> a lot with SharePoint <span class="kwrd">using</span> web services.  The proxy classes that wsdl.exe creates contain methods that use classes <span class="kwrd">in</span> System.Xml.

It <span class="kwrd">is</span> convenient to write these conversions <span class="kwrd">as</span> extension methods.  When converting to and from classes <span class="kwrd">in</span> System.Xml, the code reads much better when you tack an extension method on the end instead of surrounding the expression with a method call.  The following code shows how to call the GetListItems method of the Lists web service <span class="kwrd">using</span> the GetXmlNode and GetXElement extension methods:

XElement queryOptions = <span class="kwrd">new</span> XElement(<span class="str">"QueryOptions"</span>,
    <span class="kwrd">new</span> XElement(<span class="str">"Folder"</span>, <span class="str">"Open XML Documents"</span>),
    <span class="kwrd">new</span> XElement(<span class="str">"ViewAttributes"</span>, <span class="kwrd">new</span> XAttribute(<span class="str">"Scope"</span>, <span class="str">"Recursive"</span>))
);

XElement viewFields = <span class="kwrd">new</span> XElement(<span class="str">"ViewFields"</span>,
    <span class="kwrd">new</span> XElement(<span class="str">"FieldRef"</span>, <span class="kwrd">new</span> XAttribute(<span class="str">"Name"</span>, <span class="str">"GUID"</span>)),
    <span class="kwrd">new</span> XElement(<span class="str">"FieldRef"</span>, <span class="kwrd">new</span> XAttribute(<span class="str">"Name"</span>, <span class="str">"ContentType"</span>)),
    <span class="kwrd">new</span> XElement(<span class="str">"FieldRef"</span>, <span class="kwrd">new</span> XAttribute(<span class="str">"Name"</span>, <span class="str">"BaseName"</span>)),
    <span class="kwrd">new</span> XElement(<span class="str">"FieldRef"</span>, <span class="kwrd">new</span> XAttribute(<span class="str">"Name"</span>, <span class="str">"Modified"</span>)),
    <span class="kwrd">new</span> XElement(<span class="str">"FieldRef"</span>, <span class="kwrd">new</span> XAttribute(<span class="str">"Name"</span>, <span class="str">"EncodedAbsUrl"</span>))
);

XElement listContent = wsList
    .GetListItems(documentLibraryGUID,
                  <span class="kwrd">null</span>, <span class="kwrd">null</span>, viewFields.GetXmlNode(),
                  <span class="kwrd">null</span>, queryOptions.GetXmlNode(), webId)
    .GetXElement();



To create an XmlNode from an XElement, you create an XmlReader <span class="kwrd">using</span> the XNode.CreateReader method, create an XmlDocument, and load the document <span class="kwrd">using</span> the XmlReader.  XmlDocument inherits XmlNode.

To create an XElement from an XmlNode, you create an XDocument, create an XmlWriter <span class="kwrd">using</span> the XContainer.CreateWriter method, write the XmlNode to the XDocument, and <span class="kwrd">return</span> the root element of the XDocument.

The following example contains the extension methods and some code that shows their use:

<span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Xml;
<span class="kwrd">using</span> System.Xml.Linq;

<span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">class</span> MyExtensions
{
    <span class="kwrd">public</span> <span class="kwrd">static</span> XElement GetXElement(<span class="kwrd">this</span> XmlNode node)
    {
        XDocument xDoc = <span class="kwrd">new</span> XDocument();
        <span class="kwrd">using</span> (XmlWriter xmlWriter = xDoc.CreateWriter())
            node.WriteTo(xmlWriter);
        <span class="kwrd">return</span> xDoc.Root;
    }

    <span class="kwrd">public</span> <span class="kwrd">static</span> XmlNode GetXmlNode(<span class="kwrd">this</span> XElement element)
    {
        <span class="kwrd">using</span> (XmlReader xmlReader = element.CreateReader())
        {
            XmlDocument xmlDoc = <span class="kwrd">new</span> XmlDocument();
            xmlDoc.Load(xmlReader);
            <span class="kwrd">return</span> xmlDoc;
        }
    }
}

<span class="kwrd">class</span> Program
{
    <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
    {
        XElement e = <span class="kwrd">new</span> XElement(<span class="str">"Root"</span>,
            <span class="kwrd">new</span> XElement(<span class="str">"Child"</span>,
                <span class="kwrd">new</span> XAttribute(<span class="str">"Att"</span>, <span class="str">"1"</span>)
            )
        );

        XmlNode xmlNode = e.GetXmlNode();
        Console.WriteLine(xmlNode.OuterXml);

        XElement newElement = xmlNode.GetXElement();
        Console.WriteLine(newElement);
    }
}



Code <span class="kwrd">is</span> attached.

</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>