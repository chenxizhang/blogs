# 一个比较完整的WindowsFormsApplication实现 
> 原文发表于 2010-03-29, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/03/29/1699358.html 


<p>这是前两天课堂上的例子，提供了一个自定义WindowsFormsApplication的范例，主要包括如下的功能</p> <p>1. 单一实例</p> <p>2. 闪屏</p> <p>3. 登陆窗口</p> <p>4. 任务栏图标和菜单</p> <p>需要注意的是，WindowsFormsApplicationBase这个类是要添加Microsoft.VisualBisic.dll引用的</p> <p>&nbsp;</p><pre class="csharpcode">    <span class="kwrd">class</span> MyApplication : WindowsFormsApplicationBase
    {
        NotifyIcon taskBarIcon;
        <span class="kwrd">public</span> MyApplication(<span class="kwrd">bool</span> singleton)
            : <span class="kwrd">base</span>(AuthenticationMode.ApplicationDefined)
        {
            <span class="rem">//设置单实例</span>
            <span class="kwrd">this</span>.IsSingleInstance = <span class="kwrd">true</span>;

            
            <span class="rem">//添加任务栏按钮</span>
            taskBarIcon = <span class="kwrd">new</span> NotifyIcon();
            taskBarIcon.Icon = Properties.Resources.Northwind;
            ContextMenuStrip contextMenu = <span class="kwrd">new</span> ContextMenuStrip();
            contextMenu.Items.Add(
                <span class="kwrd">new</span> ToolStripMenuItem(
                    <span class="str">"退出"</span>,
                    Properties.Resources.close,
                    (sender, eventArgs) =&gt;
                    {
                        <span class="kwrd">if</span> (MessageBox.Show(
                            <span class="str">"你是否真的要退出?"</span>,
                            <span class="str">"确认"</span>,
                            MessageBoxButtons.YesNo,
                            MessageBoxIcon.Question,
                            MessageBoxDefaultButton.Button2)
                            == DialogResult.Yes)
                        {
                            Application.Exit();
                        }
                    }));
            contextMenu.Items.Add(
                <span class="kwrd">new</span> ToolStripMenuItem(
                    <span class="str">"帮助"</span>,
                    Properties.Resources.help,
                    (sender, eventArgs) =&gt;
                    {
                        MessageBox.Show(<span class="str">"帮助文档还在制作中"</span>);
                    }));

            taskBarIcon.ContextMenuStrip = contextMenu;
            taskBarIcon.ShowBalloonTip(2000, <span class="str">"欢迎"</span>, <span class="str">"欢迎使用该软件"</span>, ToolTipIcon.Info);
            taskBarIcon.Visible = <span class="kwrd">true</span>;
        }

        <span class="kwrd">public</span> MyApplication() : <span class="kwrd">this</span>(<span class="kwrd">true</span>) { }

        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnCreateSplashScreen()
        {
            <span class="kwrd">base</span>.OnCreateSplashScreen();

            LoginForm login = <span class="kwrd">new</span> LoginForm();
            <span class="kwrd">if</span> (login.ShowDialog() != DialogResult.OK)
            {
                Environment.Exit(-1);<span class="rem">//这里不能用Application.Exit,因为当前是一个自定义的Application</span>
            }

            <span class="kwrd">this</span>.MinimumSplashScreenDisplayTime = 2000;<span class="rem">//最少显示两秒</span>
            <span class="kwrd">this</span>.SplashScreen = <span class="kwrd">new</span> SplashForm();

        }




        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnShutdown()
        {
            <span class="kwrd">base</span>.OnShutdown();
            taskBarIcon.Dispose();

        }
        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnStartupNextInstance(StartupNextInstanceEventArgs eventArgs)
        {
            <span class="kwrd">base</span>.OnStartupNextInstance(eventArgs);
            eventArgs.BringToForeground = <span class="kwrd">true</span>;
        }



        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnCreateMainForm()
        {
            <span class="kwrd">base</span>.OnCreateMainForm();

            <span class="kwrd">this</span>.MainForm = <span class="kwrd">new</span> MainForm();
        }
    }</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>