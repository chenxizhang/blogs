# MOSS 2010服务器对象模型（Object Model） 
> 原文发表于 2010-04-05, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/04/05/1704550.html 


<p>虽然从界面上有了很大的变化，但其实MOSS 2010的服务器对象模型并没有大的变化。请看下面的图形</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010ObjectModel_92E1/image_4.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010ObjectModel_92E1/image_thumb_1.png" width="865" height="557"></a> </p> <p>当然，MOSS 2010的对象模型确实有了一些变动，这体现在它增加了客户端对象模型和所谓的一个运行时。（这个在后面再介绍）</p> <p>这一篇，我们依然来看看服务器对象模型</p> <p>这里再提一下，必须设置为目标平台为x64，否则下面的代码会出错，因为找不到SPFarm</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010ObjectModel_92E1/image_6.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010ObjectModel_92E1/image_thumb_2.png" width="1044" height="810"></a> </p> <p>其实，每次都修改我也觉得很烦，但这个选项默认设置为x86，好像改不了，请参考下面这个讨论</p> <p><a href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=455333&amp;wa=wsignin1.0">https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=455333&amp;wa=wsignin1.0</a></p> <p>&nbsp;</p> <p></p> <p></p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Text;
<span class="kwrd">using</span> Microsoft.SharePoint;
<span class="kwrd">using</span> Microsoft.SharePoint.Administration;


<span class="kwrd">namespace</span> ServerObjectModelSample
{
    <span class="kwrd">class</span> Program
    {
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// 这个程序演示了如何使用MOSS 2010服务器对象模型</span>
        <span class="rem">/// 作者：陈希章</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;param name="args"&gt;&lt;/param&gt;</span>
        <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
        {
            

            SPFarm farm = SPFarm.Local;
            Console.WriteLine(<span class="str">"当前服务器场:{0}"</span>, farm.Name);
            
            <span class="kwrd">foreach</span> (var server <span class="kwrd">in</span> farm.Servers)
            {
                Console.Write(<span class="kwrd">new</span> <span class="kwrd">string</span>(<span class="str">'\t'</span>,1));
                Console.WriteLine(<span class="str">"服务器:{0} "</span>, server.Name);
                <span class="kwrd">foreach</span> (var serviceInstance <span class="kwrd">in</span> server.ServiceInstances)
                {
                    Console.Write(<span class="kwrd">new</span> <span class="kwrd">string</span>(<span class="str">'\t'</span>, 2));

                    Console.WriteLine(<span class="str">"服务:{0}"</span>, serviceInstance.TypeName);
                    <span class="kwrd">if</span> (serviceInstance.Service.GetType() == <span class="kwrd">typeof</span>(SPWebService)) {
                        var service = (SPWebService)serviceInstance.Service;


                        <span class="kwrd">foreach</span> (var app <span class="kwrd">in</span> service.WebApplications)
                        {
                            Console.Write(<span class="kwrd">new</span> <span class="kwrd">string</span>(<span class="str">'\t'</span>, 3));
                            Console.WriteLine(<span class="str">"应用程序:{0}"</span>, app.Name);

                            <span class="kwrd">foreach</span> (SPSite site <span class="kwrd">in</span> app.Sites)
                            {
                                Console.Write(<span class="kwrd">new</span> <span class="kwrd">string</span>(<span class="str">'\t'</span>, 4));
                                Console.WriteLine(<span class="str">"网站集:{0}"</span>, site.RootWeb.Title);
                                <span class="kwrd">foreach</span> (SPWeb web <span class="kwrd">in</span> site.AllWebs)
                                {
                                    ShowWebContent(web,5);
                                }
                            }
                        }
                    }
                }
            }


        }

        <span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">void</span> ShowWebContent(SPWeb web, <span class="kwrd">int</span> level)
        {
            Console.Write(<span class="kwrd">new</span> <span class="kwrd">string</span>(<span class="str">'\t'</span>, level));
            Console.WriteLine(<span class="str">"网站:{0}"</span>, web.Title);

            <span class="kwrd">foreach</span> (SPList list <span class="kwrd">in</span> web.Lists)
            {
                Console.Write(<span class="kwrd">new</span> <span class="kwrd">string</span>(<span class="str">'\t'</span>, level + 1));
                <span class="kwrd">if</span> (list.GetType() == <span class="kwrd">typeof</span>(SPDocumentLibrary))
                    Console.WriteLine(<span class="str">"文档库:{0}"</span>, list.Title);
                <span class="kwrd">else</span>
                    Console.WriteLine(<span class="str">"列表:{0}"</span>, list.Title);


            }

            <span class="kwrd">foreach</span> (SPWeb subweb <span class="kwrd">in</span> web.Webs)
            {
                ShowWebContent(subweb, level + 1);
            }
        }
    }
}
</pre><pre class="csharpcode"><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010ObjectModel_92E1/image_8.png" class="thickbox"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010ObjectModel_92E1/image_thumb_3.png" width="1044" height="810"></a> </pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>完整的输出结构如下</p><pre class="csharpcode">当前服务器场:SharePoint_Config
    服务器:nymoss2010 
        服务:SharePoint Foundation Search
        服务:Microsoft SharePoint Foundation Database
        服务:Information Management Policy Configuration Service
        服务:SharePoint Server Search
        服务:Managed Metadata Web Service
        服务:用户配置文件同步服务
        服务:Microsoft SharePoint Foundation Usage
        服务:Business Data Connectivity
        服务:Search Administration Web Service
        服务:Secure Store Service
        服务:Microsoft SharePoint Foundation Tracing
        服务:Microsoft SharePoint Foundation Workflow Timer Service
        服务:PerformancePoint Service
        服务:Application Registry Service
        服务:SSP 作业控制服务
        服务:Microsoft SharePoint Foundation User Code Service
        服务:门户服务
        服务:Visio Graphics Service
        服务:SharePoint Server Search
        服务:Document Conversions Launcher Service
        服务:Document Conversions Load Balancer Service
        服务:Search Query and Site Settings Service
        服务:Web 分析 Web 服务
        服务:Claims Based Authentication
        服务:Microsoft SharePoint Foundation Web Application
            应用程序:SharePoint - 45223
                网站集:开发测试站点
                    网站:开发测试站点
                        列表:TaxonomyHiddenList
                        文档库:Web 部件库
                        文档库:wfpub
                        文档库:报告模板
                        列表:报告元数据
                        文档库:表单模板
                        列表:工作组讨论
                        文档库:共享文档
                        文档库:解决方案库
                        列表:链接
                        文档库:列表模板库
                        文档库:母版页样式库
                        列表:内容类型发布错误日志
                        列表:任务
                        列表:日历
                        列表:通知
                        文档库:网站页面
                        文档库:网站资产
                        文档库:样式库
                        文档库:已转换表单
                        列表:用户信息列表
                        文档库:主题库
                        文档库:自定义报表
                网站集:开发
                    网站:开发
                        列表:TaxonomyHiddenList
                        文档库:Web 部件库
                        文档库:wfpub
                        文档库:报告模板
                        列表:报告元数据
                        文档库:表单模板
                        列表:工作组讨论
                        文档库:共享文档
                        文档库:解决方案库
                        列表:链接
                        文档库:列表模板库
                        文档库:母版页样式库
                        列表:内容类型发布错误日志
                        列表:任务
                        列表:日历
                        列表:通知
                        文档库:网站页面
                        文档库:网站资产
                        文档库:样式库
                        文档库:已转换表单
                        列表:用户信息列表
                        文档库:主题库
                        文档库:自定义报表
            应用程序:SharePoint - 80
                网站集:我的网站
                    网站:我的网站
                        列表:TaxonomyHiddenList
                        文档库:Web 部件库
                        文档库:表单模板
                        文档库:解决方案库
                        文档库:列表模板库
                        文档库:母版页样式库
                        列表:内容类型发布错误日志
                        文档库:样式库
                        文档库:已转换表单
                        列表:用户信息列表
                        列表:用户照片
                        文档库:主题库
                        文档库:自定义报表
                        列表:组织徽标
        服务:Central Administration
            应用程序:
                网站集:管理中心
                    网站:管理中心
                        列表:SSA1266586a56f24727bf188b22746c631b
                        文档库:Web 部件库
                        列表:复查问题和解决方案
                        文档库:共享文档
                        文档库:管理报告库
                        列表:管理员任务
                        文档库:解决方案库
                        文档库:列表模板库
                        文档库:母版页样式库
                        列表:内容部署路径
                        列表:内容部署作业
                        列表:日历
                        列表:通讯组
                        列表:通知
                        文档库:样式库
                        列表:用户信息列表
                        列表:运行状况分析器规则定义
                        文档库:主题库
                        列表:资源
                        列表:作业报告
                网站集:产品帮助网站
                    网站:产品帮助网站
                        列表:TaxonomyHiddenList
                        文档库:Web 部件库
                        文档库:wfpub
                        文档库:报告模板
                        列表:报告元数据
                        文档库:表单模板
                        文档库:产品帮助
                        列表:工作组讨论
                        文档库:共享文档
                        文档库:解决方案库
                        列表:链接
                        文档库:列表模板库
                        文档库:母版页样式库
                        列表:任务
                        列表:日历
                        列表:通知
                        文档库:网站页面
                        文档库:网站资产
                        文档库:样式库
                        文档库:已转换表单
                        列表:用户信息列表
                        文档库:主题库
                        文档库:自定义报表
        服务:Excel Calculation Services
        服务:Microsoft SharePoint Foundation Incoming E-Mail
        服务:User Profile Service
        服务:Access Database Service
        服务:Microsoft SharePoint Foundation Subscription Settings Service
        服务:Microsoft SharePoint Foundation Administration
        服务:SharePoint Foundation Search
        服务:Microsoft SharePoint Foundation Timer
        服务:Lotus Notes Connector
        服务:Web 分析数据处理服务
        服务:Word Automation Services
        服务:Application Discovery and Load Balancer Service
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>