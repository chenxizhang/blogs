# ADO.NET Data Service如何直接支持用Json格式返回数据 
> 原文发表于 2010-10-27, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/10/27/1862898.html 


<p>今天在介绍WCF及其在项目开发中应用时，再次提到了ADO.NET Data Service。关于这个主题，其实之前我写过不少内容，有兴趣可以参考</p> <p><a title="http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20ado.net%20data%20service" href="http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20ado.net%20data%20service">http://zzk.cnblogs.com/s?w=blog%3Achenxizhang%20ado.net%20data%20service</a></p> <p>&nbsp;</p> <p>同时，微软有一篇非常详细的文档</p> <p><a title="http://msdn.microsoft.com/en-us/library/cc907912.aspx" href="http://msdn.microsoft.com/en-us/library/cc907912.aspx">http://msdn.microsoft.com/en-us/library/cc907912.aspx</a></p> <p>&nbsp;</p> <p>我们知道，ADO.NET Data Service是支持两种数据格式的：xml和json.默认是xml（具体来说是atom格式）</p> <p>如下面的效果</p> <p><a href="http://www.xizhang.com/blogimages/ADO.NET-Data-ServiceJson_111AC/image.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/ADO.NET-Data-ServiceJson_111AC/image_thumb.png" width="1028" height="724"></a></p> <p>那么，如何让这些结果用json格式返回呢？</p> <p>&nbsp;</p> <p>比较遗憾的是，我们暂时不能直接通过设置就完成这个需求。但是有一个开源的项目，提供了一个解决方案，如下</p> <p><a title="http://code.msdn.microsoft.com/DataServicesJSONP" href="http://code.msdn.microsoft.com/DataServicesJSONP">http://code.msdn.microsoft.com/DataServicesJSONP</a></p> <p>The net effect is that if you include this code in your project, you just need to add a single attribute to your Data Service to make it support JSONP:<br>[JSONPSupportBehavior]<br>public class SampleService : DataService&lt;ContactsData&gt; <br>{ <br>// your service code here... <br>} <br>Once that's in place you can use JSONP by adding $format and $callback to URLs, for example:<br>http://&lt;host&gt;/SampleService.svc/People?$format=json&amp;$callback=cb<br>Of course, you can still use all the other Data Services URL options in addition to these. <p>&nbsp;</p> <p>使用起来很简单，他是写好了一个Behavior的Attribute，我们只需要在有关的类型上面加上即可</p> <p><a href="http://www.xizhang.com/blogimages/ADO.NET-Data-ServiceJson_111AC/image_3.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/ADO.NET-Data-ServiceJson_111AC/image_thumb_3.png" width="916" height="670"></a></p> <p>&nbsp;</p> <p>然后，在请求地址中添加$format=json这样的字样即可</p> <p><a title="http://localhost:1142/OrderService.svc/Customers('ALFKI')/Orders?$format=json" href="http://localhost:1142/OrderService.svc/Customers('ALFKI')/Orders?$format=json">http://localhost:1142/OrderService.svc/Customers('ALFKI')/Orders?$format=json</a></p> <p>&nbsp;</p> <p>返回的json数据，大致如下</p> <p><a href="http://www.xizhang.com/blogimages/ADO.NET-Data-ServiceJson_111AC/image_4.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/ADO.NET-Data-ServiceJson_111AC/image_thumb_4.png" width="706" height="677"></a></p>