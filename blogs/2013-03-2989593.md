# 可复用的WPF或者Silverlight应用程序和组件设计(5)&mdash;&mdash;布局重用 
> 原文发表于 2013-03-29, 地址: http://www.cnblogs.com/chenxizhang/archive/2013/03/29/2989593.html 


<h2>内容概述</h2> <p>我去年写过几篇关于在WPF和Silverlight中实现可复用的设计的文章，分别如下，如果有兴趣地可以先参考一下</p> <ul> <li> <h5><a href="http://www.cnblogs.com/chenxizhang/archive/2012/04/18/2455393.html"><strong>可复用</strong>的WPF或者Silverlight应用程序和组件设计(1)——应用程序级别</a></h5> <li> <h5><a href="http://www.cnblogs.com/chenxizhang/archive/2012/04/18/2455560.html"><strong>可复用</strong>的WPF或者Silverlight应用程序和组件设计(2)——组件级别</a></h5> <li> <h5><a href="http://www.cnblogs.com/chenxizhang/archive/2012/04/23/2466957.html"><strong>可复用</strong>的WPF或者Silverlight应用程序和组件设计(3)——控件级别</a></h5> <li> <h5><a href="http://www.cnblogs.com/chenxizhang/archive/2012/04/23/2466963.html"><strong>可复用</strong>的WPF或者Silverlight应用程序和组件设计(4)——外观级别</a></h5></li></ul> <h5>今天要继续写第五篇的原因在于最近的一些思考，也是我被问到的一个问题：我们知道WPF中的布局控件有很多，例如Grid,StackPanel,Canvas等等，利用他们，编写一定的XAML定义，就可以设计出来足够灵活多样的界面。但这里会有一个问题，如果我们很多界面都很类似，例如有某种固定格式的布局要求，那么是否在每个界面上都应该去定义一次呢？</h5> <p>[备注]和前几篇文章不同的是，这一篇没有录制视频，因为我还是觉得文字的部分很重要。</p> <p>本文源代码可以通过 <a title="http://files.cnblogs.com/chenxizhang/WpfApplicationSample.zip" href="http://files.cnblogs.com/chenxizhang/WpfApplicationSample.zip">http://files.cnblogs.com/chenxizhang/WpfApplicationSample.zip</a>&nbsp; 下载</p> <p>&nbsp;</p> <h2>问题详细描述</h2> <p>想象一下下面这样一个示意图</p> <p><a href="http://images.cnitblog.com/blog/9072/201303/29204630-4c10c1d586d5405a933c65671a843522.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204630-fa53cbce5ea94ac6a7e42d9dbd6a408f.png" width="244" height="166"></a></p> <p>如果只有一个界面的话，那么我们可以很简单地实现，如下面所示</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">Window</span> <span class="attr">x:Class</span><span class="kwrd">="WpfApplicationSample.MainWindow"</span>
        <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <strong><font color="#ff0000"><span class="attr">xmlns:extension</span><span class="kwrd">="clr-namespace:System.Windows.Extensions;assembly=WPFExtension"</span></font></strong>
        <span class="attr">Title</span><span class="kwrd">="MainWindow"</span>
        <span class="attr">Height</span><span class="kwrd">="350"</span>
        <span class="attr">Width</span><span class="kwrd">="525"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">Window.Resources</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Style</span> <span class="attr">TargetType</span><span class="kwrd">="TextBlock"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="FontSize"</span>
                    <span class="attr">Value</span><span class="kwrd">="30"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Window.Resources</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">Grid</span> <span class="attr">extension:GridHelper</span>.<span class="attr">ShowBorder</span><span class="kwrd">="True"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Grid.RowDefinitions</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span> <span class="attr">Height</span><span class="kwrd">="80"</span><span class="kwrd">&gt;&lt;/</span><span class="html">RowDefinition</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span> <span class="attr">Height</span><span class="kwrd">="*"</span><span class="kwrd">&gt;&lt;/</span><span class="html">RowDefinition</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.RowDefinitions</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="*"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ColumnDefinition</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="100"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ColumnDefinition</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span>
        
        
        <span class="rem">&lt;!--顶部控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Top"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>
        
        
        <span class="rem">&lt;!--主体控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Main"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>
        
        <span class="rem">&lt;!--右侧控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span>
                        <span class="attr">Grid</span>.<span class="attr">RowSpan</span><span class="kwrd">="2"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">Window</span><span class="kwrd">&gt;</span>
</pre>
<p>这个界面看起来是这样的：</p>
<p><a href="http://images.cnitblog.com/blog/9072/201303/29204630-cd59e8aa678640849ec7c9aa744fd878.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204631-cf846d170ef64bd0aaa3cb98d9381118.png" width="244" height="164"></a> 
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>所以，我们完全可以做得出来。但是问题的关键在于，如果有很多窗口都是这样的布局，那么我们是否应该每个窗口都去这样定义？还是说能否从一定意义上实现布局重用：<strong><font color="#ff0000">能不能让这个Grid默认就有两行和两列呢？</font></strong></p>
<p>[备注] 上面的代码中，为了给Grid添加边框线，使用到了我以前写的一个扩展组件，可以通过这里了解如何使用：<a href="http://nuget.org/packages/WPFSilverlightExtension/">http://nuget.org/packages/WPFSilverlightExtension/</a></p>
<p>&nbsp;</p>
<h2>Windows Forms里面的做法</h2>
<p>很久以前，那时候还没有WPF，我们都使用Windows Forms这个技术来做界面。那时候，对于上面提到的这种布局重用的问题，有一个很简单的解决方案：窗体继承。</p>
<p>对于这一种技术，本文并不打算对此进行展开讨论，有兴趣的朋友可以参考MSDN：<a href="http://msdn.microsoft.com/en-us/library/aa983613(v=VS.71).aspx">http://msdn.microsoft.com/en-us/library/aa983613(v=VS.71).aspx</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>是否可以通过Style来实现对Grid行和列的定制</h2>
<p>虽然确实有很多人怀念Windows Forms那种经典的界面开发，但时光之轮总是催我们向前。回到现在我们在用的WPF这个技术，对于控件和界面重用，WPF提供了很强大的Style功能。所以，基于上面这样的需求，我们会很自然地想到是否可以通过Style来实现。</p><pre class="csharpcode">        <span class="kwrd">&lt;</span><span class="html">Style</span> <span class="attr">TargetType</span><span class="kwrd">="Grid"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="ColumnDefinitions"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter.Value</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="*"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ColumnDefinition</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="100"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ColumnDefinition</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">Setter.Value</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="RowDefinitions"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter.Value</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">RowDefinition</span> <span class="attr">Height</span><span class="kwrd">="80"</span><span class="kwrd">&gt;&lt;/</span><span class="html">RowDefinition</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">RowDefinition</span> <span class="attr">Height</span><span class="kwrd">="*"</span><span class="kwrd">&gt;&lt;/</span><span class="html">RowDefinition</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">Setter.Value</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span></pre>
<p>如果能这样写，当然是很好的。但问题是，<strong><font color="#ff0000">你不能这样写</font></strong>。错误如下</p>
<p><br><a href="http://images.cnitblog.com/blog/9072/201303/29204631-1627cb10010348f6af7ee251738f9328.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204631-240207bd862c433cb04a6f0ffd81a9b2.png" width="644" height="77"></a></p>
<p>如果去查看Grid的类型定义，会发现这个属性确实只有get方法器</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><a href="http://images.cnitblog.com/blog/9072/201303/29204632-be33a6c4dfce4eee88844e862c6a1fe4.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204632-3c3e3e7ef4e14bfa91e06f6cbc4ba0aa.png" width="644" height="169"></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>是否可以通过对Grid进行扩展来实现行和列的定制</h2>
<p>一计不成，我们可以继续想办法。有着良好的面向对象素养的同学一定可以想到，那么要不就对Grid做一个扩展，默认提供行和列的定义，这样行不行呢？例如</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows.Controls;

<span class="kwrd">namespace</span> WpfApplicationSample
{
    <span class="kwrd">class</span> LayoutGrid:Grid
    {


        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnInitialized(System.EventArgs e)
        {
            <span class="kwrd">base</span>.OnInitialized(e);

            <span class="rem">//默认提供两行两列的实现</span>
            <span class="kwrd">base</span>.ColumnDefinitions.Add(<span class="kwrd">new</span> ColumnDefinition());
            <span class="kwrd">base</span>.ColumnDefinitions.Add(<span class="kwrd">new</span> ColumnDefinition() { Width = <span class="kwrd">new</span> System.Windows.GridLength(100) });

            <span class="kwrd">base</span>.RowDefinitions.Add(<span class="kwrd">new</span> RowDefinition() { Height = <span class="kwrd">new</span> System.Windows.GridLength(80) });
            <span class="kwrd">base</span>.RowDefinitions.Add(<span class="kwrd">new</span> RowDefinition());
        }
    }
}
</pre><pre class="csharpcode">然后，我们在界面上可以像下面这样使用。很明显，这样可以简化很多了。</pre><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">Window</span> <span class="attr">x:Class</span><span class="kwrd">="WpfApplicationSample.MainWindow"</span>
        <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="attr">xmlns:extension</span><span class="kwrd">="clr-namespace:System.Windows.Extensions;assembly=WPFExtension"</span>
        <span class="attr">xmlns:local</span><span class="kwrd">="clr-namespace:WpfApplicationSample"</span>
        <span class="attr">Title</span><span class="kwrd">="MainWindow"</span>
        <span class="attr">Height</span><span class="kwrd">="350"</span>
        <span class="attr">Width</span><span class="kwrd">="525"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">Window.Resources</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Style</span> <span class="attr">TargetType</span><span class="kwrd">="TextBlock"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="FontSize"</span>
                    <span class="attr">Value</span><span class="kwrd">="30"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Window.Resources</span><span class="kwrd">&gt;</span>
    
    
    <span class="kwrd">&lt;</span><span class="html">local:LayoutGrid</span> <span class="attr">extension:GridHelper</span>.<span class="attr">ShowBorder</span><span class="kwrd">="true"</span><span class="kwrd">&gt;</span>
        <span class="rem">&lt;!--顶部控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Top"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>


        <span class="rem">&lt;!--主体控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Main"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>

        <span class="rem">&lt;!--右侧控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span>
                        <span class="attr">Grid</span>.<span class="attr">RowSpan</span><span class="kwrd">="2"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ContentControl.Content</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;/</span><span class="html">local:LayoutGrid</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;/</span><span class="html">Window</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>这个方案的美中不足，在于使用者还是需要记住要在具体的内容控件上面设置Grid.Row，Grid.Column等相关信息，而且，如果他忘记写，或者没有按照规范写，实际上就没有实现界面的统一，因为你没有办法强制他必须写，或者怎么写。</p>
<p>要想实现界面的统一，就必须把这种可能改变界面的属性，从使用者的身边移开。</p>
<p>&nbsp;</p>
<h2>使用用户控件实现PlaceHolder式的控件模板</h2>
<p>既然直接扩展Grid并不能完整地实现我们的需求，我接下来想到是否可以使用用户控件来封装，而且为了让用户使用简单，同时也避免用户不按照规定使用，所以我借鉴了ASP.NET中的母版页(<a href="http://www.asp.net/web-forms/tutorials/master-pages" target="_blank">master page</a>)这样的技术，使用类似PlaceHolder这样的方式来实现了一个控件模板。</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">UserControl</span> <span class="attr">x:Class</span><span class="kwrd">="WpfApplicationSample.TemplateLayout"</span>
             <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
             <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
             <span class="attr">xmlns:d</span><span class="kwrd">="http://schemas.microsoft.com/expression/blend/2008"</span>
             <span class="attr">xmlns:extension</span><span class="kwrd">="clr-namespace:System.Windows.Extensions;assembly=WPFExtension"</span>
             <span class="attr">mc:Ignorable</span><span class="kwrd">="d"</span>
             <span class="attr">d:DesignHeight</span><span class="kwrd">="300"</span>
             <span class="attr">d:DesignWidth</span><span class="kwrd">="300"</span>
             <span class="attr">x:Name</span><span class="kwrd">="root"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Grid</span> <span class="attr">extension:GridHelper</span>.<span class="attr">ShowBorder</span><span class="kwrd">="True"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Grid.RowDefinitions</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span> <span class="attr">Height</span><span class="kwrd">="80"</span><span class="kwrd">&gt;&lt;/</span><span class="html">RowDefinition</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span> <span class="attr">Height</span><span class="kwrd">="*"</span><span class="kwrd">&gt;&lt;/</span><span class="html">RowDefinition</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.RowDefinitions</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="*"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ColumnDefinition</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="100"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ColumnDefinition</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span>

        <span class="rem">&lt;!--顶部控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Content</span><span class="kwrd">="{Binding TopControl,ElementName=root}"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>


        <span class="rem">&lt;!--主体控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="1"</span>
                        <span class="attr">Content</span><span class="kwrd">="{Binding MainControl,ElementName=root}"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>

        <span class="rem">&lt;!--右侧控件--&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ContentControl</span> <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span>
                        <span class="attr">Grid</span>.<span class="attr">RowSpan</span><span class="kwrd">="2"</span>
                        <span class="attr">Content</span><span class="kwrd">="{Binding RightControl,ElementName=root}"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">UserControl</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>需要注意的是，因为这里是定义一个控件模板，所以具体的内容控件是没有内容的，我们希望使用者可以后期再插入具体的内容。这里使用到了绑定的技术。为了支持绑定，我们在这个控件中添加了三个依赖属性，如下</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;

<span class="kwrd">namespace</span> WpfApplicationSample
{
    <span class="rem">/// &lt;summary&gt;</span>
    <span class="rem">/// Interaction logic for TemplateLayout.xaml</span>
    <span class="rem">/// &lt;/summary&gt;</span>
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> TemplateLayout : UserControl
    {
        <span class="kwrd">public</span> TemplateLayout()
        {
            InitializeComponent();
        }




        <span class="kwrd">public</span> <span class="kwrd">object</span> TopControl
        {
            get { <span class="kwrd">return</span> (<span class="kwrd">object</span>)GetValue(TopControlProperty); }
            set { SetValue(TopControlProperty, <span class="kwrd">value</span>); }
        }

        <span class="rem">// Using a DependencyProperty as the backing store for TopControl.  This enables animation, styling, binding, etc...</span>
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> DependencyProperty TopControlProperty =
            DependencyProperty.Register(<span class="str">"TopControl"</span>, <span class="kwrd">typeof</span>(<span class="kwrd">object</span>), <span class="kwrd">typeof</span>(TemplateLayout), <span class="kwrd">new</span> PropertyMetadata(<span class="kwrd">null</span>));





        <span class="kwrd">public</span> <span class="kwrd">object</span> MainControl
        {
            get { <span class="kwrd">return</span> (<span class="kwrd">object</span>)GetValue(MainControlProperty); }
            set { SetValue(MainControlProperty, <span class="kwrd">value</span>); }
        }

        <span class="rem">// Using a DependencyProperty as the backing store for MainControl.  This enables animation, styling, binding, etc...</span>
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> DependencyProperty MainControlProperty =
            DependencyProperty.Register(<span class="str">"MainControl"</span>, <span class="kwrd">typeof</span>(<span class="kwrd">object</span>), <span class="kwrd">typeof</span>(TemplateLayout), <span class="kwrd">new</span> PropertyMetadata(<span class="kwrd">null</span>));





        <span class="kwrd">public</span> <span class="kwrd">object</span> RightControl
        {
            get { <span class="kwrd">return</span> (<span class="kwrd">object</span>)GetValue(RightControlProperty); }
            set { SetValue(RightControlProperty, <span class="kwrd">value</span>); }
        }

        <span class="rem">// Using a DependencyProperty as the backing store for RightControl.  This enables animation, styling, binding, etc...</span>
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> DependencyProperty RightControlProperty =
            DependencyProperty.Register(<span class="str">"RightControl"</span>, <span class="kwrd">typeof</span>(<span class="kwrd">object</span>), <span class="kwrd">typeof</span>(TemplateLayout), <span class="kwrd">new</span> PropertyMetadata(<span class="kwrd">null</span>));


    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>那么，如何来使用这个模板控件呢？大致是下面这样的：</p><pre class="csharpcode">    <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Top"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Main"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>很显然，这样使用起来更加简洁方便，而且使用者只能往我们预先定义好的三个内容区域中去填充内容，而不可能因为错误的设置属性（或者忘记设置属性）而导致界面布局不一致。</p>
<p><a href="http://images.cnitblog.com/blog/9072/201303/29204633-4c727be8279141b7b465b8e972fba67e.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204633-9233f93673ca416d9a6a3e79f3982ff8.png" width="244" height="164"></a></p>
<p>&nbsp;</p>
<p>看起来相当不错，几乎已经完全实现了我们的要求。我以前也就一直这样用，直到最近发现一个问题。</p>
<p>如果我们出于一些目的，希望给这些内容控件添加名称，以便在后台代码中访问到它。例如下面这样：</p><pre class="csharpcode">    <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
           <strong><font color="#ff0000"> <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Top"</span> <span class="attr">x:Name</span><span class="kwrd">="topTextBlock"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span></font></strong>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Main"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>看起来是一个很平常的修改，但你立即会发现，这会导致无法编译通过。</p>
<p><a href="http://images.cnitblog.com/blog/9072/201303/29204634-af9a7ddb5aab40718fd82d8441ed4c48.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204634-db8f93fa3fb34db78ff38ee6c83274b7.png" width="644" height="124"></a></p>
<p>Cannot set Name attribute value 'topTextBlock' on element 'TextBlock'. 'TextBlock' is under the scope of element 'TemplateLayout', which already had a name registered when it was defined in another scope.</p>
<p>这个错误实在是让人捉摸不透，目前也没有找到合理的解释。可能的解释是这样：因为我们的TextBlock其实是嵌入到TemplateLayout中，而TemplateLayout默认会为内部的控件生成一个名称，所以就不允许再定义名称。</p>
<p>为此，我也找了很多资料，一个最接近的讨论在这里</p>
<p><a href="http://stackoverflow.com/questions/5758342/how-to-create-wpf-usercontrol-which-contains-placeholders-for-later-usage">http://stackoverflow.com/questions/5758342/how-to-create-wpf-usercontrol-which-contains-placeholders-for-later-usage</a></p>
<p>这个问题描述到了和本文比较接近的情况，而且也提到了如果假如名称，会出现错误。但是该文也没有可用的解决方案。</p>
<p>&nbsp;</p>
<p>针对这个问题，我做了不少研究，同时也找了一些朋友进行讨论。其中和<a href="http://weibo.com/waynebabywang" target="_blank">韦恩卑鄙</a> 的讨论中，他给了我一个启发，打开了我另外一个思路：<strong><font color="#ff0000">如果说定义名称是必须的，那么既然WPF内部的命名规范无法通过，那么是否可以通过自己的一种什么机制来定义名称呢</font></strong>？最终我确定使用<a href="http://msdn.microsoft.com/en-us/library/ms749011.aspx" target="_blank">附加属性</a>来实现了该功能。<strong>荣誉属于</strong><a href="http://weibo.com/waynebabywang" target="_blank"><strong>韦恩卑鄙</strong></a><strong>。</strong></p>
<p>&nbsp;</p>
<h2>通过附加属性来为控件添加名称</h2>
<p>我创建了如下这样一个类型，添加了一个附加属性，并且为控件查找提供了一个方法。
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p><pre class="csharpcode"><span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Windows;

<span class="kwrd">namespace</span> WpfApplicationSample
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> LayoutExtension
    {
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// 这个方法用来获取控件</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;typeparam name="T"&gt;指定控件类型，例如TextBlock&lt;/typeparam&gt;</span>
        <span class="rem">/// &lt;param name="name"&gt;指定控件名称&lt;/param&gt;</span>
        <span class="rem">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="kwrd">public</span> <span class="kwrd">static</span> T GetControl&lt;T&gt;(<span class="kwrd">string</span> name)
            <span class="kwrd">where</span> T : <span class="kwrd">class</span>
        {
            <span class="kwrd">return</span> controls.FirstOrDefault(t =&gt; t.Key == name).Value <span class="kwrd">as</span> T;
        }


        <span class="kwrd">private</span> <span class="kwrd">static</span> Dictionary&lt;<span class="kwrd">string</span>, DependencyObject&gt; controls;
        <span class="kwrd">static</span> LayoutExtension()
        {
            controls = <span class="kwrd">new</span> Dictionary&lt;<span class="kwrd">string</span>, DependencyObject&gt;();
        }

        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">string</span> GetName(DependencyObject obj)
        {
            <span class="kwrd">return</span> (<span class="kwrd">string</span>)obj.GetValue(NameProperty);
        }

        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> SetName(DependencyObject obj, <span class="kwrd">string</span> <span class="kwrd">value</span>)
        {
            obj.SetValue(NameProperty, <span class="kwrd">value</span>);

        }

        <span class="rem">// Using a DependencyProperty as the backing store for Name.  This enables animation, styling, binding, etc...</span>
        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> DependencyProperty NameProperty =
            DependencyProperty.RegisterAttached(<span class="str">"Name"</span>, <span class="kwrd">typeof</span>(<span class="kwrd">string</span>), <span class="kwrd">typeof</span>(LayoutExtension), <span class="kwrd">new</span> PropertyMetadata(<span class="kwrd">string</span>.Empty, (d, e) =&gt;
            {
                <span class="kwrd">if</span> (e.NewValue != <span class="kwrd">null</span>)
                {
                    var name = e.NewValue.ToString();

                    <span class="kwrd">if</span> (!controls.ContainsKey(name))
                        controls.Add(name, d);
                }
            }));

    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>如何使用这个扩展呢？</p><pre class="csharpcode">
    <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Top"</span>
                       <span class="attr">local:LayoutExtension</span>.<span class="attr">Name</span><span class="kwrd">="topTextBlock"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Main"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>然后，如果需要在后台代码中访问这个控件，就可以大致像下面这样操作</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> System.Windows.Media;

<span class="kwrd">namespace</span> WpfApplicationSample
{
    <span class="rem">/// &lt;summary&gt;</span>
    <span class="rem">/// Interaction logic for MainWindow.xaml</span>
    <span class="rem">/// &lt;/summary&gt;</span>
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainWindow : Window
    {
        <span class="kwrd">public</span> MainWindow()
        {
            InitializeComponent();

            Loaded += MainWindow_Loaded;
        }

        <span class="kwrd">void</span> MainWindow_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var txt = LayoutExtension.GetControl&lt;TextBlock&gt;(<span class="str">"topTextBlock"</span>);
            txt.Foreground = <span class="kwrd">new</span> SolidColorBrush(Colors.Red);

        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><a href="http://images.cnitblog.com/blog/9072/201303/29204635-3fdf7d412c904973b93801d44b40f28f.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204635-5a085e5436f3474a8c030192ae0e880f.png" width="244" height="164"></a></p>
<p>&nbsp;</p>
<h2>如何更加方便地使用这个扩展？</h2>
<p>为了使得大家更加方便地使用这个扩展，我将其合并到了我之前写过的针对WPF和Silverlight的扩展包中，大家可以通过nuget package manager搜索wpfsilverlightextension下载安装这个扩展包</p>
<p><a href="http://images.cnitblog.com/blog/9072/201303/29204636-de8ecb49c55044be995663e7d77b2ccf.png"><img title="image" border="0" alt="image" src="http://images.cnitblog.com/blog/9072/201303/29204636-986fa0d800964adc8254fc669fb6fdf0.png" width="244" height="140"></a></p>
<p>目前这个扩展，既支持WPF，也支持Silverlight。可以免费使用。</p>
<p>如果是使用这个包的话，那么在导入名称空间的时候，我习惯用extension这个名称，所以在具体页面中用的时候，大致上是下面这样</p><pre class="csharpcode">    <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Top"</span>
                       <span class="attr">extension:LayoutExtension</span>.<span class="attr">Name</span><span class="kwrd">="topTextBlock"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.TopControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Main"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.MainControl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout.RightControl</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">local:TemplateLayout</span><span class="kwrd">&gt;</span></pre><pre class="csharpcode"><span class="kwrd"></span>&nbsp;</pre><pre class="csharpcode"><span class="kwrd"></span>&nbsp;</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<h2>是否一定要使用这个扩展？</h2>
<p>看起来还不错，但是是否一定要使用这个扩展呢？并不见得。因为我之前就说过，我以前没有意识到这个Name会出问题，是因为我几乎大部分时候都没有命名这种需要。为什么呢？因为我们大部分时候都会使用mvvm这种模式进行WPF应用程序的开发，在这种情况下，我们是不会在代码中去访问到控件的。例如下面是一个较为真实的例子：</p><pre class="csharpcode">&lt;Page x:Class=<span class="str">"EmployeePage"</span>
      xmlns=<span class="str">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
      xmlns:x=<span class="str">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
      xmlns:mc=<span class="str">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
      xmlns:d=<span class="str">"http://schemas.microsoft.com/expression/blend/2008"</span>
      xmlns:local=<span class="str">"clr-namespace:SMSApplicationSample"</span>
      xmlns:extension=<span class="str">"clr-namespace:System.Windows.Extensions;assembly=WPFExtension"</span>
      xmlns:tk=<span class="str">"clr-namespace:Xceed.Wpf.Toolkit;assembly=WPFToolkit.Extended"</span>
      mc:Ignorable=<span class="str">"d"</span>
      d:DesignHeight=<span class="str">"300"</span>
      d:DesignWidth=<span class="str">"300"</span>
      Title=<span class="str">"EmployeePage"</span>&gt;

    &lt;Page.DataContext&gt;
        &lt;local:EmployeePageViewModel&gt;&lt;/local:EmployeePageViewModel&gt;
    &lt;/Page.DataContext&gt;

    &lt;tk:BusyIndicator 
        IsBusy=<span class="str">"{Binding IsBusy}"</span>
        BusyContent=<span class="str">"Data loading,pls wait..."</span>&gt;
       
        &lt;local:TemplateLayout&gt;
            &lt;local:TemplateLayout.Condition&gt;
                &lt;!--加载所有员工--&gt;
                &lt;DataGrid ItemsSource=<span class="str">"{Binding Employees}"</span>
                          SelectedItem=<span class="str">"{Binding CurrentEmployee,Mode=TwoWay}"</span>&gt;
                    &lt;!--通过前台的选择，TwoWay的方式可以将CurrentEmployee的更新告诉后台，并且去更新绑定了该属性的元素，这个机制就是所谓的依赖属性的通知功能--&gt;
                &lt;/DataGrid&gt;
            &lt;/local:TemplateLayout.Condition&gt;
            &lt;local:TemplateLayout.Result&gt;
                &lt;!--显示一个员工--&gt;
                &lt;ContentControl Content=<span class="str">"{Binding CurrentEmployee}"</span>&gt;
                    &lt;ContentControl.ContentTemplate&gt;
                        &lt;DataTemplate&gt;
                            &lt;Grid extension:GridHelper.ShowBorder=<span class="str">"True"</span>&gt;
                                &lt;Grid.RowDefinitions&gt;
                                    &lt;RowDefinition Height=<span class="str">"auto"</span>&gt;&lt;/RowDefinition&gt;
                                    &lt;RowDefinition Height=<span class="str">"auto"</span>&gt;&lt;/RowDefinition&gt;
                                    &lt;RowDefinition Height=<span class="str">"auto"</span>&gt;&lt;/RowDefinition&gt;
                                    &lt;RowDefinition Height=<span class="str">"auto"</span>&gt;&lt;/RowDefinition&gt;
                                &lt;/Grid.RowDefinitions&gt;
                                &lt;Grid.ColumnDefinitions&gt;
                                    &lt;ColumnDefinition Width=<span class="str">"100"</span>&gt;&lt;/ColumnDefinition&gt;
                                    &lt;ColumnDefinition Width=<span class="str">"*"</span>&gt;&lt;/ColumnDefinition&gt;
                                    &lt;ColumnDefinition Width=<span class="str">"100"</span>&gt;&lt;/ColumnDefinition&gt;
                                &lt;/Grid.ColumnDefinitions&gt;

                                &lt;Image Source=<span class="str">"{Binding Photo}"</span>
                                       Grid.Column=<span class="str">"2"</span>
                                       Grid.RowSpan=<span class="str">"4"</span>&gt;&lt;/Image&gt;

                                &lt;TextBlock Text=<span class="str">"FirstName:"</span>&gt;&lt;/TextBlock&gt;
                                &lt;TextBlock Text=<span class="str">"{Binding FirstName}"</span>
                                           Grid.Column=<span class="str">"1"</span>&gt;&lt;/TextBlock&gt;

                                &lt;TextBlock Text=<span class="str">"LastName:"</span>
                                           Grid.Row=<span class="str">"1"</span>&gt;&lt;/TextBlock&gt;
                                &lt;TextBlock Text=<span class="str">"{Binding LastName}"</span>
                                           Grid.Row=<span class="str">"1"</span>
                                           Grid.Column=<span class="str">"1"</span>&gt;&lt;/TextBlock&gt;

                                &lt;TextBlock Text=<span class="str">"Title:"</span>
                                           Grid.Row=<span class="str">"2"</span>&gt;&lt;/TextBlock&gt;
                                &lt;TextBlock Text=<span class="str">"{Binding Title}"</span>
                                           Grid.Row=<span class="str">"2"</span>
                                           Grid.Column=<span class="str">"1"</span>&gt;&lt;/TextBlock&gt;

                                &lt;TextBlock Text=<span class="str">"Address:"</span>
                                           Grid.Row=<span class="str">"3"</span>&gt;&lt;/TextBlock&gt;
                                &lt;TextBlock Text=<span class="str">"{Binding Address}"</span>
                                           Grid.Row=<span class="str">"3"</span>
                                           Grid.Column=<span class="str">"1"</span>&gt;&lt;/TextBlock&gt;

                            &lt;/Grid&gt;
                        &lt;/DataTemplate&gt;
                    &lt;/ContentControl.ContentTemplate&gt;

                &lt;/ContentControl&gt;
            &lt;/local:TemplateLayout.Result&gt;
            &lt;local:TemplateLayout.Action&gt;
                &lt;!--显示一些按钮，可以添加，删除，修改员工--&gt;
                &lt;StackPanel&gt;
                    &lt;Button Content=<span class="str">"New..."</span>
                            Command=<span class="str">"{Binding NewCommand}"</span>&gt;&lt;/Button&gt;
                    &lt;Button Content=<span class="str">"Update..."</span>
                            Command=<span class="str">"{Binding UpdateCommand}"</span>
                            CommandParameter=<span class="str">"{Binding CurrentEmployee}"</span>&gt;&lt;/Button&gt;
                    &lt;Button Content=<span class="str">"Delete..."</span>
                            Command=<span class="str">"{Binding DeleteCommand}"</span>&gt;&lt;/Button&gt;

                    &lt;Button Content=<span class="str">"Show Report..."</span>
                            Command=<span class="str">"{Binding ReportCommand}"</span>&gt;&lt;/Button&gt;
                &lt;/StackPanel&gt;
            &lt;/local:TemplateLayout.Action&gt;
        &lt;/local:TemplateLayout&gt;
    &lt;/tk:BusyIndicator&gt;
        
&lt;/Page&gt;
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>本文源代码可以通过 <a title="http://files.cnblogs.com/chenxizhang/WpfApplicationSample.zip" href="http://files.cnblogs.com/chenxizhang/WpfApplicationSample.zip">http://files.cnblogs.com/chenxizhang/WpfApplicationSample.zip</a>&nbsp; 下载</p>