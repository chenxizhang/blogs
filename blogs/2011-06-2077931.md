# 如何在命令行脚本中启动带参数的Windows服务 
> 原文发表于 2011-06-10, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/10/2077931.html 


<p>这是一个小问题：</p> <p>我们有一个自己编写的Windows服务，我们希望该服务在启动时可以根据用户输入的参数实现不同的功能。</p> <p>要实现这样的需求并不是很难，下面这个例子我用来示范如何编写该服务</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.ComponentModel;
<span class="kwrd">using</span> System.Data;
<span class="kwrd">using</span> System.Diagnostics;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.ServiceProcess;
<span class="kwrd">using</span> System.Text;

<span class="kwrd">namespace</span> WindowsServiceSample
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> SampleService : ServiceBase
    {
        <span class="kwrd">public</span> SampleService()
        {
            InitializeComponent();
        }

        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// 服务启动时触发</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;param name="args"&gt;用户可以设置的输入参数&lt;/param&gt;</span>
        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnStart(<span class="kwrd">string</span>[] args)
        {

            <span class="kwrd">if</span> (args.Length &gt; 0)
            {
                EventLog.WriteEntry(<span class="kwrd">string</span>.Format(<span class="str">"sample service is started with parameter :{0}"</span>, <span class="kwrd">string</span>.Join(<span class="str">","</span>, args)));
            }
            <span class="kwrd">else</span>
            {
                EventLog.WriteEntry(<span class="str">"sample service is started with non parameter"</span>);
            }
        }

        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnStop()
        {
        }
    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>在上述代码中，我区分了带参数启动和不带参数启动两种情况。很显然，在带参数的那种情况下，我们可以根据参数做不同的处理。本文仅为了说明参数问题，并不真的去考虑那些实际应用。我通过写日志的方式来区分即可。</p>
<p>&nbsp;</p>
<p>这个服务安装起来之后，在服务控制台中看起来是这样的</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034421990.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/2011061020344271.png" width="824" height="604"></a></p>
<p>如果我们通过手工去启动的话，如何设置参数呢？很简单，双击该服务，在属性对话框中输入参数即可</p>
<p>【注意】是先输入参数，然后点击“Start”</p>
<p>【注意】不同的参数之间用空格隔开</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034422056.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034429581.png" width="418" height="474"></a></p>
<p>启动成功后，我们在事件日志中可以看到一条日志</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034436234.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034439614.png" width="805" height="562"></a></p>
<p>这说明，参数确实被捕捉到了。服务正常进行了工作。</p>
<p>还不错对吧？但本文的最大目的并不是解释这个，上面都是铺垫，如果我们是要通过命令行脚本的方式来启动服务，而不是手工启动服务，那么该如何设置参数呢？</p>
<p>&nbsp;</p>
<p>我们都知道要在命令行中启动服务，一般都是通过net start命令。这个工具的格式如下</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110610203443170.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034437139.png" width="998" height="346"></a></p>
<p>我们可以通过net start sampleservice启动服务</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034433791.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110610203443760.png" width="1002" height="346"></a></p>
<p>在事件日志中确实看到它是没有带参数启动的</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034446648.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034441665.png" width="805" height="562"></a></p>
<p>好吧，那么如何传递参数过去呢？</p>
<p>经过研究发现，net 工具要传递参数的话，有一个很特殊的做法</p>
<p>net start sampleservice /a /b /c /d</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034443857.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034449190.png" width="936" height="346"></a></p>
<p>但是这样启动之后，看日志却发现有一点点特殊</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034442254.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034449779.png" width="805" height="562"></a></p>
<p>请主要，参数确实传递进来了。但包含了“/”。如果说在程序中识别这个特殊的符号，那么也是没有问题的。只不过，这样就未必是增加了程序的复杂性啦。</p>
<p>那么，有没有更加简单的做法呢？（简单的意思是说与手工操作是一样的，不需要为此去修改代码）</p>
<p>我想起来，除了用net start之外，还可以通过sc start命令来启动服务</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034453400.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034456813.png" width="936" height="346"></a><br>这样的命令就直观多了。我们马上来看一下日志文件中的结果吧</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034466879.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106102034468025.png" width="805" height="562"></a></p>
<p>很好，这是我们需要的效果。也就是说用sc工具的话，可以很好地传递参数。</p>
<p>【备注】sc的意思是，service controller,关于该工具的详细介绍，请参考 <a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/sc.mspx?mfr=true">http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/sc.mspx?mfr=true</a></p>