# MOSS 2010：Visual Studio 2010开发体验（8）&mdash;&mdash;Silverlight应用 
> 原文发表于 2010-04-06, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/04/06/1705132.html 


<p>好吧，Silverlight现在已经是妇孺皆知了，所以MOSS 没有道理不支持它。其实说实在话，支持Silverlight并没有什么太难的事情，因为它主要依赖的是一个浏览器插件，其实与SharePoint没有什么关系的。</p> <p>anyway，我们还是来看一下MOSS 2010中如何使用Silverlight吧</p> <p>MOSS 2010默认提供了一个Web Part，是用来展现Silverlight的。</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_2.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_4.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_1.png" width="1044" height="810"></a> </p> <p>它当然需要我们提供一个xap文件的地址。所以i，我们现在要开始做一个最简单的Silverlight应用程序，然后将它的结果放在一个可以访问的地方。</p> <p>1. 创建Silverlight应用程序</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_6.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_2.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_8.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_3.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_10.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_4.png" width="1044" height="810"></a> </p> <p>我们这个应用程序只需要实现最简单的功能，就是一个按钮，点击之后，显示一个“Hello,world”的消息即可</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_12.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_5.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_14.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_6.png" width="1044" height="810"></a> </p> <p>编译该解决方案会生成一个xap文件</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_16.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_7.png" width="1044" height="810"></a> </p> <p>我们甚至可以直接通过它生成的一个测试页面进行测试</p> <p>&nbsp;<a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_18.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_8.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_20.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_9.png" width="1044" height="810"></a></p> <p>&nbsp;</p> <p>2。 部署这个xap包，我们首先可以定位到下面这个目录。其实里面已经有一些xap了，说明MOSS 2010是希望我们能将自己的xap也放进来</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_22.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_10.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_24.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_11.png" width="1044" height="810"></a> </p> <p>&nbsp;</p> <p>3.使用这个xap文件</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_28.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_13.png" width="1044" height="810"></a> </p> <p>这个地址格式大致是这样的 </p> <p>/_layouts/clientbin/mysilverlightapp.xap</p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_30.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_14.png" width="1044" height="810"></a> </p> <p><a class="thickbox" href="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_32.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/WindowsLiveWriter/MOSS2010VisualStudio20108Silverlight_9002/image_thumb_15.png" width="1044" height="810"></a> </p> <p>我们看到，它工作得很好，不是吗？</p> <p>&nbsp;</p> <p>4。我是比较推荐用这个内置的WebPart，但是如果你真的想自己开发一个WebPart，让他可以显示Silverlight应用的话，也很简单。我们可以打开那个测试页面来看一下就明白了</p> <p>&nbsp;</p><pre class="csharpcode"><span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">html</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="kwrd">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span> <span class="kwrd">&gt;</span>
<span class="rem">&lt;!-- saved from url=(0014)about:internet --&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;</span>MySilverlightApp<span class="kwrd">&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">style</span> <span class="attr">type</span><span class="kwrd">="text/css"</span><span class="kwrd">&gt;</span>
    html, body {
        height: 100%;
        overflow: auto;
    }
    body {
        padding: 0;
        margin: 0;
    }
    #silverlightControlHost {
        height: 100%;
        text-align:center;
    }
    <span class="kwrd">&lt;/</span><span class="html">style</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">function</span> onSilverlightError(sender, args) {
            <span class="kwrd">var</span> appSource = <span class="str">""</span>;
            <span class="kwrd">if</span> (sender != <span class="kwrd">null</span> &amp;&amp; sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            <span class="kwrd">var</span> errorType = args.ErrorType;
            <span class="kwrd">var</span> iErrorCode = args.ErrorCode;

            <span class="kwrd">if</span> (errorType == <span class="str">"ImageError"</span> || errorType == <span class="str">"MediaError"</span>) {
              <span class="kwrd">return</span>;
            }

            <span class="kwrd">var</span> errMsg = <span class="str">"Unhandled Error in Silverlight Application "</span> +  appSource + <span class="str">"\n"</span> ;

            errMsg += <span class="str">"Code: "</span>+ iErrorCode + <span class="str">"    \n"</span>;
            errMsg += <span class="str">"Category: "</span> + errorType + <span class="str">"       \n"</span>;
            errMsg += <span class="str">"Message: "</span> + args.ErrorMessage + <span class="str">"     \n"</span>;

            <span class="kwrd">if</span> (errorType == <span class="str">"ParserError"</span>) {
                errMsg += <span class="str">"File: "</span> + args.xamlFile + <span class="str">"     \n"</span>;
                errMsg += <span class="str">"Line: "</span> + args.lineNumber + <span class="str">"     \n"</span>;
                errMsg += <span class="str">"Position: "</span> + args.charPosition + <span class="str">"     \n"</span>;
            }
            <span class="kwrd">else</span> <span class="kwrd">if</span> (errorType == <span class="str">"RuntimeError"</span>) {           
                <span class="kwrd">if</span> (args.lineNumber != 0) {
                    errMsg += <span class="str">"Line: "</span> + args.lineNumber + <span class="str">"     \n"</span>;
                    errMsg += <span class="str">"Position: "</span> +  args.charPosition + <span class="str">"     \n"</span>;
                }
                errMsg += <span class="str">"MethodName: "</span> + args.methodName + <span class="str">"     \n"</span>;
            }

            <span class="kwrd">throw</span> <span class="kwrd">new</span> Error(errMsg);
        }
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">style</span><span class="kwrd">="height:100%"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="silverlightControlHost"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">object</span> <span class="attr">data</span><span class="kwrd">="data:application/x-silverlight-2,"</span> <span class="attr">type</span><span class="kwrd">="application/x-silverlight-2"</span> <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">height</span><span class="kwrd">="100%"</span><span class="kwrd">&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="source"</span> <span class="attr">value</span><span class="kwrd">="MySilverlightApp.xap"</span><span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="onError"</span> <span class="attr">value</span><span class="kwrd">="onSilverlightError"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="background"</span> <span class="attr">value</span><span class="kwrd">="white"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="minRuntimeVersion"</span> <span class="attr">value</span><span class="kwrd">="3.0.40818.0"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="autoUpgrade"</span> <span class="attr">value</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=3.0.40818.0"</span> <span class="attr">style</span><span class="kwrd">="text-decoration:none"</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">img</span> <span class="attr">src</span><span class="kwrd">="http://go.microsoft.com/fwlink/?LinkId=108181"</span> <span class="attr">alt</span><span class="kwrd">="Get Microsoft Silverlight"</span> <span class="attr">style</span><span class="kwrd">="border-style:none"</span><span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">object</span><span class="kwrd">&gt;&lt;</span><span class="html">iframe</span> <span class="attr">id</span><span class="kwrd">="_sl_historyFrame"</span> <span class="attr">style</span><span class="kwrd">="visibility:hidden;height:0px;width:0px;border:0px"</span><span class="kwrd">&gt;&lt;/</span><span class="html">iframe</span><span class="kwrd">&gt;&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>