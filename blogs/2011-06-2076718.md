# 【SSAS】Model-First Cube 设计的最佳实践 
> 原文发表于 2011-06-09, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/06/09/2076718.html 


<p>【备注】这是最近在一个讲座中的例子，整理出来给大家参考</p> <p>&nbsp;</p> <p>相关名词解释</p> <h1>SSAS: SQL Server Analysis Service。</h1> <p>这是微软SQL Server BI（商务智能）平台的一个核心组件，它可以基于UDM（统一维度模型）构建多维数据集和挖掘模型，支持OLAP（在线分析）和Data Mining(数据挖掘）</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810389103.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810394741.png" width="996" height="569" /></a></p> <h1>Cube: 多维数据集</h1> <p>这是SSAS项目设计的一个核心目的，创建多维数据集，以便支持OLAP分析。对于Cube而言，不再有行和列的概念，取而代之的是，维度和度量值（以及度量值组）</p> <p>&nbsp;</p> <h1>Model-First： 模型先行</h1> <p>这是SSAS从2005这个版本开始支持的一个新特性，也可以说是一个设计Cube的策略。Model-First指的是，在没有数据仓库的情况下，先设计模型（维度和度量值，以及他们之间的关系），然后可以根据这个模型，反向生成数据仓库。</p> <p>与该策略对应的另外一个策略是：Database-First（数据库先行），也就是说，在设计Cube之前，现有一个完整的数据仓库，该策略是指根据数据仓库的结构生成Cube。</p> <p>这两种策略各有优缺点。Database-first较为简单，能够很快生成Cube，快速验证和开始工作。而Model-First则更加适合于现实的工作中，因为很多时候，我们在做BI项目的时候，可能数据仓库是并不存在的。而且过早地关注数据仓库的物理设计，也不是一个非常好的方案。我们应该是先关注分析需求，并且将这些需求转换为我们的模型。</p> <p>&nbsp;</p> <p>这一篇文章用一个例子演示了如何使用Model-First策略设计Cube，并且反向工程生成数据仓库。</p> <h2>1.新建一个SSAS项目</h2> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810403204.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810413270.png" width="1026" height="732" /></a></p> <h2>2.启动新建Cube向导（在Cubes文件夹处，右键）</h2> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810428909.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810428975.png" width="644" height="586" /></a></p> <p>选择Creation Method，&#8220; Create an empty cube&#8221;。注意，这里也可以根据模板创建。这两种都属于是Model-First的方式</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810438452.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810439598.png" width="644" height="586" /></a></p> <p>由于目前没有数据库，所以下图中只能选择&#8220;None&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810441059.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810446076.png" width="644" height="586" /></a></p> <p>接下来给Cube命名，完成操作</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810449730.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810451715.png" width="644" height="586" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810452861.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810468782.png" width="1026" height="732" /></a></p> <h2>3.创建度量值</h2> <p>度量值指的是我们在Cube里面需要进行分析的一些基础指标。本例中，我们假设要分析一个销售业务，有两个度量值，销售额和数量。</p> <p>首先，创建一个度量值组（Measure Group)，它是用来组织度量值的</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810461847.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810463832.png" width="704" height="530" /></a></p> <p>将度量值组命名为Sales，并且继续创建两个度量值，SalesAmount和Quantity</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181046277.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810475850.png" width="516" height="367" /></a></p> <h2>4.创建并编辑维度</h2> <p>维度代表了我们在Cube中分析业务的角度。本例中，我们创建两个维度，时间维度和客户维度</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181047343.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810478947.png" width="704" height="530" /></a></p> <p>首先，创建时间维度（注意，时间维度是一个很特殊的维度，有专门的向导）</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/2011060918104893.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181048442.png" width="644" height="586" /></a></p> <p>定义时间段以及我们关注的时间信息。这个时间段将决定后续生成数据的范围。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810496048.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810492700.png" width="644" height="586" /></a></p> <p>我们甚至还可以定义多个日历</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810494718.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810508099.png" width="644" height="586" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810505341.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810509277.png" width="644" height="586" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810517392.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810527458.png" width="1026" height="732" /></a></p> <p>接下来，我们创建一个客户维度.与时间维度不同的是，客户维度一般需要我们自己定义。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810526967.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810532017.png" width="644" height="586" /></a></p> <p>【注意】这里也可以使用模板，但为了演示如何设计维度，我不用模板</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181053621.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181053687.png" width="644" height="586" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810546576.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810549674.png" width="644" height="586" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810541102.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810559216.png" width="644" height="586" /></a></p> <p>【注意】这里所谓的SCD，指的是渐变维度。该内容的讨论超出了本文的范围，有兴趣的朋友请参考联机丛书或者我其他的文章。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810552837.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810563460.png" width="1026" height="732" /></a></p> <p>通过上面的步骤，我们已经创建了一个维度，我们还需要为该维度添加一些属性（Attribute），例如本例中，我们添加&#8220;国家&#8221;，&#8220;地区&#8221;，&#8220;城市&#8221;，&#8220;性别&#8221;四个属性，以便利用它们进行分析。</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181057527.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810581465.png" width="1026" height="732" /></a></p> <p>【注意】这里应该还需要创建层次（Hierarchies)，以便提供性能。限于篇幅，本文不做这个步骤</p> <p>&nbsp;</p> <h2>5.将维度与Cube关联</h2> <p>维度建立好之后，需要将它与Cube进行关联。我们可以先回到Cube Design界面</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810585119.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091810598217.png" width="1026" height="732" /></a></p> <p>在左下角的方块区域，可以添加维度</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181059235.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181100268.png" width="704" height="530" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811006713.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811001414.png" width="440" height="468" /></a></p> <p>将两个维度都添加进来</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811006746.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811013399.png" width="516" height="367" /></a></p> <p>光这样做还是不够的，我们需要设置维度与度量值的关系。切换到Dimension Usage界面</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811016463.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811011796.png" width="704" height="510" /></a></p> <p>点击每个维度右侧那个小按钮，设置关系为&#8221;Regular&#8221; ，下图是时间维度</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811016812.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811019005.png" width="890" height="530" /></a></p> <p>下图是客户维度</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811015973.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811017402.png" width="890" height="530" /></a></p> <h2>6.生成数据库</h2> <p>到上面这样，我们就完成了Cube的设计(当然，我们只是做了最简单的一个范例），那么如何根据这个设计，生成我们需要的数据仓库呢</p> <p>首先，在SQL Server中创建一个空的数据库，例如</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811033663.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811042126.png" width="1040" height="784" /></a></p> <p>然后，回到BI Studio中来，在顶部菜单中选择&#8220;Database&#8221;==&gt;&#8221;Generate Relational Schema&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811046270.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811049335.png" width="704" height="530" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811042715.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811055290.png" width="644" height="586" /></a></p> <p>点击&#8220;New&#8230;&#8221;来创建一个新的数据源</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811051942.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811063927.png" width="644" height="586" /></a></p> <p>再次点击&#8220;New&#8230;&#8221;，指定我们的服务器和数据库</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811063993.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811069566.png" width="614" height="628" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811075521.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/2011060918110814.png" width="644" height="586" /></a></p> <p>点击&#8220;Next&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811085030.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811086143.png" width="644" height="586" /></a></p> <p>【注意】这里选择&#8220;Use the service account&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811082588.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811095653.png" width="644" height="586" /></a></p> <p>点击&#8220;Finish&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811096799.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811091815.png" width="644" height="586" /></a></p> <p>点击&#8220;Next&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811108260.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181110278.png" width="644" height="586" /></a></p> <p>点击&#8220;Next&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811102471.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811105851.png" width="644" height="586" /></a></p> <p>点击&#8220;Next&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811116997.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181111377.png" width="644" height="586" /></a></p> <p>点击&#8220;Finish&#8221;</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811127935.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811122984.png" width="686" height="613" /></a></p> <p>这样就生成好了我们需要的数据库结构。我们可以在SSMS中查看得到</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811143706.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811149312.png" width="1040" height="784" /></a></p> <p>更加特别的地方是，Time这个维度表里面还包含了数据</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811173513.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811187756.png" width="1040" height="784" /></a></p> <p>当然，Customers表和Sales表目前是没有数据的，那就需要我们通过设计SSIS，将数据从业务数据库中抽取过来。这个内容已经超出了本文的范围。</p> <p>&nbsp;</p> <h2>7. 部署项目</h2>                     <p>我们可以将这个设计好的SSAS项目部署起来看看效果如何</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/20110609181118613.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811192806.png" width="704" height="530" /></a></p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811191235.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811201335.png" width="1026" height="732" /></a></p> <p>部署成功之后，下图就可以看到我们熟悉的OLAP分析的界面了</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811219449.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201106/201106091811217563.png" width="1026" height="732" /></a></p>