# LINQ to SQL的快速入门例子 
> 原文发表于 2010-03-20, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/03/20/1690563.html 


<p>这也是今天课堂上的一个简单例子，演示了如何使用LINQ to SQL的技术，以及C# 3的一些新特性</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Collections.Generic;
<span class="kwrd">using</span> System.Linq;
<span class="kwrd">using</span> System.Text;

<span class="kwrd">namespace</span> LINQtoSQLSample
{
    <span class="kwrd">class</span> Program
    {
        <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)
        {
            <span class="rem">//利用LINQ TO SQL实现快捷高效的数据库访问</span>
            <span class="rem">//0.准备：创建DataContext对象</span>
            TraceModelDataContext context = <span class="kwrd">new</span> TraceModelDataContext();
            context.Log = Console.Out;

            <span class="rem">//var context2 = new TraceModelDataContext();</span>
            <span class="rem">//C# 3的新语法，var关键字是表示类型推断</span>


            <span class="rem">//var context3 = new TraceModelDataContext("server=(local);database=db;integrated security=true");</span>
            <span class="rem">//如果生产服务器上面的数据库连接是更改过的，则需要这样构造</span>

            <span class="rem">//1.查询全部</span>
            var query1 = context.Logs;
            DisplayLogs(<span class="str">"显示全部的"</span>,query1);

            <span class="rem">//2.查询带筛选</span>
            var query2 = context.Logs.Where(l =&gt; l.Id % 2 == 1&amp;&amp;l.Message.Contains(<span class="str">"Test"</span>));
            <span class="rem">//2.1 where是c# 3的一个新特性，叫扩展方法</span>
            <span class="rem">//2.2 l=&gt;1.Id...是C# 3的一个新特性，叫lambda表达式，实际上是一个委托delegate</span>
            DisplayLogs(<span class="str">"显示奇数的条目"</span>, query2);



            <span class="rem">//3.查询带排序</span>
            var query3 = context.Logs.OrderByDescending(l =&gt; l.Time);
            DisplayLogs(<span class="str">"查询带排序"</span>, query3);


            <span class="rem">//4.查询取中间一部分</span>
            var query4 = context.Logs.Skip(1).Take(2);
            DisplayLogs(<span class="str">"查询一部分"</span>, query4);

            <span class="rem">//var query5 = context.Logs.OrderByDescending(l =&gt; l.Id).Skip(1).Take(2);</span>
            <span class="rem">//var query6 = context.Logs.OrderByDescending(l =&gt; l.Id).ThenBy(l =&gt; l.Time);</span>


            <span class="rem">//5.插入一个新的条目</span>
            var log = <span class="kwrd">new</span> Logs()
            {
                Message = <span class="str">"测试消息"</span>,
                Time=DateTime.Now
            };
            <span class="rem">//5.1 {}也是c# 3的新特性，表示直接构造一个对象</span>
            context.Logs.InsertOnSubmit(log);
            context.SubmitChanges();
            DisplayLogs(<span class="str">"显示全部的"</span>, query1);

            <span class="rem">//6.更新一个条目</span>
            var firstLog = context.Logs.FirstOrDefault(l =&gt; l.Id == 1);
            <span class="kwrd">if</span> (firstLog != <span class="kwrd">null</span>)
            {
                firstLog.Message = <span class="str">"修改过之后的消息"</span>;
                context.SubmitChanges();
                DisplayLogs(<span class="str">"显示全部的"</span>, query1);
            }

            <span class="rem">//7.删除一个条目</span>
            var deleteEntry = from l <span class="kwrd">in</span> context.Logs
                              <span class="kwrd">where</span> l.Id == 1
                              select l;
            var found = deleteEntry.FirstOrDefault();
            <span class="kwrd">if</span> (found != <span class="kwrd">null</span>) {
                context.Logs.DeleteOnSubmit(found);
                context.SubmitChanges();
                DisplayLogs(<span class="str">"显示全部的"</span>, query1);
            }

            Console.Read();

        }

        <span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">void</span> DisplayLogs(<span class="kwrd">string</span> message,
            IEnumerable&lt;Logs&gt; query1)
        {

            Console.WriteLine(message);
            <span class="kwrd">foreach</span> (var item <span class="kwrd">in</span> query1)
            {
                Console.WriteLine(<span class="str">"Id:{0},Time:{1},Message:{2}"</span>,
                    item.Id,
                    item.Time,
                    item.Message);

            }
            Console.WriteLine();
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>