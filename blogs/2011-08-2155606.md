# 在Silverlight中为DataGrid控件定制标题行样式实现多行文本 
> 原文发表于 2011-08-27, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/08/27/2155606.html 


<p>项目中经常会用到DataGrid这个控件，而且有时候会需要在这个控件的标题行中显示多行文本。例如下面这样</p> <p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201108/201108271646092405.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201108/201108271646091292.png" width="471" height="110"></a></p> <p>如何实现这样的功能呢？答案是，通过定制HeaderStyle。我经常感慨说，在WPF和Silverlight开发里面，DataBinding和Style，以及Template的机制实在是很厉害，很好用。大家看看下面的例子 吧</p> <p>&nbsp;</p><pre class="csharpcode">        <span class="kwrd">&lt;</span><span class="html">sdk:DataGrid</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">sdk:DataGrid.ColumnHeaderStyle</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Style</span>
                    <span class="attr">TargetType</span><span class="kwrd">="sdk:DataGridColumnHeader"</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">Setter</span>
                        <span class="attr">Property</span><span class="kwrd">="ContentTemplate"</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">Setter.Value</span><span class="kwrd">&gt;</span>
                            <span class="kwrd">&lt;</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                                <span class="kwrd">&lt;</span><span class="html">ContentControl</span>
                                    <span class="attr">Content</span><span class="kwrd">="{Binding Converter={StaticResource hv}}"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ContentControl</span><span class="kwrd">&gt;</span>

                            <span class="kwrd">&lt;/</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;/</span><span class="html">Setter.Value</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">sdk:DataGrid.ColumnHeaderStyle</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">sdk:DataGrid.Columns</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">sdk:DataGridTextColumn</span>
                    <span class="attr">Header</span><span class="kwrd">="Item,项目"</span><span class="kwrd">&gt;&lt;/</span><span class="html">sdk:DataGridTextColumn</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">sdk:DataGridTextColumn</span>
                    <span class="attr">Header</span><span class="kwrd">="Department,部门"</span><span class="kwrd">&gt;&lt;/</span><span class="html">sdk:DataGridTextColumn</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">sdk:DataGridTextColumn</span>
                    <span class="attr">Header</span><span class="kwrd">="Company,公司"</span><span class="kwrd">&gt;&lt;/</span><span class="html">sdk:DataGridTextColumn</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">sdk:DataGrid.Columns</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">sdk:DataGrid</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p> 注意，我们这里定义了一个特殊的Style，设置了ColumnHeader的ContentTemplate。由于用户一般在设置列的标题的时候，是输入一个字符串。我们规定，如果要分多行显示的话，用逗号分开即可。</p>
<p>那么，如何将这个带有逗号的字符串转换为我们想要的标题呢？答案是，使用转换器。</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> System.Windows.Data;

<span class="kwrd">namespace</span> TechnologySample
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> HeaderConverter:IValueConverter
    {

        <span class="preproc">#region</span> IValueConverter Members

        <span class="kwrd">public</span> <span class="kwrd">object</span> Convert(<span class="kwrd">object</span> <span class="kwrd">value</span>, Type targetType, <span class="kwrd">object</span> parameter, System.Globalization.CultureInfo culture)
        {
            var text = <span class="kwrd">value</span>.ToString();
            var panel = <span class="kwrd">new</span> StackPanel();
            Array.ForEach(text.Split(<span class="str">','</span>), s =&gt; panel.Children.Add(<span class="kwrd">new</span> TextBlock() { Text = s }));
            <span class="kwrd">return</span> panel;
        }

        <span class="kwrd">public</span> <span class="kwrd">object</span> ConvertBack(<span class="kwrd">object</span> <span class="kwrd">value</span>, Type targetType, <span class="kwrd">object</span> parameter, System.Globalization.CultureInfo culture)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="preproc">#endregion</span>
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>这个代码很好懂，根据传入的一个字符串，我们动态构造了一个StackPanel，并且插入了多个TextBlock</p>
<p>&nbsp;</p>
<p>要在界面中使用这个转换器，只需要将它定义为资源即可</p><pre class="csharpcode">
    <span class="kwrd">&lt;</span><span class="html">UserControl.Resources</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ctrl:HeaderConverter</span>
            <span class="attr">x:Key</span><span class="kwrd">="hv"</span><span class="kwrd">&gt;&lt;/</span><span class="html">ctrl:HeaderConverter</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">UserControl.Resources</span><span class="kwrd">&gt;</span></pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style></p>