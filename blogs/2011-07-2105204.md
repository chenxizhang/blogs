# 如何在RIA Service中启用身份验证 
> 原文发表于 2011-07-13, 地址: http://www.cnblogs.com/chenxizhang/archive/2011/07/13/2105204.html 


<p>本文我将结合一个实例，一步一步地演示，然后在RIA Service中启用身份验证。包括在服务端的设计，和客户端的设计。</p> <p>本文实例源代码，可以通过下面地址下载</p> <p><a title="http://files.cnblogs.com/chenxizhang/SilverlightRIAAuthenticationSample.rar" href="http://files.cnblogs.com/chenxizhang/SilverlightRIAAuthenticationSample.rar">http://files.cnblogs.com/chenxizhang/SilverlightRIAAuthenticationSample.rar</a></p> <p>&nbsp;</p> <h1>1. 创建项目，并添加一个业务用的Domain Service</h1> <p>作为演示，我们这里写了一个简单的方法</p><pre class="csharpcode"> </pre><pre class="csharpcode"><span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample.Web
{
    <span class="kwrd">using</span> System;
    <span class="kwrd">using</span> System.Collections.Generic;
    <span class="kwrd">using</span> System.ComponentModel;
    <span class="kwrd">using</span> System.ComponentModel.DataAnnotations;
    <span class="kwrd">using</span> System.Linq;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Hosting;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Server;
    <span class="kwrd">using</span> System.Runtime.Serialization;

    <span class="rem">// TODO: Create methods containing your application logic.</span>
    [EnableClientAccess()]
    <span class="kwrd">public</span> <span class="kwrd">class</span> HomeDomainService : DomainService
    {
        [Query]
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// 这个方法返回一些客户名称</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="kwrd">public</span> IQueryable&lt;Customer&gt; GetCustomers()
        {
            <span class="kwrd">return</span> <span class="kwrd">new</span>[]{
                <span class="kwrd">new</span> Customer(){ID=1,Name=<span class="str">"Microsoft"</span>},
                <span class="kwrd">new</span> Customer(){ID=2,Name=<span class="str">"Google"</span>},
                <span class="kwrd">new</span> Customer(){ID=3,Name=<span class="str">"Apple"</span>},
                <span class="kwrd">new</span> Customer(){ID=4,Name=<span class="str">"Facebook"</span>},
                <span class="kwrd">new</span> Customer(){ID=5,Name=<span class="str">"Yahoo"</span>},
                <span class="kwrd">new</span> Customer(){ID=16,Name=<span class="str">"AOL"</span>}
            }.AsQueryable();
        }
    }

    [DataContract]
    <span class="kwrd">public</span> <span class="kwrd">class</span> Customer
    {
        [Key][DataMember]
        <span class="kwrd">public</span> <span class="kwrd">int</span> ID { get; set; }
        [DataMember]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Name { get; set; }
    }


}


</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>





<p>写好之后，分别编译网站项目和Silverlight项目。在Silverlight中应该可以看到一个自动生成的类型</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303175896.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/20110713130319432.png" width="1028" height="729"></a></p>
<h1>2. 编写客户端代码</h1>
<p>我简单地做了一个界面，用来显示由服务器返回的客户列表</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303192351.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/20110713130319366.png" width="1028" height="729"></a></p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">UserControl</span>
    <span class="attr">x:Class</span><span class="kwrd">="SilverlightRIAAuthenticationSample.MainPage"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="attr">xmlns:d</span><span class="kwrd">="http://schemas.microsoft.com/expression/blend/2008"</span>
    <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="attr">mc:Ignorable</span><span class="kwrd">="d"</span>
    <span class="attr">d:DesignHeight</span><span class="kwrd">="300"</span>
    <span class="attr">d:DesignWidth</span><span class="kwrd">="400"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">Grid</span>
        <span class="attr">x:Name</span><span class="kwrd">="LayoutRoot"</span>
        <span class="attr">Background</span><span class="kwrd">="White"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">StackPanel</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">TextBlock</span>
                <span class="attr">Text</span><span class="kwrd">="Customers List"</span>
                <span class="attr">FontSize</span><span class="kwrd">="40"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>

            <span class="kwrd">&lt;</span><span class="html">ListBox</span>
                <span class="attr">ItemsSource</span><span class="kwrd">="{Binding}"</span>
                <span class="attr">Padding</span><span class="kwrd">="10"</span> <span class="attr">Margin</span><span class="kwrd">="10"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">ListBox.ItemTemplate</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                        <span class="kwrd">&lt;</span><span class="html">TextBlock</span>
                            <span class="attr">Text</span><span class="kwrd">="{Binding Name}"</span>
                            <span class="attr">FontSize</span><span class="kwrd">="16"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;/</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">ListBox.ItemTemplate</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">ListBox</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">StackPanel</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">UserControl</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>同时，编写一些简单的后台代码（直接写在xaml.cs中）</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> SilverlightRIAAuthenticationSample.Web;

<span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainPage_Loaded);
        }

        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var ctx = <span class="kwrd">new</span> HomeDomainContext();
            var op=ctx.Load&lt;Customer&gt;(ctx.GetCustomersQuery());
            <span class="kwrd">this</span>.DataContext = op.Entities; 
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>运行起来，我们可以看到如下的一个效果</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303211040.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303218498.png" width="1003" height="656"></a></p>
<p>到这里为止，我们就已经实现了一个简单的Silverlight+RIA Service的场景。这不是本文的重点，我们下面要实现的是，在这个设计的基础上添加身份验证的功能。</p>
<p>例如你可以假设一下：假如这个GetCustomers方法，并不是给所有用户都可以调用的，而是需要经过身份验证的用户才可以调用的</p>
<p>&nbsp;</p>
<h1>3. 修改Web.config</h1>
<p>我们需要修改宿主网站的web.config,设置身份验证提供程序，可以选择Forms或者Windows，我们这里选择Forms，就是所谓的表单验证，客户端需要提供一个用户名和密码来进行验证</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303228465.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303232445.png" width="1028" height="729"></a></p>
<p>&nbsp;</p>
<h1>4. 添加一个AuthenticationDomainService</h1>
<p>在网站项目中</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303244887.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303249870.png" width="959" height="664"></a></p>
<p>这个Domain Service不需要做任何修改。但也可以为User类型添加一些特殊的属性（称为Profile Property）,这里先不展开了</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303246249.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303242313.png" width="1028" height="729"></a></p>
<p>但是，这里需要添加一个身份验证的提供程序。我写了一个最简单的MemberShipProvider</p>
<p>请注意，SimpleMembershipProvider，只实现一个方法：ValidateUser（请注意代码的底部，红色部分）</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.ServiceModel.DomainServices.Hosting;
<span class="kwrd">using</span> System.ServiceModel.DomainServices.Server.ApplicationServices;

<span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample.Web
{
    [EnableClientAccess]
    <span class="kwrd">public</span> <span class="kwrd">class</span> AuthenticationDomainService : AuthenticationBase&lt;User&gt;
    {
        <span class="rem">// To enable Forms/Windows Authentication for the Web Application, edit the appropriate section of web.config file.</span>
    }

    <span class="kwrd">public</span> <span class="kwrd">class</span> User : UserBase
    {
        <span class="rem">// NOTE: Profile properties can be added here </span>
        <span class="rem">// To enable profiles, edit the appropriate section of web.config file.</span>

        <span class="rem">// public string MyProfileProperty { get; set; }</span>
    }

    <span class="kwrd">public</span> <span class="kwrd">class</span> SimpleMembershipProvider : System.Web.Security.MembershipProvider
    {

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">string</span> ApplicationName
        {
            get
            {
                <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
            }
            set
            {
                <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
            }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> ChangePassword(<span class="kwrd">string</span> username, <span class="kwrd">string</span> oldPassword, <span class="kwrd">string</span> newPassword)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> ChangePasswordQuestionAndAnswer(<span class="kwrd">string</span> username, <span class="kwrd">string</span> password, <span class="kwrd">string</span> newPasswordQuestion, <span class="kwrd">string</span> newPasswordAnswer)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipUser CreateUser(<span class="kwrd">string</span> username, <span class="kwrd">string</span> password, <span class="kwrd">string</span> email, <span class="kwrd">string</span> passwordQuestion, <span class="kwrd">string</span> passwordAnswer, <span class="kwrd">bool</span> isApproved, <span class="kwrd">object</span> providerUserKey, <span class="kwrd">out</span> System.Web.Security.MembershipCreateStatus status)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> DeleteUser(<span class="kwrd">string</span> username, <span class="kwrd">bool</span> deleteAllRelatedData)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> EnablePasswordReset
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> EnablePasswordRetrieval
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipUserCollection FindUsersByEmail(<span class="kwrd">string</span> emailToMatch, <span class="kwrd">int</span> pageIndex, <span class="kwrd">int</span> pageSize, <span class="kwrd">out</span> <span class="kwrd">int</span> totalRecords)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipUserCollection FindUsersByName(<span class="kwrd">string</span> usernameToMatch, <span class="kwrd">int</span> pageIndex, <span class="kwrd">int</span> pageSize, <span class="kwrd">out</span> <span class="kwrd">int</span> totalRecords)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipUserCollection GetAllUsers(<span class="kwrd">int</span> pageIndex, <span class="kwrd">int</span> pageSize, <span class="kwrd">out</span> <span class="kwrd">int</span> totalRecords)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">int</span> GetNumberOfUsersOnline()
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">string</span> GetPassword(<span class="kwrd">string</span> username, <span class="kwrd">string</span> answer)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipUser GetUser(<span class="kwrd">string</span> username, <span class="kwrd">bool</span> userIsOnline)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipUser GetUser(<span class="kwrd">object</span> providerUserKey, <span class="kwrd">bool</span> userIsOnline)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">string</span> GetUserNameByEmail(<span class="kwrd">string</span> email)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">int</span> MaxInvalidPasswordAttempts
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">int</span> MinRequiredNonAlphanumericCharacters
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">int</span> MinRequiredPasswordLength
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">int</span> PasswordAttemptWindow
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> System.Web.Security.MembershipPasswordFormat PasswordFormat
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">string</span> PasswordStrengthRegularExpression
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> RequiresQuestionAndAnswer
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> RequiresUniqueEmail
        {
            get { <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException(); }
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">string</span> ResetPassword(<span class="kwrd">string</span> username, <span class="kwrd">string</span> answer)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> UnlockUser(<span class="kwrd">string</span> userName)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">void</span> UpdateUser(System.Web.Security.MembershipUser user)
        {
            <span class="kwrd">throw</span> <span class="kwrd">new</span> NotImplementedException();
        }

<font color="#ff0000"><strong>        <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">bool</span> ValidateUser(<span class="kwrd">string</span> username, <span class="kwrd">string</span> password)
        {
            <span class="kwrd">return</span> username == <span class="str">"chenxizhang"</span> &amp;&amp; password == <span class="str">"password"</span>;
        }</strong></font>
    }
}</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>然后，我们还需要修改web.config，指定这个MembershipProvider,请注意下面的粗体部分</p><pre class="csharpcode"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span>?<span class="kwrd">&gt;</span>

<span class="rem">&lt;!--</span>
<span class="rem">  For more information on how to configure your ASP.NET application, please visit</span>
<span class="rem">  http://go.microsoft.com/fwlink/?LinkId=169433</span>
<span class="rem">  --&gt;</span>

<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">modules</span> <span class="attr">runAllManagedModulesForAllRequests</span><span class="kwrd">="true"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="DomainServiceModule"</span> <span class="attr">preCondition</span><span class="kwrd">="managedHandler"</span>
          <span class="attr">type</span><span class="kwrd">="System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">modules</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">validation</span> <span class="attr">validateIntegratedModeConfiguration</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">httpModules</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="DomainServiceModule"</span> <span class="attr">type</span><span class="kwrd">="System.ServiceModel.DomainServices.Hosting.DomainServiceHttpModule, System.ServiceModel.DomainServices.Hosting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">httpModules</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">compilation</span> <span class="attr">debug</span><span class="kwrd">="true"</span> <span class="attr">targetFramework</span><span class="kwrd">="4.0"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">authentication</span> <span class="attr">mode</span><span class="kwrd">="Forms"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">authentication</span><span class="kwrd">&gt;</span>

<strong>    <span class="kwrd">&lt;</span><span class="html">membership</span> <span class="attr">defaultProvider</span><span class="kwrd">="simple"</span><span class="kwrd">&gt;</span>
      <span class="kwrd">&lt;</span><span class="html">providers</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">clear</span><span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="simple"</span> <span class="attr">type</span><span class="kwrd">="SilverlightRIAAuthenticationSample.Web.SimpleMembershipProvider"</span><span class="kwrd">/&gt;</span>
      <span class="kwrd">&lt;/</span><span class="html">providers</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">membership</span><span class="kwrd">&gt;</span></strong>
  <span class="kwrd">&lt;/</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
  <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">serviceHostingEnvironment</span> <span class="attr">aspNetCompatibilityEnabled</span><span class="kwrd">="true"</span>
        <span class="attr">multipleSiteBindingsEnabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
  <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<h1>6. 如何在服务器端启用身份验证</h1>
<p>请注意下面代码的修改，在GetCustomers方法上面，我们添加一个RequiresAuthetication的Attribute。</p><pre class="csharpcode"><span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample.Web
{
    <span class="kwrd">using</span> System.ComponentModel.DataAnnotations;
    <span class="kwrd">using</span> System.Linq;
    <span class="kwrd">using</span> System.Runtime.Serialization;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Hosting;
    <span class="kwrd">using</span> System.ServiceModel.DomainServices.Server;

    <span class="rem">// TODO: Create methods containing your application logic.</span>
    [EnableClientAccess()]
    <span class="kwrd">public</span> <span class="kwrd">class</span> HomeDomainService : DomainService
    {
        [Query][<strong><font color="#ff0000">RequiresAuthentication</font></strong>]
        <span class="rem">/// &lt;summary&gt;</span>
        <span class="rem">/// 这个方法返回一些客户名称</span>
        <span class="rem">/// &lt;/summary&gt;</span>
        <span class="rem">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="kwrd">public</span> IQueryable&lt;Customer&gt; GetCustomers()
        {
            <span class="kwrd">return</span> <span class="kwrd">new</span>[]{
                <span class="kwrd">new</span> Customer(){ID=1,Name=<span class="str">"Microsoft"</span>},
                <span class="kwrd">new</span> Customer(){ID=2,Name=<span class="str">"Google"</span>},
                <span class="kwrd">new</span> Customer(){ID=3,Name=<span class="str">"Apple"</span>},
                <span class="kwrd">new</span> Customer(){ID=4,Name=<span class="str">"Facebook"</span>},
                <span class="kwrd">new</span> Customer(){ID=5,Name=<span class="str">"Yahoo"</span>},
                <span class="kwrd">new</span> Customer(){ID=16,Name=<span class="str">"AOL"</span>}
            }.AsQueryable();
        }
    }

    [DataContract]
    <span class="kwrd">public</span> <span class="kwrd">class</span> Customer
    {
        [Key][DataMember]
        <span class="kwrd">public</span> <span class="kwrd">int</span> ID { get; set; }
        [DataMember]
        <span class="kwrd">public</span> <span class="kwrd">string</span> Name { get; set; }
    }


}

</pre>
<p>到这里为止，服务器端的设计就完成了，我们可以将两个项目都重新生成一下</p>
<p>然后，按下F5,重新运行一下Silverlight程序，不出意外的话，我们会看到下面一个错误</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303252280.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303255311.png" width="412" height="447"></a></p>
<p>如果想要看到错误消息，可以对代码稍作修改</p><pre class="csharpcode"><span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;
<span class="kwrd">using</span> SilverlightRIAAuthenticationSample.Web;

<span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MainPage : UserControl
    {
        <span class="kwrd">public</span> MainPage()
        {
            InitializeComponent();
            Loaded += <span class="kwrd">new</span> RoutedEventHandler(MainPage_Loaded);
        }

        <span class="kwrd">void</span> MainPage_Loaded(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            var ctx = <span class="kwrd">new</span> HomeDomainContext();
            var op = ctx.Load&lt;Customer&gt;(ctx.GetCustomersQuery(), (result) =&gt; {
                <span class="kwrd">if</span>(result.HasError)
                {
                    MessageBox.Show(result.Error.Message);
                    result.MarkErrorAsHandled();
                }
            }, <span class="kwrd">true</span>);
            <span class="kwrd">this</span>.DataContext = op.Entities;
        }
    }
}
</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
再次运行的话，就可以看到如下的消息提供</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/20110713130325610.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303266641.png" width="909" height="561"></a></p>
<p>事情很清楚了，因为服务端要求要做身份验证，而客户端没有提供有关的用户信息，所以就报告了如上的错误</p>
<p>&nbsp;</p>
<h1>7. 如何在客户端中使用身份验证</h1>
<p>有很多个做法可以实现客户端的身份验证，通常是用一个窗口让用户输入用户名和密码。</p>
<p>为了简单起见，我先用最简单的方法来实现。我们可以修改App.xaml.cs文件</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.ServiceModel.DomainServices.Client.ApplicationServices;
<span class="kwrd">using</span> System.Windows;

<span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> App : Application
    {

        <span class="kwrd">public</span> App()
        {
            <span class="kwrd">this</span>.Startup += <span class="kwrd">this</span>.Application_Startup;
            <span class="kwrd">this</span>.Exit += <span class="kwrd">this</span>.Application_Exit;
            <span class="kwrd">this</span>.UnhandledException += <span class="kwrd">this</span>.Application_UnhandledException;

            InitializeComponent();

<strong>            <span class="rem">//创建一个上下文，这是在RIA Service中的一个对象</span>
<font color="#ff0000">            var webcontext = <span class="kwrd">new</span> WebContext();
            webcontext.Authentication = <span class="kwrd">new</span> FormsAuthentication();
            <span class="kwrd">this</span>.ApplicationLifetimeObjects.Add(webcontext);</font></strong>


        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_Startup(<span class="kwrd">object</span> sender, StartupEventArgs e)
        {

<strong><font color="#ff0000">            <span class="rem">//直接使用硬编码的方式进行登录，注意这里是异步的</span>
            var param = <span class="kwrd">new</span> LoginParameters(<span class="str">"chenxizhang"</span>, <span class="str">"password"</span>); 
            WebContext.Current.Authentication.Login(param, (op) =&gt;
            {
                <span class="kwrd">if</span>(op.User != <span class="kwrd">null</span>
                    &amp;&amp; op.User.Identity.IsAuthenticated)
                    <span class="kwrd">this</span>.RootVisual = <span class="kwrd">new</span> MainPage();
                <span class="kwrd">else</span>
                {
                    MessageBox.Show(<span class="str">"Login fail, please try again. "</span>);
                }
            }, <span class="kwrd">null</span>);</font></strong>
        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_Exit(<span class="kwrd">object</span> sender, EventArgs e)
        {

        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_UnhandledException(<span class="kwrd">object</span> sender, ApplicationUnhandledExceptionEventArgs e)
        {
            <span class="rem">// If the app is running outside of the debugger then report the exception using</span>
            <span class="rem">// the browser's exception mechanism. On IE this will display it a yellow alert </span>
            <span class="rem">// icon in the status bar and Firefox will display a script error.</span>
            <span class="kwrd">if</span>(!System.Diagnostics.Debugger.IsAttached)
            {

                <span class="rem">// NOTE: This will allow the application to continue running after an exception has been thrown</span>
                <span class="rem">// but not handled. </span>
                <span class="rem">// For production applications this error handling should be replaced with something that will </span>
                <span class="rem">// report the error to the website and stop the application.</span>
                e.Handled = <span class="kwrd">true</span>;
                Deployment.Current.Dispatcher.BeginInvoke(<span class="kwrd">delegate</span> { ReportErrorToDOM(e); });
            }
        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> ReportErrorToDOM(ApplicationUnhandledExceptionEventArgs e)
        {
            <span class="kwrd">try</span>
            {
                <span class="kwrd">string</span> errorMsg = e.ExceptionObject.Message + e.ExceptionObject.StackTrace;
                errorMsg = errorMsg.Replace(<span class="str">'"'</span>, <span class="str">'\''</span>).Replace(<span class="str">"\r\n"</span>, <span class="str">@"\n"</span>);

                System.Windows.Browser.HtmlPage.Window.Eval(<span class="str">"throw new Error(\"Unhandled Error in Silverlight Application "</span> + errorMsg + <span class="str">"\");"</span>);
            }
            <span class="kwrd">catch</span>(Exception)
            {
            }
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>然后，再运行程序，我们就可以看到查询结果了</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303268559.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303262114.png" width="1003" height="368"></a></p>









<p>这就表示，我们已经登录成功了，所有后续代码就生效了。</p>
<p>除了上面那种用代码方式在App类型的构造器实例化身份验证方式之外，还可以通过下面这样修改xaml来实现</p>
<p>【备注】关于ApplicationLifetimeObjects，这是WPF和Silverlight的一个特殊功能，可以将一个对象在整个应用程序生命周期里面都有效，相当于是全局的对象。有兴趣可以参考<a href="http://msdn.microsoft.com/zh-cn/library/system.windows.application.applicationlifetimeobjects(v=vs.95).aspx">这里</a>的说明</p>
<p>&nbsp;</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">Application</span> <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span> 
             <span class="attr">x:Class</span><span class="kwrd">="SilverlightRIAAuthenticationSample.App"</span>
             <span class="attr">xmlns:local</span><span class="kwrd">="clr-namespace:SilverlightRIAAuthenticationSample"</span>
             <span class="attr">xmlns:appsvc</span><span class="kwrd">="clr-namespace:System.ServiceModel.DomainServices.Client.ApplicationServices;assembly=System.ServiceModel.DomainServices.Client.Web"</span>
             <span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Application.Resources</span><span class="kwrd">&gt;</span>
        
    <span class="kwrd">&lt;/</span><span class="html">Application.Resources</span><span class="kwrd">&gt;</span>
<strong>    <span class="kwrd">&lt;</span><span class="html">Application.ApplicationLifetimeObjects</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">local:WebContext</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">local:WebContext.Authentication</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">appsvc:FormsAuthentication</span><span class="kwrd">&gt;&lt;/</span><span class="html">appsvc:FormsAuthentication</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">local:WebContext.Authentication</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">local:WebContext</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Application.ApplicationLifetimeObjects</span><span class="kwrd">&gt;</span></strong>
<span class="kwrd">&lt;/</span><span class="html">Application</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<h1>8. 实现用户登录窗口</h1>
<p>接下来，我们实现一个简单的用户登录窗口吧。假设我们希望任何用户在使用这个程序之前，必须首先要登录</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/20110713130327445.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303272605.png" width="1028" height="729"></a></p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">controls:ChildWindow</span>
    <span class="attr">x:Class</span><span class="kwrd">="SilverlightRIAAuthenticationSample.LoginWindow"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span>
    <span class="attr">xmlns:controls</span><span class="kwrd">="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls"</span>
    <span class="attr">Width</span><span class="kwrd">="445"</span>
    <span class="attr">Height</span><span class="kwrd">="227"</span>
    <span class="attr">Title</span><span class="kwrd">="LoginWindow"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Grid</span>
        <span class="attr">x:Name</span><span class="kwrd">="LayoutRoot"</span>
        <span class="attr">Margin</span><span class="kwrd">="2"</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">Grid.Resources</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Style</span>
                <span class="attr">TargetType</span><span class="kwrd">="TextBlock"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="FontSize"</span>
                    <span class="attr">Value</span><span class="kwrd">="14"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="HorizontalAlignment"</span>
                    <span class="attr">Value</span><span class="kwrd">="Right"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="Margin"</span>
                    <span class="attr">Value</span><span class="kwrd">="5"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="VerticalAlignment"</span>
                    <span class="attr">Value</span><span class="kwrd">="Center"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>

            <span class="kwrd">&lt;</span><span class="html">Style</span>
                <span class="attr">TargetType</span><span class="kwrd">="TextBox"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="VerticalAlignment"</span>
                    <span class="attr">Value</span><span class="kwrd">="Center"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="Margin"</span>
                    <span class="attr">Value</span><span class="kwrd">="5"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="Height"</span>
                    <span class="attr">Value</span><span class="kwrd">="23"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Style</span>
                <span class="attr">TargetType</span><span class="kwrd">="CheckBox"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">Setter</span>
                    <span class="attr">Property</span><span class="kwrd">="Margin"</span>
                    <span class="attr">Value</span><span class="kwrd">="5"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.Resources</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span>
                <span class="attr">Width</span><span class="kwrd">="150*"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span>
                <span class="attr">Width</span><span class="kwrd">="273*"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Grid.RowDefinitions</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span>
                <span class="attr">Height</span><span class="kwrd">="40"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span>
                <span class="attr">Height</span><span class="kwrd">="40"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span>
                <span class="attr">Height</span><span class="kwrd">="*"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">RowDefinition</span>
                <span class="attr">Height</span><span class="kwrd">="Auto"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">Grid.RowDefinitions</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">TextBlock</span>
            <span class="attr">Text</span><span class="kwrd">="UserName"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">TextBlock</span>
            <span class="attr">Text</span><span class="kwrd">="Password"</span>
            <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="1"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">TextBox</span>
            <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span>
            <span class="attr">x:Name</span><span class="kwrd">="txtUserName"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBox</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">TextBox</span>
            <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="1"</span>
            <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span>
            <span class="attr">x:Name</span><span class="kwrd">="txtPassword"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBox</span><span class="kwrd">&gt;</span>

        <span class="kwrd">&lt;</span><span class="html">CheckBox</span>
            <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="2"</span>
            <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span>
            <span class="attr">Content</span><span class="kwrd">="Remember me?"</span>
            <span class="attr">x:Name</span><span class="kwrd">="chkRemember"</span><span class="kwrd">&gt;&lt;/</span><span class="html">CheckBox</span><span class="kwrd">&gt;</span>


        <span class="kwrd">&lt;</span><span class="html">Button</span>
            <span class="attr">x:Name</span><span class="kwrd">="CancelButton"</span>
            <span class="attr">Content</span><span class="kwrd">="Cancel"</span>
            <span class="attr">Click</span><span class="kwrd">="CancelButton_Click"</span>
            <span class="attr">Width</span><span class="kwrd">="75"</span>
            <span class="attr">Height</span><span class="kwrd">="23"</span>
            <span class="attr">HorizontalAlignment</span><span class="kwrd">="Right"</span>
            <span class="attr">Margin</span><span class="kwrd">="0,12,0,0"</span>
            <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="3"</span>
            <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Button</span>
            <span class="attr">x:Name</span><span class="kwrd">="OKButton"</span>
            <span class="attr">Content</span><span class="kwrd">="OK"</span>
            <span class="attr">Click</span><span class="kwrd">="OKButton_Click"</span>
            <span class="attr">Width</span><span class="kwrd">="75"</span>
            <span class="attr">Height</span><span class="kwrd">="23"</span>
            <span class="attr">HorizontalAlignment</span><span class="kwrd">="Right"</span>
            <span class="attr">Margin</span><span class="kwrd">="0,12,79,0"</span>
            <span class="attr">Grid</span>.<span class="attr">Row</span><span class="kwrd">="3"</span>
            <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">controls:ChildWindow</span><span class="kwrd">&gt;</span></pre>
<p>后台代码如下</p><pre class="csharpcode"><span class="kwrd">using</span> System.ServiceModel.DomainServices.Client.ApplicationServices;
<span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;

<span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> LoginWindow : ChildWindow
    {
        <span class="kwrd">public</span> LoginWindow()
        {
            InitializeComponent();
        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> OKButton_Click(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {

            <span class="rem">//直接使用硬编码的方式进行登录，注意这里是异步的</span>
<strong>            var param = <span class="kwrd">new</span> LoginParameters(txtUserName.Text,txtPassword.Text);
            WebContext.Current.Authentication.Login(param, (op) =&gt;
            {
                <span class="kwrd">if</span>(op.User != <span class="kwrd">null</span>
                    &amp;&amp; op.User.Identity.IsAuthenticated)
                {
                    (App.Current.RootVisual <span class="kwrd">as</span> ContentControl).Content = <span class="kwrd">new</span> MainPage();
                    <span class="kwrd">this</span>.DialogResult = <span class="kwrd">true</span>;
                }
                <span class="kwrd">else</span>
                {
                    MessageBox.Show(<span class="str">"Login fail, please try again. "</span>);
                    <span class="kwrd">this</span>.DialogResult = <span class="kwrd">null</span>;
                }
            }, <span class="kwrd">null</span>);</strong>


        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> CancelButton_Click(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            <span class="kwrd">this</span>.DialogResult = <span class="kwrd">false</span>;
        }
    }
}

</pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>接下来，我们需要对App.xaml.cs做点修改</p><pre class="csharpcode"><span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.ServiceModel.DomainServices.Client.ApplicationServices;
<span class="kwrd">using</span> System.Windows;
<span class="kwrd">using</span> System.Windows.Controls;

<span class="kwrd">namespace</span> SilverlightRIAAuthenticationSample
{
    <span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> App : Application
    {

        <span class="kwrd">public</span> App()
        {
            <span class="kwrd">this</span>.Startup += <span class="kwrd">this</span>.Application_Startup;
            <span class="kwrd">this</span>.Exit += <span class="kwrd">this</span>.Application_Exit;
            <span class="kwrd">this</span>.UnhandledException += <span class="kwrd">this</span>.Application_UnhandledException;

            InitializeComponent();

        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_Startup(<span class="kwrd">object</span> sender, StartupEventArgs e)
        {

            <span class="rem">//使用用户登录对话框进行登录</span>
<strong>            var content = <span class="kwrd">new</span> ContentControl()
            {
                VerticalContentAlignment = System.Windows.VerticalAlignment.Stretch,
                HorizontalContentAlignment = System.Windows.HorizontalAlignment.Stretch
            };

            content.Content = <span class="kwrd">new</span> TextBlock()
            {
                Text = <span class="str">"Please login first"</span>,
                FontSize = 50
            };
            <span class="kwrd">this</span>.RootVisual = content;

            var form = <span class="kwrd">new</span> LoginWindow();
            form.Show();</strong>


        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_Exit(<span class="kwrd">object</span> sender, EventArgs e)
        {

        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_UnhandledException(<span class="kwrd">object</span> sender, ApplicationUnhandledExceptionEventArgs e)
        {
            <span class="rem">// If the app is running outside of the debugger then report the exception using</span>
            <span class="rem">// the browser's exception mechanism. On IE this will display it a yellow alert </span>
            <span class="rem">// icon in the status bar and Firefox will display a script error.</span>
            <span class="kwrd">if</span>(!System.Diagnostics.Debugger.IsAttached)
            {

                <span class="rem">// NOTE: This will allow the application to continue running after an exception has been thrown</span>
                <span class="rem">// but not handled. </span>
                <span class="rem">// For production applications this error handling should be replaced with something that will </span>
                <span class="rem">// report the error to the website and stop the application.</span>
                e.Handled = <span class="kwrd">true</span>;
                Deployment.Current.Dispatcher.BeginInvoke(<span class="kwrd">delegate</span> { ReportErrorToDOM(e); });
            }
        }

        <span class="kwrd">private</span> <span class="kwrd">void</span> ReportErrorToDOM(ApplicationUnhandledExceptionEventArgs e)
        {
            <span class="kwrd">try</span>
            {
                <span class="kwrd">string</span> errorMsg = e.ExceptionObject.Message + e.ExceptionObject.StackTrace;
                errorMsg = errorMsg.Replace(<span class="str">'"'</span>, <span class="str">'\''</span>).Replace(<span class="str">"\r\n"</span>, <span class="str">@"\n"</span>);

                System.Windows.Browser.HtmlPage.Window.Eval(<span class="str">"throw new Error(\"Unhandled Error in Silverlight Application "</span> + errorMsg + <span class="str">"\");"</span>);
            }
            <span class="kwrd">catch</span>(Exception)
            {
            }
        }
    }
}
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>这两段代码的意思是，先启动LoginWindow，然后根据用户输入的信息进行登录，成功的话，就显示主窗口，调试起来看的效果如下</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303274000.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303275396.png" width="1003" height="656"></a></p>
<p>输入用户名和密码，例如</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303271459.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303287489.png" width="1003" height="656"></a></p>
<p>然后点击“Ok”，因为我提供的用户是合法的，所以会显示MainPage</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/20110713130328247.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303292689.png" width="1003" height="656"></a></p>
<p>如果我提供的用户信息不合法呢？</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303296244.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303303670.png" width="1003" height="656"></a></p>
<p>一点都不意外，我们将收到一个提示</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303302557.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303312209.png" width="213" height="158"></a></p>



<p>&nbsp;</p>
<h1>9.实现用户自动登录</h1>
<p>假设我们希望这个程序能够实现用户的自动登录，也就是说不要每次都输入用户名和密码，该怎么办呢？</p><pre class="csharpcode">        <span class="kwrd">private</span> <span class="kwrd">void</span> Application_Startup(<span class="kwrd">object</span> sender, StartupEventArgs e)
        {
<strong>            <span class="rem">///用LoadUser方法可以自动将保存在本地的用户凭据去做身份验证</span>
            WebContext.Current.Authentication.LoadUser((result) =&gt; {

                <span class="kwrd">if</span>(result.User != <span class="kwrd">null</span> &amp;&amp; result.User.Identity.IsAuthenticated)
                {<span class="rem">//如果成功的话，就直接显示MainPage</span>
                    <span class="kwrd">this</span>.RootVisual = <span class="kwrd">new</span> MainPage();
                }
                <span class="kwrd">else</span>
                {
                    <span class="rem">//使用用户登录对话框进行登录</span>
                    var content = <span class="kwrd">new</span> ContentControl()
                    {
                        VerticalContentAlignment = System.Windows.VerticalAlignment.Stretch,
                        HorizontalContentAlignment = System.Windows.HorizontalAlignment.Stretch
                    };

                    content.Content = <span class="kwrd">new</span> TextBlock()
                    {
                        Text = <span class="str">"Please login first"</span>,
                        FontSize = 50
                    };
                    <span class="kwrd">this</span>.RootVisual = content;

                    var form = <span class="kwrd">new</span> LoginWindow();
                    form.Show();

                }
            }, <span class="kwrd">null</span>);</strong>
        }
</pre><pre class="csharpcode">&nbsp;</pre>
<h1></h1>
<p>同时，我们还需要修改LoginWindow，让他可以保存用户凭据（你是否记得我们在那个窗口上有一个复选框呢？），请注意下面红色的部分</p><pre class="csharpcode">       <span class="kwrd">private</span> <span class="kwrd">void</span> OKButton_Click(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {

            <span class="rem">//直接使用硬编码的方式进行登录，注意这里是异步的</span>
<strong><font color="#ff0000">            var param = <span class="kwrd">new</span> LoginParameters(
                txtUserName.Text, 
                txtPassword.Text, 
                (<span class="kwrd">bool</span>)chkRemember.IsChecked, 
                <span class="kwrd">string</span>.Empty);</font></strong>

            WebContext.Current.Authentication.Login(param, (op) =&gt;
            {
                <span class="kwrd">if</span>(op.User != <span class="kwrd">null</span>
                    &amp;&amp; op.User.Identity.IsAuthenticated)
                {
                    (App.Current.RootVisual <span class="kwrd">as</span> ContentControl).Content = <span class="kwrd">new</span> MainPage();
                    <span class="kwrd">this</span>.DialogResult = <span class="kwrd">true</span>;
                }
                <span class="kwrd">else</span>
                {
                    MessageBox.Show(<span class="str">"Login fail, please try again. "</span>);
                    <span class="kwrd">this</span>.DialogResult = <span class="kwrd">null</span>;
                }
            }, <span class="kwrd">null</span>);


        }</pre><pre class="csharpcode">&nbsp;</pre><pre class="csharpcode">&nbsp;</pre>
<p>&nbsp;</p>
<p>这样修改完之后，重新运行项目，第一次的时候，因为本地没有保存凭据，所以我们会被要求进行登录</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303319667.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303317126.png" width="1003" height="656"></a></p>
<p>请注意，我们选中“Remember me”，然后点击“Ok”</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303326013.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303321520.png" width="1003" height="656"></a></p>
<p>然后，我们可以关掉浏览器，重新启动程序。因为之前保存了用户凭据，所以你将直接可以看到MainPage，而无需登录</p>
<p><a href="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303324834.png"><img title="image" border="0" alt="image" src="http://images.cnblogs.com/cnblogs_com/chenxizhang/201107/201107131303331454.png" width="1003" height="656"></a></p>
<p>很不错，对吧？最后遗留了一个问题，就是如果我想用其他用户登录的话，怎么办呢？我肯定希望将原先保存好的用户凭据删除掉。如何实现这样的功能呢？</p>
<h1>10. 实现用户注销</h1><pre class="csharpcode">            <span class="kwrd">&lt;</span><span class="html">HyperlinkButton</span>
                <span class="attr">Content</span><span class="kwrd">="Logout"</span>
                <span class="attr">HorizontalAlignment</span><span class="kwrd">="Right"</span> <span class="attr">Margin</span><span class="kwrd">="10"</span> <span class="attr">x:Name</span><span class="kwrd">="btLogout"</span> <span class="attr">Click</span><span class="kwrd">="btLogout_Click"</span><span class="kwrd">&gt;&lt;/</span><span class="html">HyperlinkButton</span><span class="kwrd">&gt;</span>

                <span class="kwrd">&lt;</span><span class="html">TextBlock</span>
                <span class="attr">Text</span><span class="kwrd">="Customers List"</span>
                <span class="attr">FontSize</span><span class="kwrd">="40"</span><span class="kwrd">&gt;&lt;/</span><span class="html">TextBlock</span><span class="kwrd">&gt;</span></pre>
<p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
</p>
<p>为了实现注销，我们一般在主窗口上面，添加一个HyperLinkButton，如上所示。它的代码也很简单</p><pre class="csharpcode">        <span class="kwrd">private</span> <span class="kwrd">void</span> btLogout_Click(<span class="kwrd">object</span> sender, RoutedEventArgs e)
        {
            WebContext.Current.Authentication.Logout(<span class="kwrd">true</span>);
        }</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>11.总结</h1>
<p>本文，我用一个实例讲解了如何在RIA Service中启用身份验证。这是很实用的技术，我们使用到了Authentication Domain Service,和自定义的MembershipProvider，在客户端我们还实现了登录窗口以及自动登录。</p>
<p>&nbsp;</p>
<p>本文实例源代码，可以通过下面地址下载</p>
<p><a title="http://files.cnblogs.com/chenxizhang/SilverlightRIAAuthenticationSample.rar" href="http://files.cnblogs.com/chenxizhang/SilverlightRIAAuthenticationSample.rar">http://files.cnblogs.com/chenxizhang/SilverlightRIAAuthenticationSample.rar</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>