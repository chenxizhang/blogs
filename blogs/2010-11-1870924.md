# 【MOSS 2010】 如何开发一个自定义的WebPart来承载Silverlight应用程序 
> 原文发表于 2010-11-07, 地址: http://www.cnblogs.com/chenxizhang/archive/2010/11/07/1870924.html 


<p>在 <a href="http://www.cnblogs.com/chenxizhang/archive/2010/04/06/1705132.html">MOSS 2010：Visual Studio 2010开发体验（8）——Silverlight应用</a> 这篇文章中，我介绍到了在MOSS 2010中提供的对Silverlight支持。它默认提供了一个Silverlight WebPart可以很方便地显示我们的Silverlight应用程序</p> <p>但是也有些朋友问到，如果我们要自己开发一个WebPart实现类似的功能，那么该怎么做呢？</p> <p>【备注】我并不认为这是必须要做的事情，因为我觉得默认那个WebPart绝大部分都能满足要求。</p> <p>&nbsp;</p> <p>如果你确实需要定制自己的WebPart，那么请继续往下读</p> <h1>第一步：创建Silverlight应用程序，并将其编译的结果复制到一个特殊的目录</h1> <p>这个目录是：C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\14\TEMPLATE\LAYOUTS\ClientBin</p> <p><a href="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_thumb.png" width="244" height="179"></a></p> <p><a href="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_3.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_thumb_3.png" width="244" height="184"></a></p> <p>本例中，我做了一个最简单的Silverlight程序。只有一个按钮。</p> <p>&nbsp;</p> <h1>第二步：创建SharePoint Visual WebPart项目</h1> <p><a href="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_4.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_thumb_4.png" width="244" height="179"></a></p> <p>在那个ascx文件中，添加如下的内容</p><pre class="csharpcode">    <span class="kwrd">&lt;</span><span class="html">style</span> <span class="attr">type</span><span class="kwrd">="text/css"</span><span class="kwrd">&gt;</span>
    html, body {
        height: 100%;
        overflow: auto;
    }
    body {
        padding: 0;
        margin: 0;
    }
    #silverlightControlHost {
        height: 100%;
        text-align:center;
    }
    <span class="kwrd">&lt;/</span><span class="html">style</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">function</span> onSilverlightError(sender, args) {
            <span class="kwrd">var</span> appSource = <span class="str">""</span>;
            <span class="kwrd">if</span> (sender != <span class="kwrd">null</span> &amp;&amp; sender != 0) {
                appSource = sender.getHost().Source;
            }

            <span class="kwrd">var</span> errorType = args.ErrorType;
            <span class="kwrd">var</span> iErrorCode = args.ErrorCode;

            <span class="kwrd">if</span> (errorType == <span class="str">"ImageError"</span> || errorType == <span class="str">"MediaError"</span>) {
                <span class="kwrd">return</span>;
            }

            <span class="kwrd">var</span> errMsg = <span class="str">"Unhandled Error in Silverlight Application "</span> + appSource + <span class="str">"\n"</span>;

            errMsg += <span class="str">"Code: "</span> + iErrorCode + <span class="str">"    \n"</span>;
            errMsg += <span class="str">"Category: "</span> + errorType + <span class="str">"       \n"</span>;
            errMsg += <span class="str">"Message: "</span> + args.ErrorMessage + <span class="str">"     \n"</span>;

            <span class="kwrd">if</span> (errorType == <span class="str">"ParserError"</span>) {
                errMsg += <span class="str">"File: "</span> + args.xamlFile + <span class="str">"     \n"</span>;
                errMsg += <span class="str">"Line: "</span> + args.lineNumber + <span class="str">"     \n"</span>;
                errMsg += <span class="str">"Position: "</span> + args.charPosition + <span class="str">"     \n"</span>;
            }
            <span class="kwrd">else</span> <span class="kwrd">if</span> (errorType == <span class="str">"RuntimeError"</span>) {
                <span class="kwrd">if</span> (args.lineNumber != 0) {
                    errMsg += <span class="str">"Line: "</span> + args.lineNumber + <span class="str">"     \n"</span>;
                    errMsg += <span class="str">"Position: "</span> + args.charPosition + <span class="str">"     \n"</span>;
                }
                errMsg += <span class="str">"MethodName: "</span> + args.methodName + <span class="str">"     \n"</span>;
            }

            <span class="kwrd">throw</span> <span class="kwrd">new</span> Error(errMsg);
        }
    <span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">id</span><span class="kwrd">="silverlightControlHost"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">object</span> <span class="attr">data</span><span class="kwrd">="data:application/x-silverlight-2,"</span> <span class="attr">type</span><span class="kwrd">="application/x-silverlight-2"</span> <span class="attr">width</span><span class="kwrd">="100%"</span> <span class="attr">height</span><span class="kwrd">="100%"</span><span class="kwrd">&gt;</span>
    <font size="4">   <strong><font color="#ff0000">   <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="source"</span> <span class="attr">value</span><span class="kwrd">="_layouts/clientbin/demo.xap"</span><span class="kwrd">/&gt;</span></font></strong></font>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="onError"</span> <span class="attr">value</span><span class="kwrd">="onSilverlightError"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="background"</span> <span class="attr">value</span><span class="kwrd">="white"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="minRuntimeVersion"</span> <span class="attr">value</span><span class="kwrd">="3.0.40818.0"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">param</span> <span class="attr">name</span><span class="kwrd">="autoUpgrade"</span> <span class="attr">value</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=3.0.40818.0"</span> <span class="attr">style</span><span class="kwrd">="text-decoration:none"</span><span class="kwrd">&gt;</span>
               <span class="kwrd">&lt;</span><span class="html">img</span> <span class="attr">src</span><span class="kwrd">="http://go.microsoft.com/fwlink/?LinkId=108181"</span> <span class="attr">alt</span><span class="kwrd">="Get Microsoft Silverlight"</span> <span class="attr">style</span><span class="kwrd">="border-style:none"</span><span class="kwrd">/&gt;</span>
          <span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">object</span><span class="kwrd">&gt;&lt;</span><span class="html">iframe</span> <span class="attr">id</span><span class="kwrd">="_sl_historyFrame"</span> <span class="attr">style</span><span class="kwrd">="visibility:hidden;height:0px;width:0px;border:0px"</span><span class="kwrd">&gt;&lt;/</span><span class="html">iframe</span><span class="kwrd">&gt;&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>第三步：部署该解决方案，检查结果</h1>
<p><a href="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_5.png"><img title="image" border="0" alt="image" src="http://www.xizhang.com/blogimages/MOSS-2010-WebPartSilverlight_63B3/image_thumb_5.png" width="244" height="173"></a></p>
<p>&nbsp;</p>
<h1>总结</h1>
<p>我们发现，要自己开发一个WebPart来承载Silverlight应用程序，非常容易。</p>